<!DOCTYPE html>
<html>
    <!-- Head -->
    
  

<head>
	<title>React基础 -  hi 风清</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="keywords" content="hi 风清,hexo-theme-dearmsdan一款Hexo主题宝钻蓝色,It gives people a sense of emptiness,hexo简约主题,HEXO,dearmsdan.com" />
	<meta name="description" content="It gives people a sense of emptiness">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link rel="shortcut icon" href="/logo.png" type="image/png" />
	
	
		 
		
	
	
	<link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_1605171_5fpik914nu9.css">
	
	<link rel="stylesheet" type="text/css" href="/css/bootstrap-3.3.4.css">
	
<link rel="stylesheet" href="/css/style.css">

	
	<link rel="stylesheet" type="text/css" href="/css/avatar_user.css">
	
	<link rel="stylesheet" type="text/css" href="/css/social/social.css">
	
	<link rel="stylesheet" type="text/css" href="/css/navEffect.css">
	
	<link rel="stylesheet" href="/resources/dearmsdan_link/link.css">
	
	<link rel="stylesheet" type="text/css" href="/css/post_content.css">
	
	
	<script src="/js/jquery1.10.2.min.js"></script>
	
<script src="/js/app.js"></script>

	<script src="/js/bootstrap-3.3.4.js"></script>
	
	<script src="/js/s.js"></script>
	
	<script src="/js/jquery.slimscroll.min.js"></script>
	
	<script src="/js/valine.js"></script>
	
	
	<script src="/resources/loadingBar/pace.min.js"></script>
	<script src="/js/headBand.min.js"></script>
	<link rel="stylesheet" href="/resources/loadingBar/flash.css">
	
	
<meta name="generator" content="Hexo 5.2.0"></head>




	
    <body>
		<div id="dearmsdan">
		<!-- Header -->
		
<nav class="navbar navbar-default navbar-fixed-top">
		<div class="brand"> 
			<a>
				<i id="dearmsdan-logo" style="font-size:50px;vertical-align: middle;"
			class="DearMsDanIconFont icon-zh"></i>
				
				
			</a>
			<a href="/">
				<span style="font-size: 20px;">hi 风清</span>
			</a>
		</div>
		<div class="nav-list"> 
			
			<a href="/" title="首页">
				<span>
					首页
				</span>
			</a>
			
			<a href="/about.html" title="关于">
				<span>
					关于
				</span>
			</a>
			
			<a href="/valine.html" title="留言板">
				<span>
					留言板
				</span>
			</a>
			
			<a href="/link.html" title="友情链接">
				<span>
					友情链接
				</span>
			</a>
			
		</div>
	
	
      <div class="mobile">
        <div class="mobile-inner">
          <div class="mobile-inner-header">
            <div class="mobile-inner-header-icon mobile-inner-header-icon-out">
				<span></span><span></span>
			  </div>
          </div>
         	<div class="mobile-inner-nav"> 
				
				<a href="/" title="首页">
					<span>
						首页
					</span>
				</a>
				
				<a href="/about.html" title="关于">
					<span>
						关于
					</span>
				</a>
				
				<a href="/valine.html" title="留言板">
					<span>
						留言板
					</span>
				</a>
				
				<a href="/link.html" title="友情链接">
					<span>
						友情链接
					</span>
				</a>
				
			</div>
        </div>
    </div>
	
<script>
	$(window).load(function () {
	  $(".mobile-inner-header-icon").click(function(){
	  	$(this).toggleClass("mobile-inner-header-icon-click mobile-inner-header-icon-out");
	  	$(".mobile-inner-nav").slideToggle(250);
	  });
	  $(".mobile-inner-nav a").each(function( index ) {
	  	$( this ).css({'animation-delay': (index/10)+'s'});
	  });
	});
</script>
	
	
	
	
	<div class="container-fluid">
		<div class="navbar-btn" style="padding: 0; padding-top: 10px;">
			<button type="button" class="btn-toggle-fullwidth btn-toggle-mx">
				<i class="DearMsDanIconFont">&#xe623;</i>
			</button>
		</div>
	</div>
</nav>



<div id="sidebar-nav" class="sidebar">

<div class="dearmsdan-bg">
	<div class="dearmsdano div_bg"></div>		
</div>


		<div class="sidebar-scroll">
			<div class="sidebar-author">
				<a href="/">
					
						<img src="/Pexels.gif">
						<img src="/logo.png">
					
				</a>
			</div>
			<nav>
				
				<div class="dearmsdan-count">
					<span>文章</span>12
					<span>标签</span>12
					<span>分类</span>0
				</div>		
			<div class="social-btns">
				
				
					<a target="_blank" class="btn GitHub" href="https://github.com/fengqing7511/">
						
            		<i class="DearMsDanIconFont icon-git"></i>
						
        			</a>
				
					<a target="_blank" class="btn email" href="mailto:kangyue7511@163.com">
						
            		<i class="DearMsDanIconFont icon-youxiang"></i>
						
        			</a>
				
					<a target="_blank" class="btn netease" href="https://music.163.com/">
						
            		<i class="DearMsDanIconFont icon-netease"></i>
						
        			</a>
				
					<a target="_blank" class="btn qq" href="https://wpa.qq.com/msgrd?v=3&uin=2646405301&site=qq&menu=yes">
						
            		<i class="DearMsDanIconFont icon-qq"></i>
						
        			</a>
				
					<a target="_blank" class="btn weibo" href="https://weibo.com/">
						
            		<i class="DearMsDanIconFont icon-weibo"></i>
						
        			</a>
				
				</div>
				
		 
				
		
				<ul class="nav">	
					<li>
						<a target="_self" href="/" class="iframe_link active"><span>首页</span>
						</a>
					</li>
					
					<li>
						<a id="axis" target="_self" href="/axis.html" class="nav-togg">
							<span>时间轴</span>
						</a>
					</li>
					
					
					

					  
					  



					  
					  


  <li><a href="javascript:;" class="nav-togg" target="_self"  ><span>标签</span>
	  </a>
	  
    <div>
      <ul>
          <li>
			  <a href="/tags/ES6/" style="font-size: 10px;">ES6</a> <a href="/tags/ES6-Express/" style="font-size: 10px;">ES6  Express</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/JS/" style="font-size: 10px;">JS</a> <a href="/tags/Node/" style="font-size: 10px;">Node</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/React-AntDesignPro/" style="font-size: 10px;">React  AntDesignPro</a> <a href="/tags/React-Umi-Dva/" style="font-size: 10px;">React  Umi  Dva</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F-uni-app/" style="font-size: 10px;">小程序  uni-app</a>
          </li>
      </ul>
    </div>
	  
    
  </li>

					  
					  

  <li>
	  <a href="javascript:;" class="nav-togg" target="_self" ><span>文章归档</span>
	  </a>
    <div>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li></ul>
    </div>
  </li>


					  
					  


  <li>
	  <a href="javascript:;" class="nav-togg" target="_self" ><span>最新文章</span>
	  </a>
    <div>
      <ul>
        
          <li>
            <a href="/2020/11/02/01.typescript/">TypeScript</a>
          </li>
        
          <li>
            <a href="/2020/10/20/02.es6/">ES6介绍</a>
          </li>
        
          <li>
            <a href="/2020/10/10/03.JavaScript%E5%9F%BA%E7%A1%80/">JavaScript基础</a>
          </li>
        
          <li>
            <a href="/2020/09/25/04.node/">Node入门</a>
          </li>
        
          <li>
            <a href="/2020/09/03/05.express/">Express</a>
          </li>
        
      </ul>
    </div>
  </li>

					  
					
					
					
					
					
				</ul>
			</nav>
		</div>
</div>











				
	
	<style>
/* CSS */
.canvas {
    position:fixed;
    width: 1920px;
    height: 862px;
    left: -360px;
    top: 0;
    z-index: -1;
}
	</style>
<canvas class="canvas dearmsdan-canvas" width="1920" height="862"></canvas>
<canvas class="canvas dearmsdan-festival dearmsdan-canvas" width="1920" height="862"></canvas>












<div class="dearmsdan-bg">
	<div class="div_bg"></div>		
</div>




<script>
    //background-image: url(https://img.xjh.me/random_img.php?type=bg&ctype=nature&return=302);
</script>
			<div class="main">
				<div class="main-content">
					



<style>
	#dearmsdanPost:hover{
   		    background-color: rgba(255, 255, 255, 0.5)!important;
	}	
</style>
<div class="dearmsdan">
	<div class="dearmsdan-post" id="dearmsdanPost">
		<div class="dearmsdan-title">
			<h1>React基础</h1>
		</div>
	  <div id="post" class="dearmsdan-post-Statistics">
            <a>2020年03月18日</a>
		  	<a class="post-count">99 字</a>
		
		
		  <a class=" -none-link" href="/tags/React/" rel="tag">React</a>
		
	  </div>
		
		
<div id="modal" style="display:none">

<aside id="article-toc" class="fixed-toc">
    <div id="article-toc-inner">
        <strong class="sidebar-title">目录</strong>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-React%E7%AE%80%E4%BB%8B"><span class="toc-text">1. React简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-React%E4%BB%8B%E7%BB%8D"><span class="toc-text">1.1 React介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%89%8D%E7%AB%AF%E4%B8%89%E5%A4%A7%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6"><span class="toc-text">1.2 前端三大主流框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-React%E4%B8%8EVue%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-text">1.3 React与Vue的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-React%E4%B8%AD%E5%87%A0%E4%B8%AA%E6%A0%B8%E5%BF%83%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text">1.4 React中几个核心的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-1-%E8%99%9A%E6%8B%9FDOM%EF%BC%88Virtual-Document-Object-Model%EF%BC%89"><span class="toc-text">1.4.1 虚拟DOM（Virtual Document Object Model）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-2-react%E7%9A%84Diff%E7%AE%97%E6%B3%95"><span class="toc-text">1.4.2 react的Diff算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-tree-diff"><span class="toc-text">a) tree diff</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-component-diff"><span class="toc-text">b) component diff</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-element-diff"><span class="toc-text">c) element diff</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Create-React-App%E8%84%9A%E6%89%8B%E6%9E%B6"><span class="toc-text">2. Create React App脚手架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"><span class="toc-text">2.1 创建应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%EF%BC%8C%E5%AD%97%E4%BD%93%E5%92%8C%E6%96%87%E4%BB%B6"><span class="toc-text">2.2 添加图片，字体和文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE-todos%E2%80%A6%E2%80%A6"><span class="toc-text">2.3 修改默认配置(todos……)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-React%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-text">2.4 React基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-React%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8C%85"><span class="toc-text">2.4.1 React的核心包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-JSX%E8%AF%AD%E6%B3%95"><span class="toc-text">2.4.2 JSX语法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-React%E4%B8%AD%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6"><span class="toc-text">3. React中创建组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%BD%BF%E7%94%A8-class-%E5%85%B3%E9%94%AE%E5%AD%97%E6%9D%A5%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6"><span class="toc-text">3.1 使用 class 关键字来创建组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%BB%84%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-text">3.1.1 最基本的组件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">3.1.2 使用案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-state%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-text">3.1.3 state的修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-%E4%B8%8D%E8%83%BD%E7%9B%B4%E6%8E%A5%E4%BF%AE%E6%94%B9-State"><span class="toc-text">a) 不能直接修改 State</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-State%E7%9A%84%E6%9B%B4%E6%96%B0%E5%8F%AF%E8%83%BD%E6%98%AF%E5%BC%82%E6%AD%A5%E7%9A%84"><span class="toc-text">b) State的更新可能是异步的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-%E8%8E%B7%E5%8F%96%E6%9B%B4%E6%96%B0%E4%B9%8B%E5%90%8E%E7%9A%84state%E6%95%B0%E6%8D%AE"><span class="toc-text">c) 获取更新之后的state数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-setState%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="toc-text">d) setState的实现过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%9D%A5%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6"><span class="toc-text">3.2 使用构造函数来创建组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">3.2.1 基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E4%B8%AD%E7%9A%84state"><span class="toc-text">3.2.2 函数组件中的state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-state-hook%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">3.2.3  state hook基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-useState%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-text">3.2.4 useState使用注意点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-useState%E6%98%AF%E5%BC%82%E6%AD%A5%E7%9A%84"><span class="toc-text">a) useState是异步的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-useState%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8A%A1%E5%BF%85%E6%98%AFimmutable%E6%95%B0%E6%8D%AE"><span class="toc-text">b) useState中的数据务必是immutable数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E4%B8%A4%E7%A7%8D%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6%E6%96%B9%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-text">3.3 两种创建组件方式的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93"><span class="toc-text">3.4 条件渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E9%80%9A%E8%BF%87if%E6%9D%A5%E8%BF%9B%E8%A1%8C%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93"><span class="toc-text">3.4.1 通过if来进行条件渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-%E9%80%9A%E8%BF%87%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93"><span class="toc-text">3.4.2 通过三元运算符条件渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-%E9%98%BB%E6%AD%A2%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93"><span class="toc-text">3.4.3 阻止组件渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-4-%E9%80%9A%E8%BF%87-amp-amp-%E8%BF%9B%E8%A1%8C%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93"><span class="toc-text">3.4.4 通过&amp;&amp;进行条件渲染</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93"><span class="toc-text">3.5 列表渲染</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-Fragment%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">3.6 Fragment的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-React%E7%BB%84%E5%90%88"><span class="toc-text">3.7 React组合</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">4. 评论列表案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%90%AF%E7%94%A8sass"><span class="toc-text">4.1 启用sass</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-text">4.1.1 安装依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E5%9C%A8sass%E6%96%87%E4%BB%B6%E4%B8%AD%E5%BC%95%E5%85%A5%E5%85%B6%E4%BB%96sass%E6%96%87%E4%BB%B6"><span class="toc-text">4.1.2 在sass文件中引入其他sass文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E6%A1%88%E4%BE%8B%E5%AE%8C%E6%88%90"><span class="toc-text">4.2 案例完成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-CmtList-tsx"><span class="toc-text">4.2.1 CmtList.tsx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-CmtList-scss"><span class="toc-text">4.2.2 CmtList.scss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-CmtItem-tsx"><span class="toc-text">4.2.3 CmtItem.tsx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-CmtItem-scss"><span class="toc-text">4.2.4 CmtItem.scss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-%E9%97%AE%E9%A2%98"><span class="toc-text">4.2.5 问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E4%BD%BF%E7%94%A8CSS%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-text">4.3 使用CSS模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-CmtList-module-scss"><span class="toc-text">4.3.1 CmtList.module.scss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-CmtList-tsx"><span class="toc-text">4.3.2 CmtList.tsx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-3-%E6%80%BB%E7%BB%93"><span class="toc-text">4.3.3 总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-React%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E7%9A%84%E9%80%9A%E4%BF%A1"><span class="toc-text">4.4 React父子组件的通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-1-%E7%88%B6%E7%BB%84%E4%BB%B6%E4%BC%A0%E9%80%92%E7%BB%99%E5%AD%90%E7%BB%84%E4%BB%B6"><span class="toc-text">4.4.1 父组件传递给子组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-2-%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E9%80%92%E7%BB%99%E7%88%B6%E7%BB%84%E4%BB%B6"><span class="toc-text">4.4.2 子组件传递给父组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-3-%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8%E5%8F%91%E8%A1%A8%E8%AF%84%E8%AE%BA"><span class="toc-text">4.4.3 评论列表发表评论</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-React-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-text">5. React 事件处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A"><span class="toc-text">5.1 函数组件的事件绑定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E7%BB%91%E5%AE%9A%E6%96%87%E6%9C%AC%E6%A1%86%E4%B8%8Estate%E4%B8%AD%E7%9A%84%E5%80%BC"><span class="toc-text">5.2 绑定文本框与state中的值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-%E8%A1%A8%E5%8D%95%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6"><span class="toc-text">5.2.1 表单受控组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-%E8%A1%A8%E5%8D%95%E9%9D%9E%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6"><span class="toc-text">5.2.2 表单非受控组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6%E5%92%8C%E9%9D%9E%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6"><span class="toc-text">5.2.3 受控组件和非受控组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-Ref-Hook"><span class="toc-text">5.3 Ref Hook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-%E4%BF%9D%E5%AD%98dom"><span class="toc-text">5.3.1 保存dom</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-forwardRef"><span class="toc-text">5.3.2 forwardRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-useImperativeHandle"><span class="toc-text">5.3.3 useImperativeHandle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-4-%E4%BF%9D%E5%AD%98%E4%BA%8B%E4%BB%B6-%E5%8F%98%E9%87%8F"><span class="toc-text">5.3.4 保存事件&#x2F;变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-5-useState%E5%92%8CuseRef%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">5.3.5 useState和useRef的区别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E7%B1%BB%E7%BB%84%E4%BB%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">6. 类组件的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D"><span class="toc-text">6.1 生命周期钩子函数介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="toc-text">6.2 生命周期函数详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E7%BB%84%E4%BB%B6%E7%9A%84%E9%87%8D%E6%96%B0%E6%B8%B2%E6%9F%93%E5%92%8C%E4%BC%98%E5%8C%96"><span class="toc-text">6.3 组件的重新渲染和优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1-%E7%B1%BB%E7%BB%84%E4%BB%B6%E7%9A%84re-render%E7%9A%84%E6%97%B6%E6%9C%BA"><span class="toc-text">6.3.1 类组件的re-render的时机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2-shouldComponentUpdate%E4%BC%98%E5%8C%96"><span class="toc-text">6.3.2 shouldComponentUpdate优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-3-PureComponent%E4%BC%98%E5%8C%96"><span class="toc-text">6.3.3 PureComponent优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-getDerivedStateFromProps%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">6.4 getDerivedStateFromProps存在的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-React%E8%80%81%E7%89%88%E6%9C%AC%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">6.5 React老版本生命周期</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">7.函数组件的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-useEffect%E4%BB%8B%E7%BB%8D"><span class="toc-text">7.1 useEffect介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-useEffect%E7%94%A8%E6%B3%95"><span class="toc-text">7.2 useEffect用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-useEffect%E4%BD%BF%E7%94%A8"><span class="toc-text">7.3 useEffect使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E6%B8%85%E9%99%A4%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="toc-text">7.4 清除副作用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-%E6%97%A0%E9%9C%80%E6%B8%85%E7%90%86%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="toc-text">a) 无需清理的副作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-%E9%9C%80%E8%A6%81%E6%B8%85%E7%90%86%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="toc-text">b) 需要清理的副作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-useEffect%E8%BF%94%E5%9B%9E%E6%B8%85%E9%99%A4%E5%87%BD%E6%95%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="toc-text">c) useEffect返回清除函数的执行时机</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-useLayoutEffect"><span class="toc-text">7.5 useLayoutEffect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-6-useEffect%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-text">7.6 useEffect使用注意点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8hook"><span class="toc-text">8.其他常用hook</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6re-render%E7%9A%84%E6%97%B6%E6%9C%BA"><span class="toc-text">8.1 函数组件re-render的时机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-memo-useMemo-useCallback"><span class="toc-text">8.2 memo\useMemo\useCallback</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-%E4%BD%BF%E7%94%A8memo%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-text">8.2.1 使用memo高阶函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-2-useMemo"><span class="toc-text">8.2.2 useMemo</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-%E6%B2%A1%E6%9C%89%E4%BD%BF%E7%94%A8useMemo%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">a) 没有使用useMemo存在的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-useMemo-hook"><span class="toc-text">b) useMemo hook</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-3-useCallback"><span class="toc-text">8.2.3 useCallback</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-%E6%B2%A1%E6%9C%89%E4%BD%BF%E7%94%A8useCallback%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">a) 没有使用useCallback的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-useCallback-hook"><span class="toc-text">b) useCallback   hook</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-4-useMemo%E5%92%8CuseCallback%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB"><span class="toc-text">8.2.4 useMemo和useCallback的区别和联系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-useReducer%E5%92%8CuseContext"><span class="toc-text">8.3 useReducer和useContext</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-1-useContext"><span class="toc-text">8.3.1 useContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-2-useReducer"><span class="toc-text">8.3.2 useReducer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-3-useReducer%E5%92%8CuseContext-%E4%BA%86%E8%A7%A3"><span class="toc-text">8.3.3 useReducer和useContext(了解)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-Hook%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-text">8.4 Hook的规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-1-%E5%8F%AA%E5%9C%A8%E7%BB%84%E4%BB%B6%E9%A1%B6%E5%B1%82%E4%B8%AD%E4%BD%BF%E7%94%A8Hook"><span class="toc-text">8.4.1 只在组件顶层中使用Hook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-2-%E5%8F%AA%E5%9C%A8React-%E5%87%BD%E6%95%B0%E4%B8%AD%E8%B0%83%E7%94%A8Hook"><span class="toc-text">8.4.2 只在React 函数中调用Hook</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-Hook%E5%8F%82%E7%85%A7%E6%96%87%E7%AB%A0%EF%BC%9A"><span class="toc-text">8.5 Hook参照文章：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-React-router"><span class="toc-text">9. React-router</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-text">9.1 前端路由的两种实现方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-Reac%E4%B8%AD%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-text">9.2 Reac中的路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-HashRouter%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">9.3 HashRouter的基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99"><span class="toc-text">9.4 匹配规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-Switch%E5%92%8CRedirect"><span class="toc-text">9.5 Switch和Redirect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6-React%E4%B8%AD%E7%9A%84%E7%BC%96%E7%A8%8B%E5%BC%8F%E5%AF%BC%E8%88%AA%E5%92%8C%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82"><span class="toc-text">9.6 React中的编程式导航和路由传参</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-1-withRouter%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">9.6.1 withRouter的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-2-%E4%BD%BF%E7%94%A8withRouter%E8%B7%B3%E8%BD%AC%E9%A1%B5%E9%9D%A2"><span class="toc-text">9.6.2 使用withRouter跳转页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-3-%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82"><span class="toc-text">9.6.3 路由传参</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-params%E6%96%B9%E5%BC%8F%E4%BC%A0%E5%8F%82"><span class="toc-text">a) params方式传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-search%E6%96%B9%E5%BC%8F%E4%BC%A0%E5%8F%82"><span class="toc-text">b) search方式传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-query%E6%96%B9%E5%BC%8F%E4%BC%A0%E5%8F%82"><span class="toc-text">c) query方式传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-state%E6%96%B9%E5%BC%8F%E4%BC%A0%E5%8F%82"><span class="toc-text">d) state方式传参</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-7-%E7%BB%84%E4%BB%B6%E6%87%92%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2"><span class="toc-text">9.7 组件懒加载和基于路由的代码分割</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6"><span class="toc-text">10.高阶组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-text">10.1 高阶函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6"><span class="toc-text">10.2 高阶组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-1-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F-%E5%B1%9E%E6%80%A7%E4%BB%A3%E7%90%86"><span class="toc-text">10.2.1 高阶组件的实现方式-属性代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-%E5%B1%9E%E6%80%A7%E4%BB%A3%E7%90%86-%E7%94%A8%E5%85%B6%E4%BB%96%E5%85%83%E7%B4%A0%E5%8C%85%E8%A3%85%E7%BB%84%E4%BB%B6"><span class="toc-text">a) 属性代理-用其他元素包装组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-%E5%B1%9E%E6%80%A7%E4%BB%A3%E7%90%86-%E6%9B%B4%E6%94%B9props"><span class="toc-text">b) 属性代理-更改props</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-%E5%B1%9E%E6%80%A7%E4%BB%A3%E7%90%86-%E6%8A%BD%E5%8F%96%E5%85%AC%E5%85%B1state"><span class="toc-text">c) 属性代理-抽取公共state</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-2-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F-%E5%8F%8D%E5%90%91%E7%BB%A7%E6%89%BF"><span class="toc-text">10.2.2 高阶组件的实现方式-反向继承</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-%E5%8F%8D%E5%90%91%E7%BB%A7%E6%89%BF-%E6%B8%B2%E6%9F%93%E5%8A%AB%E6%8C%81"><span class="toc-text">a) 反向继承-渲染劫持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-%E5%8F%8D%E5%90%91%E7%BB%A7%E6%89%BF-%E4%BF%AE%E6%94%B9state"><span class="toc-text">b) 反向继承-修改state</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E5%AE%89%E8%A3%85-React-Developer-Tools-%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="toc-text">11.安装 React Developer Tools 调试工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E7%9B%B8%E5%85%B3%E6%96%87%E7%AB%A0"><span class="toc-text">12. 相关文章</span></a></li></ol>
    </div>
</aside>
</div>


		
			<a href="#modal" class="second">
				<div class="i">
						<i style="font-size:20px" class="DearMsDanIconFont icon-sousuo">
						<span style="font-size:0px"><br/>目<br/>录</span>
						</i>
				</div>
			</a>




<script>
	$(".second .i").mouseover(function(){
  $(".second .i span").css("font-size","18px");
});
	$(".second .i").mouseleave(function(){
  $(".second .i span").css("font-size","0px");
});
</script>











		<div>
			  <article>
				<h1 id="1-React简介"><a href="#1-React简介" class="headerlink" title="1. React简介"></a>1. React简介</h1><h2 id="1-1-React介绍"><a href="#1-1-React介绍" class="headerlink" title="1.1 React介绍"></a>1.1 React介绍</h2><ul>
<li><p>React 是一个用于构建用户界面的 JAVASCRIPT库。React主要用于构建UI，很多人认为 React 是 MVC 中的 V（视图）。</p>
</li>
<li><p>React 起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram（照片交友） 的网站。做出来以后，发现这套东西很好用，<strong>就在2013年5月开源了</strong>。</p>
</li>
<li><p>React 拥有较高的性能，代码逻辑非常简单，越来越多的人已开始关注和使用它。由于 React 的<strong>设计思想极其独特</strong>，属于革命性创新，性能出众，代码逻辑却非常简单。所以，越来越多的人开始关注和使用，认为它可能是将来 Web 开发的主流工具。</p>
</li>
<li><p>清楚两个概念：</p>
<ul>
<li><p>library（库）：小而巧的库，只提供了特定的API；优点就是 船小好掉头，可以很方便的从一个库切换到另外的库；但是代码几乎不会改变；比如从jQuery切换到</p>
</li>
<li><p>Framework（框架）：大而全的是框架；框架提供了一整套的解决方案；所以如果在项目中间，想切换到另外的框架，是比较困难的；</p>
</li>
</ul>
</li>
</ul>
<a id="more"></a>

<h2 id="1-2-前端三大主流框架"><a href="#1-2-前端三大主流框架" class="headerlink" title="1.2 前端三大主流框架"></a>1.2 前端三大主流框架</h2><ul>
<li>Angular.js：出来<strong>较早</strong>的前端框架，学习曲线比较陡，NG1学起来比较麻烦，NG2 ~ NG5开始，进行了一系列的改革，也提供了组件化开发的概念；从NG2开始，也支持使用TS（TypeScript）进行编程；</li>
</ul>
<ul>
<li><p>Vue.js：<strong>最火</strong>（关注的人比较多）的一门前端框架，它是中国人开发的，对我们来说，文档要友好一些；</p>
</li>
<li><p>React.js：<strong>最流行</strong>（用的人比较多）的一门框架，因为它的设计很优秀；</p>
</li>
</ul>
<h2 id="1-3-React与Vue的对比"><a href="#1-3-React与Vue的对比" class="headerlink" title="1.3 React与Vue的对比"></a>1.3 React与Vue的对比</h2><p><strong>1、监听数据变化的实现原理不同</strong></p>
<ul>
<li>Vue 通过 getter/setter 以及一些函数的劫持，能精确知道数据变化，不需要特别的优化就能达到很好的性能</li>
<li>React 默认是通过比较引用地址的方式进行的，如果不优化（PureComponent/shouldComponentUpdate）可能导致大量不必要的VDOM的重新渲染</li>
</ul>
<p><strong>2、数据流的不同</strong></p>
<p><img src="assets%5C1574133046838.png" alt="img"></p>
<p>大家都知道Vue中默认是支持双向绑定的。在Vue1.0中我们可以实现两种双向绑定：</p>
<ol>
<li>父子组件之间，props 可以双向绑定</li>
<li>组件与DOM之间可以通过 v-model 双向绑定</li>
</ol>
<p>在 Vue2.x 中去掉了第一种，也就是父子组件之间不能双向绑定了（但是提供了一个语法糖自动帮你通过事件的方式修改），并且 Vue2.x 已经不鼓励组件对自己的 props 进行任何修改了。所以现在我们只有 组件 &lt;––&gt; DOM 之间的双向绑定这一种。</p>
<p>然而 React 从诞生之初就不支持双向绑定，React一直提倡的是单向数据流，他称之为 onChange/setState()模式。</p>
<p>不过由于我们一般都会用 Vuex 以及 Redux 等单向数据流的状态管理框架，因此很多时候我们感受不到这一点的区别了。</p>
<p><strong>3、模板渲染方式的不同</strong></p>
<p>在表层上， 模板的语法不同</p>
<ul>
<li>React 是通过JSX渲染模板</li>
<li>而Vue是通过一种拓展的HTML语法进行渲染</li>
</ul>
<p>但其实这只是表面现象，毕竟React并不必须依赖JSX。在深层上，模板的原理不同，这才是他们的本质区别：</p>
<ul>
<li>React是在组件JS代码中，通过原生JS实现模板中的常见语法，比如插值，条件，循环等，都是通过JS语法实现的</li>
<li>Vue是在和组件JS代码分离的单独的模板中，通过指令来实现的，比如条件语句就需要 v-if 来实现</li>
</ul>
<p><strong>4、Vuex 和 Redux 的区别</strong></p>
<p>从表面上来说，store 注入和使用方式有一些区别。</p>
<p>在 Vuex 中，$store 被直接注入到了组件实例中，因此可以比较灵活的使用：</p>
<ul>
<li>使用 dispatch 和 commit 提交更新</li>
<li>通过 mapState 或者直接通过 this.$store 来读取数据</li>
</ul>
<p>在 Redux 中，我们每一个组件都需要显示的用 connect 把需要的 props 和 dispatch 连接起来。</p>
<p>另外 Vuex 更加灵活一些，组件中既可以 dispatch action 也可以 commit reducer，而 Redux 中只能进行 dispatch，并不能直接调用 reducer 进行修改。</p>
<p>从实现原理上来说，最大的区别是两点：</p>
<ul>
<li>Redux 使用的是不可变数据，而Vuex的数据是可变的。Redux每次都是用新的state替换旧的state，而Vuex是直接修改</li>
<li>Redux 在检测数据变化的时候，是比较对象的引用地址；而Vuex其实和Vue的原理一样，是通过 getter/setter来比较的（如果看Vuex源码会知道，其实他内部直接创建一个Vue实例用来跟踪数据变化）</li>
</ul>
<p><strong>5、总结</strong></p>
<p>React更偏向于构建稳定大型的应用，非常的科班化。相比之下，Vue更偏向于简单迅速的解决问题，更灵活，不那么严格遵循条条框框。因此也会给人一种大型项目用React，小型项目用 Vue 的感觉。</p>
<h2 id="1-4-React中几个核心的概念"><a href="#1-4-React中几个核心的概念" class="headerlink" title="1.4 React中几个核心的概念"></a>1.4 React中几个核心的概念</h2><h3 id="1-4-1-虚拟DOM（Virtual-Document-Object-Model）"><a href="#1-4-1-虚拟DOM（Virtual-Document-Object-Model）" class="headerlink" title="1.4.1 虚拟DOM（Virtual Document Object Model）"></a>1.4.1 虚拟DOM（Virtual Document Object Model）</h3><ul>
<li><strong>DOM的本质是什么</strong>：浏览器中的概念，用JS对象来表示页面上的元素，并提供了操作 DOM 对象的API；</li>
<li><strong>什么是React中的虚拟DOM</strong>：是框架中的概念，是程序员用JS对象来模拟页面上的 DOM 和 DOM嵌套；</li>
<li><strong>为什么要实现虚拟DOM（虚拟DOM的目的）：</strong>为了实现页面中DOM 元素的高效更新</li>
<li><strong>DOM和虚拟DOM的区别</strong>：</li>
</ul>
<p><img src="images/%E8%99%9A%E6%8B%9FDOM%E7%9A%84%E6%A6%82%E5%BF%B5.png"></p>
<p><img src="assets%5C1552877849641.png" alt="1552877849641"></p>
<h3 id="1-4-2-react的Diff算法"><a href="#1-4-2-react的Diff算法" class="headerlink" title="1.4.2 react的Diff算法"></a>1.4.2 react的Diff算法</h3><p><img src="assets/Diff.png" alt="Diff算法图"></p>
<p>其实传统diff算法就是对每个节点一一对比，循环遍历所有的子节点，然后判断子节点的更新状态。通过循环递归对节点进行依次对比，算法时间复杂度达到 O(n^3) ，n是树的节点数，这个有多可怕呢？——如果要展示1000个节点，得执行上亿次比较。即便是CPU快能执行30亿条命令，也<strong>很难在一秒内</strong>计算出差异。</p>
<p>React 通过制定大胆的策略，将 O(n^3) 复杂度的问题转换成 O(n) 复杂度的问题。react根据自己的特点，实现了部分代码的简化。</p>
<p><img src="assets%5C1552878167661.png" alt="1552878167661"></p>
<h4 id="a-tree-diff"><a href="#a-tree-diff" class="headerlink" title="a) tree diff"></a>a) tree diff</h4><blockquote>
<p>（1）React通过updateDepth对Virtual DOM树进行层级控制。<br>（2）对树分层比较，两棵树只对同一层次节点进行比较。如果该节点不存在时，则该节点及其子节点会被完全删除，不会再进一步比较。<br>（3）只需遍历一次就能完成整棵DOM树的比较。</p>
</blockquote>
<p><img src="assets%5C1562723697592.png" alt="1562723697592"></p>
<blockquote>
<p>那么问题来了，如果DOM节点出现了跨层级操作,diff会咋办呢？<br>答：diff只简单考虑同层级的节点位置变换，如果是跨层级的话，只有创建节点和删除节点的操作。</p>
</blockquote>
<p><img src="assets%5C1562723819718.png" alt="1562723819718"></p>
<blockquote>
<p>如上图所示，以A为根节点的整棵树会被<strong>重新创建，而不是移动</strong>，因此 <strong>官方建议不要进行DOM节点跨层级操作，可以通过CSS隐藏、显示节点，而不是真正地移除、添加DOM节点</strong>。</p>
</blockquote>
<h4 id="b-component-diff"><a href="#b-component-diff" class="headerlink" title="b) component diff"></a>b) component diff</h4><p>React应用是基于组件构建的，对于组件的比较优化侧重于以下几点：</p>
<blockquote>
<ol>
<li>同一类型组件遵从tree diff比较v-dom树</li>
<li>不同类型组件，先将该组件归类为dirty component，替换下整个组件下的所有子节点</li>
<li>同一类型组件Virtual Dom没有变化，React允许开发者使用shouldComponentUpdate()来判断该组件是否进行diff，运用得当可以节省diff计算时间，提升性能</li>
</ol>
</blockquote>
<p><img src="assets%5C1562723945651.png" alt="1562723945651"></p>
<p>如上图，当组件D → 组件G时，diff判断为不同类型的组件，虽然它们的结构相似甚至一样，diff仍然不会比较二者结构，会直接销毁D及其子节点，然后新建一个G相关的子tree，这显然会影响性能，官方虽然认定这种情况极少出现，但是开发中的这种现象造成的影响是非常大的。</p>
<h4 id="c-element-diff"><a href="#c-element-diff" class="headerlink" title="c) element diff"></a>c) element diff</h4><p>对于同一层级的element节点，diff提供了以下3种节点操作：</p>
<blockquote>
<ol>
<li>INSERT_MARKUP 插入节点</li>
<li>MOVE_EXISING 移动节点</li>
<li>REMOVE_NODE 移除节点</li>
</ol>
</blockquote>
<p><img src="assets%5C1562724094202.png" alt="1562724094202"></p>
<p>一般diff在比较集合[A,B,C,D]和[B，A，D，C]的时候会进行全部对比，即按对应位置逐个比较，发现每个位置对应的元素都有所更新，则把旧集合全部移除，替换成新的集合，如上图，但是这样的操作在React中显然是复杂、低效、影响性能的操作，因为新集合中所有的元素都可以进行复用，无需删除重新创建，耗费性能和内存，只需要移动元素位置即可。</p>
<p>React对这一现象做出了一个高效的策略：允许开发者对同一层级的同组子节点添加唯一key值进行区分。意义就是代码上的一小步，性能上的一大步，甚至是翻天覆地的变化！</p>
<h1 id="2-Create-React-App脚手架"><a href="#2-Create-React-App脚手架" class="headerlink" title="2. Create React App脚手架"></a>2. Create React App脚手架</h1><p><a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/getting-started/">https://www.html.cn/create-react-app/docs/getting-started/</a></p>
<p><code>Create React App</code>是FaceBook的React团队官方出的一个构建<code>React</code>单页面应用的脚手架工具。它本身集成了<code>Webpack</code>，并配置了一系列内置的<code>loader</code>和默认的npm的脚本，可以很轻松的实现零配置就可以快速开发React的应用。</p>
<h2 id="2-1-创建应用"><a href="#2-1-创建应用" class="headerlink" title="2.1 创建应用"></a>2.1 创建应用</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 全局安装</span><br><span class="line">npm install -g create-react-app</span><br><span class="line"># 构建一个my-app的项目</span><br><span class="line">yarn create-react-app my-app                     </span><br><span class="line">yarn create react-app my-test-app --template typescript    <span class="comment">//typescript版本</span></span><br><span class="line">cd my-app</span><br><span class="line"></span><br><span class="line"># 启动编译当前的React项目，并自动打开 http://localhost:3000/</span><br><span class="line">yarn start</span><br><span class="line"></span><br><span class="line"># 如果你不能确保最新版本，可以先尝试卸载： npm uninstall -g create-react-app,然后再全局安装</span><br><span class="line"></span><br><span class="line"># 解压默认的webpack配置到配置文件中</span><br><span class="line"># react-scripts 是 create-react-app 的一个核心包，一些脚本和工具的默认配置都集成在里面，而 yarn eject 命令执行后会将封装在 create-react-app 中的配置全部反编译到当前项目，这样用户就能完全取得 webpack 文件的控制权。所以，eject 命令存在的意义就是更改 webpack 配置存在的啊！</span><br><span class="line">yarn run eject</span><br><span class="line">yarn install   <span class="comment">//需要再次运行install命令安装</span></span><br><span class="line">yarn run start <span class="comment">//然后才可以启动</span></span><br></pre></td></tr></table></figure>

<p>应用的目录结构：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">├── package.json</span><br><span class="line">├── public                  # 这个是webpack的配置的静态目录</span><br><span class="line">│   ├── favicon.ico</span><br><span class="line">│   ├── index.html          # 默认是单页面应用，这个是最终的html的基础模板</span><br><span class="line">│   └── manifest.json</span><br><span class="line">├── src</span><br><span class="line">│   ├── App.css             # App根组件的css</span><br><span class="line">│   ├── App.tsx              # App组件代码</span><br><span class="line">│   ├── App.test.tsx</span><br><span class="line">│   ├── index.css           # 启动文件样式</span><br><span class="line">│   ├── index.tsx            # 启动的文件（开始执行的入口）！！！！</span><br><span class="line">│   ├── logo.svg</span><br><span class="line">│   └── serviceWorker.js</span><br><span class="line">└── yarn.lock</span><br></pre></td></tr></table></figure>

<h2 id="2-2-添加图片，字体和文件"><a href="#2-2-添加图片，字体和文件" class="headerlink" title="2.2 添加图片，字体和文件"></a>2.2 添加图片，字体和文件</h2><p>使用 Webpack，添加图片和字体等静态资源的工作方式与 CSS 类似。</p>
<p>你可以 <strong>直接在 JavaScript 模块中 import 文件</strong>。 这会告诉 Webpack 将该文件包含在 bundle(包) 中。 与 CSS 导入不同，导入文件会为你提供字符串值。 此值是你可以在代码中引用的最终路径，例如 image 的 <code>src</code> 属性或链接到 PDF 的 <code>href</code> 属性。</p>
<p>要减少对服务器的请求数，导入小于 10,000 字节的图片将返回 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">data URI</a> 而不是路径。 这适用于以下文件扩展名：<code>bmp</code> ，<code>gif</code> ，<code>jpg</code> ，<code>jpeg</code> 和 <code>png</code> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例如：</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">&#x27;./logo.png&#x27;</span>; <span class="comment">// 告诉 Webpack 这个 JS 文件使用了这个图片</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(logo); <span class="comment">// /logo.84287d09.png</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Header</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 导入结果是图片的 URL </span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;logo&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;Logo&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Header;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这也适用于 CSS ：</span></span><br><span class="line">.Logo &#123;</span><br><span class="line">  background-image: url(./logo.png);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//字体图标的使用</span></span><br><span class="line"><span class="comment">//yarn add font-awesome</span></span><br><span class="line"><span class="comment">//引入样式</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;font-awesome/css/font-awesome.css&#x27;</span></span><br><span class="line"><span class="comment">//使用样式</span></span><br><span class="line">&lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;fa fa-address-book&quot;</span> aria-hidden=<span class="string">&quot;true&quot;</span>&gt;&lt;/i&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">//具体使用参照官网：http://www.fontawesome.com.cn/faicons/</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-修改默认配置-todos……"><a href="#2-3-修改默认配置-todos……" class="headerlink" title="2.3 修改默认配置(todos……)"></a>2.3 修改默认配置(todos……)</h2><p>要修改 create-react-app 脚手架中的默认配置，正常情况下我们也不会通过yarn reject暴露配置文件然后修改配置文件，我们可以在项目根目录下新建一个config-overrides.js配置文件，覆盖默认的配置</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	yarn add react-app-rewired customize-cra</span><br><span class="line"><span class="number">2.</span>	在项目根目录下创建一个config-overrides.js</span><br><span class="line"><span class="number">3.</span>  修改package.json</span><br><span class="line">    <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        - <span class="string">&quot;start&quot;</span>: <span class="string">&quot;react-scripts start&quot;</span>,</span><br><span class="line">        + <span class="string">&quot;start&quot;</span>: <span class="string">&quot;react-app-rewired start&quot;</span>,</span><br><span class="line">        - <span class="string">&quot;build&quot;</span>: <span class="string">&quot;react-scripts build&quot;</span>,</span><br><span class="line">        + <span class="string">&quot;build&quot;</span>: <span class="string">&quot;react-app-rewired build&quot;</span>,</span><br><span class="line">        - <span class="string">&quot;test&quot;</span>: <span class="string">&quot;react-scripts test&quot;</span>,</span><br><span class="line">        + <span class="string">&quot;test&quot;</span>: <span class="string">&quot;react-app-rewired test&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  修改config-overrides.js文件</span></span><br><span class="line"><span class="comment">//  http://npm.taobao.org/package/customize-cra</span></span><br><span class="line"><span class="comment">//  https://blog.csdn.net/weixin_33850890/article/details/91372527</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment">// 配置less和@符号</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    override,</span><br><span class="line">    addWebpackAlias</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&quot;customize-cra&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = override(</span><br><span class="line">    addWebpackAlias(&#123;</span><br><span class="line">        [<span class="string">&quot;@&quot;</span>]: path.resolve(__dirname, <span class="string">&quot;src&quot;</span>)</span><br><span class="line">    &#125;),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="2-4-React基本语法"><a href="#2-4-React基本语法" class="headerlink" title="2.4 React基本语法"></a>2.4 React基本语法</h2><h3 id="2-4-1-React的核心包"><a href="#2-4-1-React的核心包" class="headerlink" title="2.4.1 React的核心包"></a>2.4.1 React的核心包</h3><ul>
<li>react： 专门用于创建组件和虚拟DOM的，同时组件的生命周期都在这个包中</li>
<li>react-dom： 专门进行DOM操作的，最主要的应用场景，就是<code>ReactDOM.render()</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是 创建虚拟DOM元素的 API    &lt;h1 title=&quot;啊，五环&quot; id=&quot;myh1&quot;&gt;你比四环多一环&lt;/h1&gt;</span></span><br><span class="line"><span class="comment">//  第一个参数： 字符串类型的参数，表示要创建的标签的名称</span></span><br><span class="line"><span class="comment">//  第二个参数：对象类型的参数， 表示 创建的元素的属性节点</span></span><br><span class="line"><span class="comment">//  第三个参数： 子节点（包括 其它 虚拟DOM 获取 文本子节点）</span></span><br><span class="line"><span class="comment">//  参数n :  其它子节点</span></span><br><span class="line"><span class="keyword">const</span> myh1 = React.createElement(<span class="string">&#x27;h1&#x27;</span>, &#123; <span class="attr">title</span>: <span class="string">&#x27;啊，五环&#x27;</span>, <span class="attr">id</span>: <span class="string">&#x27;myh1&#x27;</span> &#125;, <span class="string">&#x27;你比四环多一环&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mydiv = React.createElement(<span class="string">&#x27;div&#x27;</span>, <span class="literal">null</span>, <span class="string">&#x27;这是一个div元素&#x27;</span>, myh1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 渲染虚拟DOM元素</span></span><br><span class="line"><span class="comment">// 参数1： 表示要渲染的虚拟DOM对象</span></span><br><span class="line"><span class="comment">// 参数2： 指定容器,注意：这里不能直接放 容器元素的Id字符串，需要放一个容器的DOM对象</span></span><br><span class="line">ReactDOM.render(myh1, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="2-4-2-JSX语法"><a href="#2-4-2-JSX语法" class="headerlink" title="2.4.2 JSX语法"></a>2.4.2 JSX语法</h3><blockquote>
<p>什么是JSX语法：就是符合 xml 规范的 JS 语法；（语法格式相对来说，要比HTML严谨很多）</p>
</blockquote>
<p>JSX语法的本质：并不是直接把 jsx 渲染到页面上，而是内部通过 createElement 再渲染到页面；</p>
<p>在 jsx 中混合写入 js 表达式：在 jsx 语法中，要把 JS代码写到    <code>&#123; &#125;</code> 中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 导入包</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2. JSX中使用数值、字符串、bool、数组等信息</span></span><br><span class="line"><span class="keyword">let</span> a:number = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> str:string = <span class="string">&#x27;你好，中国&#x27;</span></span><br><span class="line"><span class="keyword">let</span> boo:boolean = <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> title:string = <span class="string">&#x27;999&#x27;</span></span><br><span class="line"><span class="keyword">const</span> h1:JSX.Element = <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>红火火恍恍惚惚<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> arr:JSX.Element[] = [</span><br><span class="line">  &lt;h2&gt;这是h2&lt;/h2&gt;,</span><br><span class="line">  &lt;h3&gt;这是h3&lt;/h3&gt;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> arrStr:string[] = [<span class="string">&#x27;毛利兰&#x27;</span>, <span class="string">&#x27;柯南&#x27;</span>, <span class="string">&#x27;小五郎&#x27;</span>, <span class="string">&#x27;灰原哀&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个空数组，将来用来存放 名称 标签【方案1】</span></span><br><span class="line"><span class="keyword">const</span> nameArr:JSX.Element[] = []</span><br><span class="line"><span class="comment">// 注意： React 中，需要把 key 添加给 被 forEach 或 map 或 for 循环直接控制的元素</span></span><br><span class="line">arrStr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> temp = <span class="xml"><span class="tag">&lt;<span class="name">h5</span> <span class="attr">key</span>=<span class="string">&#123;item&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line">  nameArr.push(temp)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组的 map 方法, map 中必须写 return</span></span><br><span class="line"><span class="keyword">const</span> result:string[] = arrStr.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> item + <span class="string">&#x27;~~&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(result) </span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 调用 render 函数渲染   JSX  XML 比 HTML 严格多了</span></span><br><span class="line"><span class="comment">// 在JSX要使用JS，则需要把 JS 代码写到 &#123;&#125; 中</span></span><br><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">  &#123;a + <span class="number">2</span>&#125;</span><br><span class="line">  &lt;hr /&gt;</span><br><span class="line">  &#123;str&#125;</span><br><span class="line">  &lt;hr /&gt;</span><br><span class="line">  &#123;boo ? <span class="string">&#x27;条件为真&#x27;</span> : <span class="string">&#x27;条件为假&#x27;</span>&#125;</span><br><span class="line">  &lt;hr /&gt;</span><br><span class="line">  &lt;p title=&#123;title&#125;&gt;这是p标签&lt;/p&gt;</span><br><span class="line">  &#123;h1&#125;</span><br><span class="line">  &lt;hr /&gt;</span><br><span class="line">  &#123;<span class="comment">/* &#123;arr&#125; */</span>&#125;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 这是注释，你看不见我</span></span><br><span class="line">  &#125;</span><br><span class="line">  &lt;hr /&gt;</span><br><span class="line">  &#123;nameArr&#125;</span><br><span class="line">  &lt;hr /&gt;</span><br><span class="line">  &#123;arrStr.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;item&#125;</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)&#125;</span><br><span class="line">  &lt;hr /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;label htmlFor=<span class="string">&quot;ooo&quot;</span>&gt;<span class="number">11111</span>&lt;/label&gt;</span><br><span class="line">&lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br><span class="line">        </span><br><span class="line">                </span><br><span class="line"> #注意点：</span><br><span class="line"><span class="number">1.</span> 在 JSX 中 写注释：推荐使用&#123; <span class="comment">/* 这是注释 */</span> &#125;</span><br><span class="line"><span class="number">2.</span> 为 JSX 中的htmlFor替换label的<span class="keyword">for</span>属性</span><br><span class="line"><span class="number">3.</span> 在 JSX 创建DOM的时候，所有的节点，必须有唯一的根元素进行包裹；</span><br><span class="line"><span class="number">4.</span> 在 JSX 语法中，标签必须成对出现，如果是单标签，则必须自闭和！</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当 编译引擎，在编译JSX代码的时候，如果遇到了<code>&lt;</code>那么就把它当作 HTML代码去编译，如果遇到了 <code>&#123;&#125;</code> 就把 花括号内部的代码当作普通JS代码去编译；</p>
</blockquote>
<h1 id="3-React中创建组件"><a href="#3-React中创建组件" class="headerlink" title="3. React中创建组件"></a>3. React中创建组件</h1><h2 id="3-1-使用-class-关键字来创建组件"><a href="#3-1-使用-class-关键字来创建组件" class="headerlink" title="3.1 使用 class 关键字来创建组件"></a>3.1 使用 class 关键字来创建组件</h2><h3 id="3-1-1-最基本的组件结构"><a href="#3-1-1-最基本的组件结构" class="headerlink" title="3.1.1 最基本的组件结构"></a>3.1.1 最基本的组件结构</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//让自己的组件继承React.Compoent，重写render方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> 组件名称 <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>这是 class 创建的组件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-使用案例"><a href="#3-1-2-使用案例" class="headerlink" title="3.1.2 使用案例"></a>3.1.2 使用案例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新建Movie.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//只读 不可以修改</span></span><br><span class="line">type IProps = Readonly&lt;&#123;</span><br><span class="line">  name?: string;</span><br><span class="line">  age?: number;</span><br><span class="line">  gender?: string;</span><br><span class="line">&#125;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">msg</span>: <span class="string">&#x27;大家好，我是 class 创建的 Movie组件&#x27;</span> &#125;;</span><br><span class="line"><span class="comment">//只读 不可以this.state来修改</span></span><br><span class="line">type IState = Readonly&lt;<span class="keyword">typeof</span> initialState&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个类继承React.component   </span></span><br><span class="line"><span class="comment">//&lt;IProps，IState&gt;是泛型，约定组件中的props和state的类型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">Component</span>&lt;<span class="title">IProps</span>, <span class="title">IState</span>&gt; </span>&#123;</span><br><span class="line">  readonly state: IState = initialState;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">      &#123;<span class="comment">/* 注意：在 class 组件内部，this 表示 当前组件的实例对象。props数据不可以修改，state数据可以修改 */</span>&#125;</span><br><span class="line">      这是 Movie 组件 -- &#123;<span class="built_in">this</span>.props.name&#125; -- &#123;<span class="built_in">this</span>.props.age&#125; -- &#123;<span class="built_in">this</span>.props.gender&#125;</span><br><span class="line">      &lt;h3&gt;&#123;<span class="built_in">this</span>.state.msg&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movie;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  name: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">  gender: <span class="string">&#x27;男&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 调用 render 函数渲染</span></span><br><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">  <span class="number">123</span></span><br><span class="line">  &#123;<span class="comment">/* 这里的 Movie 标签，其实，就是 Movie 类的一个实例对象 */</span>&#125;</span><br><span class="line">  &#123;<span class="comment">/* &lt;Movie name=&#123;user.name&#125; age=&#123;user.age&#125;&gt;&lt;/Movie&gt; */</span>&#125;</span><br><span class="line">  &lt;Movie &#123;...user&#125;&gt;&lt;/Movie&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="3-1-3-state的修改"><a href="#3-1-3-state的修改" class="headerlink" title="3.1.3 state的修改"></a>3.1.3 state的修改</h3><h4 id="a-不能直接修改-State"><a href="#a-不能直接修改-State" class="headerlink" title="a) 不能直接修改 State"></a>a) 不能直接修改 State</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//我们把state设置为Readonly就是为了不让直接修改state，所以下面写法错误</span></span><br><span class="line"><span class="built_in">this</span>.state.comment = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//可以这样修改State</span></span><br><span class="line"><span class="built_in">this</span>.setState(&#123;<span class="attr">comment</span>: <span class="string">&#x27;Hello&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="b-State的更新可能是异步的"><a href="#b-State的更新可能是异步的" class="headerlink" title="b) State的更新可能是异步的"></a>b) State的更新可能是异步的</h4><p>因为 <code>this.props</code> 和 <code>this.state</code> 可能会异步更新，所以你不要依赖他们的值来更新下一个状态。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用setState，组件的state并不会立即改变，setState只是把要修改的状态放入一个队列中，React会优化真正的执行时机，并且React会出于性能原因，可能会将多次setState的状态修改合并成一次状态修改。所以不要依赖当前的State，计算下个State。</span></span><br><span class="line">private btnAdd = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//Wrong</span></span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;<span class="attr">count</span>: <span class="built_in">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;<span class="attr">count</span>: <span class="built_in">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;<span class="attr">count</span>: <span class="built_in">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  <span class="comment">//结果state的count为1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Wrong   因为state和props的更新可能是异步的，所以并不能保证counter中所获取到的state和props是最新的</span></span><br><span class="line">private btnAdd = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      counter: <span class="built_in">this</span>.state.counter + <span class="built_in">this</span>.props.increment,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Correct</span></span><br><span class="line"> private btnAdd = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(<span class="function">(<span class="params">state:IState,props:IProps</span>)=&gt;</span>(&#123;</span><br><span class="line">      count:state.count+<span class="number">1</span></span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="built_in">this</span>.setState(<span class="function">(<span class="params">state:IState,props:IProps</span>)=&gt;</span>(&#123;</span><br><span class="line">      count:state.count+<span class="number">1</span></span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="built_in">this</span>.setState(<span class="function">(<span class="params">state:IState,props:IProps</span>)=&gt;</span>(&#123;</span><br><span class="line">      count:state.count+<span class="number">1</span></span><br><span class="line">    &#125;))</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>state的更新既可能是同步的，也可能是异步的。 准确地说，在React内部机制能检测到的地方, setState就是异步的；在React检测不到的地方，例如setInterval、setTimeout里，setState就是同步更新的。</p>
</blockquote>
<h4 id="c-获取更新之后的state数据"><a href="#c-获取更新之后的state数据" class="headerlink" title="c) 获取更新之后的state数据"></a>c) 获取更新之后的state数据</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.setState(</span><br><span class="line">    &#123; <span class="attr">data</span>: newData &#125;,</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        <span class="comment">//这里打印的是最新的state值</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.data);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="d-setState的实现过程"><a href="#d-setState的实现过程" class="headerlink" title="d) setState的实现过程"></a>d) setState的实现过程</h4><p><img src="assets/3941614716-5b13d6d716035_articlex.png" alt="3941614716-5b13d6d716035_articlex"></p>
<h2 id="3-2-使用构造函数来创建组件"><a href="#3-2-使用构造函数来创建组件" class="headerlink" title="3.2 使用构造函数来创建组件"></a>3.2 使用构造函数来创建组件</h2><h3 id="3-2-1-基本使用"><a href="#3-2-1-基本使用" class="headerlink" title="3.2.1 基本使用"></a>3.2.1 基本使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#1. 新建Hello.tsx，并导出组件</span><br><span class="line"><span class="keyword">import</span> React, &#123; MouseEvent, FC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  name?: string;</span><br><span class="line">  age?: number;</span><br><span class="line">  gender?: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Hello: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 如果 在一个组件中 return 一个 null。则表示此组件是空的，什么都不会渲染</span></span><br><span class="line">  <span class="comment">// return null</span></span><br><span class="line">  <span class="comment">// 在组件中，必须 返回一个 合法的 JSX 虚拟DOM元素</span></span><br><span class="line">  <span class="comment">// props.name = &#x27;zs&#x27;</span></span><br><span class="line">  <span class="built_in">console</span>.log(props)</span><br><span class="line">  <span class="comment">// 结论：不论是 Vue 还是 React，组件中的 props 永远都是只读的；不能被重新赋值；</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>这是 Hello 组件 --- &#123;props.name&#125; --- &#123;props.age&#125; --- &#123;props.gender&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Hello;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2.导入Hello.jsx</span><br><span class="line">  <span class="comment">// 1. 导入包</span></span><br><span class="line">  <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line">  <span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line">  <span class="comment">// 注意： 这里的 @ 符号，表示 项目根目录中的 src 这一层目录</span></span><br><span class="line">  <span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">&#x27;@/components/Hello.jsx&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> dog = &#123;</span><br><span class="line">    name: <span class="string">&#x27;大黄&#x27;</span>,</span><br><span class="line">    age: <span class="number">3</span>,</span><br><span class="line">    gender: <span class="string">&#x27;雄&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ReactDOM.render(&lt;div&gt;</span><br><span class="line">    <span class="number">123</span></span><br><span class="line">    &lt;Hello &#123;...dog&#125;&gt;&lt;/Hello&gt;</span><br><span class="line">  &lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-函数组件中的state"><a href="#3-2-2-函数组件中的state" class="headerlink" title="3.2.2 函数组件中的state"></a>3.2.2 函数组件中的state</h3><blockquote>
<p>React 16.7.0开始推行Hook，到 React 16.8.0 Hook 稳定，Hooks开始被推广使用，它解决了传统使用生命周期而导致的相关代码逻辑分离(例如创建订阅及取消订阅)、不相关代码逻辑混合在一个生命周期中(使用多个Effect)、class中复杂的this指向、class不能被很好的压缩、class可能导致热重载不稳定</p>
</blockquote>
<blockquote>
<p>Hook为开发者提供了可以使用function创建微state，且一个state由一个对应的函数管理，还提供了专门处理副作用、实现redux、性能优化等功能，并且100%向后兼容，个人认为Hook是react未来发展的趋势，但并不意味着摒弃class，react也没有移除class的计划。</p>
</blockquote>
<p><code>useState</code> 就是一个 <em>Hook</em> ，通过在函数组件里调用它来给组件添加一些内部 state。React 会在重复渲染时保留这个 state。</p>
<p><code>useState</code> 会返回一对值：<strong>当前</strong>状态和一个让你更新它的函数，你可以在事件处理函数中或其他一些地方调用这个函数。它类似 class 组件的 <code>this.setState</code>，但是它不会把新的 state 和旧的 state 进行合并。</p>
<blockquote>
<ol>
<li><p>一般来说，一个函数组件，在函数退出后变量就会”消失”，但是 state 中的变量会被 React 保留。</p>
</li>
<li><p>当我们点击按钮，调用setCount函数时，React会重新渲染这个组件，并把更新的count值传给这个组件。(其实是每次 Render 都有自己的 Props 与 State)</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018639033#item-2-5">https://segmentfault.com/a/1190000018639033#item-2-5</a></p>
</li>
<li><p>useState()接受一个参数为默认值，该方法返回一个数组，第一个值为定义data的值，第二个为更新data的方法，他们总是成对出现的</p>
</li>
</ol>
</blockquote>
<h3 id="3-2-3-state-hook基本使用"><a href="#3-2-3-state-hook基本使用" class="headerlink" title="3.2.3  state hook基本使用"></a>3.2.3  state hook基本使用</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo1: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//count代表state的变量</span></span><br><span class="line">  <span class="comment">//setCount是一个function，如果我们要修改count变量，需要通过setCount来修改</span></span><br><span class="line">  <span class="keyword">let</span> [count, setCount] = useState&lt;number&gt;(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">let</span> [count2, setCount2] = useState&lt;number&gt;(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">let</span> [count3, setCount3] = useState&lt;number&gt;(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &#123;count&#125;</span><br><span class="line">    &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123; setCount(++count) &#125;&#125;&gt;点我修改count&lt;/button&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &#123;count2&#125;</span><br><span class="line">    &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123; setCount2(++count2) &#125;&#125;&gt;点我修改count2&lt;/button&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &#123;count3&#125;</span><br><span class="line">    &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123; setCount3(++count3) &#125;&#125;&gt;点我修改count3&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo1;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-4-useState使用注意点"><a href="#3-2-4-useState使用注意点" class="headerlink" title="3.2.4 useState使用注意点"></a>3.2.4 useState使用注意点</h3><h4 id="a-useState是异步的"><a href="#a-useState是异步的" class="headerlink" title="a) useState是异步的"></a>a) <code>useState</code>是异步的</h4><p>修改state之后无法拿到最新的状态，要等到下一个事件循环周期执行时，状态才是最新的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo1: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [people, setPeople] = useState&lt;&#123; <span class="attr">name</span>: string, <span class="attr">age</span>: number &#125;&gt;(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">12</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleUpdate = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setPeople(&#123; ...people, <span class="attr">name</span>: <span class="string">&#x27;王五&#x27;</span> &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(people.name); <span class="comment">// 张三</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &#123;people.name&#125;</span><br><span class="line">    &lt;button onClick=&#123;handleUpdate&#125;&gt; 修改name&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo1;</span><br></pre></td></tr></table></figure>

<p>但是在state不影响DOM的前提下，你是可以同步使用它</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Demo1: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [people, setPeople] = useState&lt;&#123; <span class="attr">name</span>: string, <span class="attr">age</span>: number &#125;&gt;(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">12</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleUpdate = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setPeople(&#123; ...people, <span class="attr">name</span>: <span class="string">&#x27;王五&#x27;</span> &#125;);</span><br><span class="line">    people.name = <span class="string">&quot;王五&quot;</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(people.name); <span class="comment">// 王五</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &#123;people.name&#125;</span><br><span class="line">    &lt;button onClick=&#123;handleUpdate&#125;&gt; 修改name&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo1;</span><br></pre></td></tr></table></figure>

<h4 id="b-useState中的数据务必是immutable数据"><a href="#b-useState中的数据务必是immutable数据" class="headerlink" title="b) useState中的数据务必是immutable数据"></a>b) <code>useState</code>中的数据务必是<code>immutable</code>数据</h4><p>若两次传入同一对象则不会触发组件更新，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo1: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState&lt;number[]&gt;([<span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>])</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;list.map((item, idx) =&gt; &lt;li key=&#123;String(idx)&#125;&gt;&#123;item&#125;&lt;/li&gt;)&#125;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;/* sort 不生成副本，直接返回原数组 */&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setList(list.sort((a, b) =&gt; a - b)) &#125;&#125;&gt;sort<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;/* slice 返回一个新的副本数组 */&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setList(list.slice().sort((a, b) =&gt; a - b)) &#125;&#125;&gt;slice<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo1;</span><br></pre></td></tr></table></figure>

<p>点击sort按钮后并不会出发更新！</p>
<ul>
<li><p><code>useState</code>对应的 setState对state地改变生效，无论DOM是否使用了<code>state</code>，该组件都会重新渲染；</p>
</li>
<li><p>useState 是将新值直接覆盖掉旧值，而不是合并</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [temp,setTemp] = useState(&#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>&#125;);</span><br><span class="line">setTemp(&#123;<span class="attr">a</span>: <span class="number">2</span>&#125;); <span class="comment">// temp = &#123;a: 2&#125;</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="3-3-两种创建组件方式的对比"><a href="#3-3-两种创建组件方式的对比" class="headerlink" title="3.3 两种创建组件方式的对比"></a>3.3 两种创建组件方式的对比</h2><ol>
<li>用<strong>构造函数</strong>创建出来的组件：叫做“无状态组件”，只有props，没有自己的私有数据和生命周期函数</li>
<li>用<strong>class关键字</strong>创建出来的组件：叫做“有状态组件”，有私有数据和生命周期函数</li>
<li>无状态组件的本质只是一个render函数，其没有实例化的过程，故而也无法访问组件对象</li>
</ol>
<blockquote>
<p>有状态组件和无状态组件之间的<strong>本质区别</strong>就是：有无state属性！无状态组件由于没有私有数据和生命周期函数，运行效率会比有状态组件高一些。</p>
<p>在react hooks中，允许我们通过useState这个hook给函数组件添加状态</p>
</blockquote>
<h2 id="3-4-条件渲染"><a href="#3-4-条件渲染" class="headerlink" title="3.4 条件渲染"></a>3.4 条件渲染</h2><h3 id="3-4-1-通过if来进行条件渲染"><a href="#3-4-1-通过if来进行条件渲染" class="headerlink" title="3.4.1 通过if来进行条件渲染"></a>3.4.1 通过if来进行条件渲染</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/crystalqy/article/details/79066347">https://blog.csdn.net/crystalqy/article/details/79066347</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gretting.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  isLoggedIn?:boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Gretting: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isLoggedIn = props.isLoggedIn;</span><br><span class="line">  <span class="keyword">if</span> (isLoggedIn) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>已登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>未登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Gretting;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">  &lt;Gretting isLoggedIn=&#123;<span class="literal">false</span>&#125;&gt;&lt;/Gretting&gt;</span><br><span class="line">&lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="3-4-2-通过三元运算符条件渲染"><a href="#3-4-2-通过三元运算符条件渲染" class="headerlink" title="3.4.2 通过三元运算符条件渲染"></a>3.4.2 通过三元运算符条件渲染</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  isLoggedIn?:boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Gretting: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isLoggedIn = props.isLoggedIn;</span><br><span class="line">  <span class="keyword">return</span> isLoggedIn?<span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>已登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>:<span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>未登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Gretting;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-3-阻止组件渲染"><a href="#3-4-3-阻止组件渲染" class="headerlink" title="3.4.3 阻止组件渲染"></a>3.4.3 阻止组件渲染</h3><p>在极少数情况下，你可能希望能隐藏组件，即使它已经被其他组件渲染。若要完成此操作，你可以让 <code>render</code> 方法直接返回 <code>null</code>，而不进行任何渲染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  isLoggedIn?:boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Gretting: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isLoggedIn = props.isLoggedIn;</span><br><span class="line">  <span class="keyword">if</span> (!isLoggedIn) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;已登录&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Gretting;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-4-通过-amp-amp-进行条件渲染"><a href="#3-4-4-通过-amp-amp-进行条件渲染" class="headerlink" title="3.4.4 通过&amp;&amp;进行条件渲染"></a>3.4.4 通过&amp;&amp;进行条件渲染</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Mailbox.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  unreadMessages?: string[]</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//解构赋值  如果没有给unreadMessages指定值的时候，默认用[]</span></span><br><span class="line"><span class="keyword">const</span> Mailbox: FC&lt;Props&gt; = <span class="function">(<span class="params">&#123;unreadMessages=[]&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Hello!&lt;/h1&gt;</span><br><span class="line">      &#123;unreadMessages.length &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        &lt;h2&gt;</span><br><span class="line">          You have &#123;unreadMessages.length&#125; unread messages.</span><br><span class="line">        &lt;/h2&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Mailbox;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line"><span class="keyword">const</span> messages = [<span class="string">&#x27;React&#x27;</span>, <span class="string">&#x27;Re: React&#x27;</span>, <span class="string">&#x27;Re:Re: React&#x27;</span>];</span><br><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">  &lt;Mailbox unreadMessages=&#123;messages&#125;&gt;&lt;/Mailbox&gt;</span><br><span class="line">&lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h2 id="3-5-列表渲染"><a href="#3-5-列表渲染" class="headerlink" title="3.5 列表渲染"></a>3.5 列表渲染</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//NumberList.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  numbers?:number[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//key 帮助 React 识别哪些元素改变了，比如被添加或删除。因此你应当给数组中的每一个元素赋予一个确定的标识。</span></span><br><span class="line"><span class="comment">//一个元素的 key 最好是这个元素在列表中拥有的一个独一无二的字符串。通常，我们使用来自数据 id 来作为元素的 key。key在兄弟节点之间必须唯一</span></span><br><span class="line"><span class="comment">//当元素没有确定 id 的时候，万不得已你可以使用元素索引 index 作为 key：</span></span><br><span class="line"><span class="keyword">const</span> NumberList: FC&lt;Props&gt; = <span class="function">(<span class="params">&#123;numbers=[]&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> listItems = numbers.map(<span class="function">(<span class="params">number</span>) =&gt;</span></span><br><span class="line">    &lt;li key=&#123;number.toString()&#125;&gt;</span><br><span class="line">      &#123;number&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ul&gt;&#123;listItems&#125;&lt;/ul&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> NumberList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">  &lt;NumberList numbers=&#123;numbers&#125;&gt;&lt;/NumberList&gt;</span><br><span class="line">&lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h2 id="3-6-Fragment的使用"><a href="#3-6-Fragment的使用" class="headerlink" title="3.6 Fragment的使用"></a>3.6 Fragment的使用</h2><p>有时，语义化的 HTML 会被破坏。比如当在 JSX 中使用 <code>&lt;div&gt;</code> 元素来实现 React 代码功能的时候，又或是在使用列表（<code>&lt;ol&gt;</code>， <code>&lt;ul&gt;</code> 和 <code>&lt;dl&gt;</code>）和 HTML <code>&lt;table&gt;</code> 时。 在这种情况下，我们应该使用 <a target="_blank" rel="noopener" href="https://react.docschina.org/docs/fragments.html">React Fragments</a> 来组合各个组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ListItem.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//这边把?去掉，表示父组件在使用当前组件的时候item必传</span></span><br><span class="line">type Props = &#123;</span><br><span class="line">  item: &#123; <span class="attr">term</span>: string, <span class="attr">description</span>: string &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ListItem: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> item = props.item;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;React.Fragment&gt;</span><br><span class="line">      &lt;dt&gt;&#123;item.term&#125;&lt;/dt&gt;</span><br><span class="line">      &lt;dd&gt;&#123;item.description&#125;&lt;/dd&gt;</span><br><span class="line">    &lt;/React.Fragment&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ListItem;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line"><span class="keyword">const</span> items = [</span><br><span class="line">  &#123;</span><br><span class="line">    term: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    description: <span class="string">&quot;描述1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    term: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">    description: <span class="string">&quot;描述2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">  &lt;dl&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      items.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">        &lt;ListItem item=&#123;item&#125; key=&#123;item.term&#125; /&gt;</span><br><span class="line">      ))</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/dl&gt;</span><br><span class="line">&lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h2 id="3-7-React组合"><a href="#3-7-React组合" class="headerlink" title="3.7 React组合"></a>3.7 React组合</h2><p>react组合类似于Vue中的slot(插槽)，子组件的内容由父组件来指定</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FancyBorder.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  color?:string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FancyBorder: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div style=&#123;&#123;<span class="attr">color</span>:props.color&#125;&#125;&gt;</span><br><span class="line">      &#123;<span class="comment">/*子组件：占坑*/</span>&#125;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> FancyBorder;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">  &lt;FancyBorder color=<span class="string">&quot;blue&quot;</span>&gt;</span><br><span class="line">    &lt;div&gt;孩儿们&lt;/div&gt;</span><br><span class="line">  &lt;/FancyBorder&gt;</span><br><span class="line">&lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>少数情况下，你可能需要在一个组件中预留出几个“洞”。这种情况下，我们可以不使用 children，而是自行约定：将所需内容传入 props，并使用相应的 prop。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SplitPane.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; MouseEvent, FC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  left?:JSX.Element,</span><br><span class="line">  right?:JSX.Element</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SplitPane: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;SplitPane&quot;</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;SplitPane-left&quot;</span>&gt;</span><br><span class="line">        &#123;props.left&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;SplitPane-right&quot;</span>&gt;</span><br><span class="line">        &#123;props.right&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> SplitPane;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">  &lt;SplitPane</span><br><span class="line">    left=&#123;</span><br><span class="line">      &lt;div&gt;左边&lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    right=&#123;</span><br><span class="line">      &lt;div&gt;右边&lt;/div&gt;</span><br><span class="line">    &#125; /&gt;</span><br><span class="line">&lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h1 id="4-评论列表案例"><a href="#4-评论列表案例" class="headerlink" title="4. 评论列表案例"></a>4. 评论列表案例</h1><h2 id="4-1-启用sass"><a href="#4-1-启用sass" class="headerlink" title="4.1 启用sass"></a>4.1 启用sass</h2><p><a href="mailto:&#114;&#101;&#97;&#x63;&#x74;&#x2d;&#x73;&#x63;&#114;&#x69;&#x70;&#x74;&#115;&#x40;&#50;&#46;&#48;&#46;&#48;">&#114;&#101;&#97;&#x63;&#x74;&#x2d;&#x73;&#x63;&#114;&#x69;&#x70;&#x74;&#115;&#x40;&#50;&#46;&#48;&#46;&#48;</a> 以上版本才适用。</p>
<p>react-scripts主要设计原理是将配置好的如 <code>Webpack，Babel，ESLint</code> ，合并到 <code>react-scripts</code> 这npm包中，用户就可以开箱即用。很多开发者都在这基础上进行改造开发。注意 <code>react-scripts</code> 就是create-react-app脚手架的核心配置代码。</p>
<h3 id="4-1-1-安装依赖"><a href="#4-1-1-安装依赖" class="headerlink" title="4.1.1 安装依赖"></a>4.1.1 安装依赖</h3><p>要使用Sass必须首先安装   <code>node-sass</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ npm install node-sass --save</span><br><span class="line">$ # or</span><br><span class="line">$ yarn add node-sass</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;配置node-sass的二进制包</span><br><span class="line">npm config set sass_binary_site https:&#x2F;&#x2F;npm.taobao.org&#x2F;mirrors&#x2F;node-sass&#x2F;</span><br></pre></td></tr></table></figure>

<p>安装完之后，我们就可以直接在组件中引入scss文件了。</p>
<h3 id="4-1-2-在sass文件中引入其他sass文件"><a href="#4-1-2-在sass文件中引入其他sass文件" class="headerlink" title="4.1.2 在sass文件中引入其他sass文件"></a>4.1.2 在sass文件中引入其他sass文件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">&#x27;styles/colors.scss&#x27;</span>;   <span class="comment">//这边路径以当前文件路径为参照</span></span><br></pre></td></tr></table></figure>

<h2 id="4-2-案例完成"><a href="#4-2-案例完成" class="headerlink" title="4.2 案例完成"></a>4.2 案例完成</h2><p>思路：父组件中套了若干个评论Item子组件，所以需要创建两个组件，分别是：CmtList和CmtItem</p>
<h3 id="4-2-1-CmtList-tsx"><a href="#4-2-1-CmtList-tsx" class="headerlink" title="4.2.1 CmtList.tsx"></a>4.2.1 CmtList.tsx</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> CmtItem <span class="keyword">from</span> <span class="string">&quot;./CmtItem&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./CmtList.scss&quot;</span>;</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CmtList: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [commentList, SetCommentList] = useState([</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">user</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;哈哈，沙发&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">user</span>: <span class="string">&#x27;李四&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;哈哈，板凳&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">user</span>: <span class="string">&#x27;王五&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;哈哈，凉席&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">user</span>: <span class="string">&#x27;赵六&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;哈哈，砖头&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">5</span>, <span class="attr">user</span>: <span class="string">&#x27;田七&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;哈哈，楼下山炮&#x27;</span> &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &#123;<span class="comment">/* 样式的第一种写法：直接用行内样式 */</span>&#125;</span><br><span class="line">    &#123;<span class="comment">/* &lt;h1 style=&#123;&#123; color: &#x27;red&#x27;, fontSize: &#x27;35px&#x27;, zIndex: 3, fontWeight: 200, textAlign: &#x27;center&#x27; &#125;&#125;&gt;这是评论列表组件&lt;/h1&gt; */</span>&#125;</span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;这是评论列表组件&lt;/h1&gt;</span><br><span class="line">    &#123;commentList.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">CmtItem</span> &#123;<span class="attr">...item</span>&#125; <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">CmtItem</span>&gt;</span></span>)&#125;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CmtList;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-2-CmtList-scss"><a href="#4-2-2-CmtList-scss" class="headerlink" title="4.2.2 CmtList.scss"></a>4.2.2 CmtList.scss</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>:red;</span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">35px</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>:<span class="number">200</span>;</span><br><span class="line">  <span class="attribute">text-align</span>:center;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-CmtItem-tsx"><a href="#4-2-3-CmtItem-tsx" class="headerlink" title="4.2.3 CmtItem.tsx"></a>4.2.3 CmtItem.tsx</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./CmtItem.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  user?: string,</span><br><span class="line">  content?: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CmtItem: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;user&quot;</span>&gt;</span>评论人：&#123;props.user&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;content&quot;</span>&gt;</span>评论内容：&#123;props.content&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CmtItem;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-4-CmtItem-scss"><a href="#4-2-4-CmtItem-scss" class="headerlink" title="4.2.4 CmtItem.scss"></a>4.2.4 CmtItem.scss</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> dashed <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="number">#ccc</span>;</span><br><span class="line">  </span><br><span class="line">  .user&#123;</span><br><span class="line">    <span class="selector-tag">font-size</span>: 14<span class="selector-tag">px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.content</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-5-问题"><a href="#4-2-5-问题" class="headerlink" title="4.2.5 问题"></a>4.2.5 问题</h3><p>当我们在CmtList.css中指定了h1标签的样式的时候，我们发现  <code>import &quot;./CmtList.scss&quot;;&#39;</code> 之后，CmtList和CmtItem中的h1标签都变成了倾斜，说明CmtList中的样式全局生效了。原因在于webpack进行打包的时候会将所有内容打包到一个js文件，所以打包后的样式会全局生效。</p>
<h2 id="4-3-使用CSS模块化"><a href="#4-3-使用CSS模块化" class="headerlink" title="4.3 使用CSS模块化"></a>4.3 使用CSS模块化</h2><p>在cra脚手架中，如果某个样式文件要开启模块化，只需要把样式文件命名为xx.module.css/xx.module.scss就可以了</p>
<h3 id="4-3-1-CmtList-module-scss"><a href="#4-3-1-CmtList-module-scss" class="headerlink" title="4.3.1 CmtList.module.scss"></a>4.3.1 CmtList.module.scss</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* css 模块化只针对类选择器 和 Id选择器生效， 不会对标签选择器模块化 */</span></span><br><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>:red;</span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">35px</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>:<span class="number">200</span>;</span><br><span class="line">  <span class="attribute">text-align</span>:center;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 注意： 被 :local() 包裹起来的类名会被模块化； 默认情况下所有的类和id选择器都会被模块化了； */</span></span><br><span class="line"><span class="selector-class">.title</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 注意：被 :global() 包裹起来的类名，不会被模块化，而是会全局生效； */</span> </span><br><span class="line"><span class="selector-pseudo">:global(.test)</span>&#123;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-2-CmtList-tsx"><a href="#4-3-2-CmtList-tsx" class="headerlink" title="4.3.2 CmtList.tsx"></a>4.3.2 CmtList.tsx</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cssObj <span class="keyword">from</span>  <span class="string">&#x27;./CmtList.module.scss&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(cssObj)</span><br><span class="line"></span><br><span class="line"> &lt;h1 className=&#123;cssObj.title&#125;&gt;这是评论列表组件&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-3-总结"><a href="#4-3-3-总结" class="headerlink" title="4.3.3 总结"></a>4.3.3 总结</h3><ol>
<li>使用 <code>:local()</code> 和 <code>:global()</code><ul>
<li><code>:local()</code>包裹的类名，是被模块化的类名，只能通过<code>className=&#123;cssObj.类名&#125;</code>来使用。<code>:local</code>可以省略</li>
<li><code>:global()</code>包裹的类名，是全局生效的，不会被 <code>css-modules</code> 控制，定义的类名是什么，就是使用定义的类名<code>className=&quot;类名&quot;</code></li>
</ul>
</li>
<li>注意：只有<code>.title</code>这样的类样式或者id选择器，才会被模块化控制，类似于<code>body</code>这样的标签选择器，不会被模块化控制；</li>
</ol>
<h2 id="4-4-React父子组件的通信"><a href="#4-4-React父子组件的通信" class="headerlink" title="4.4 React父子组件的通信"></a>4.4 React父子组件的通信</h2><h3 id="4-4-1-父组件传递给子组件"><a href="#4-4-1-父组件传递给子组件" class="headerlink" title="4.4.1 父组件传递给子组件"></a>4.4.1 父组件传递给子组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line">&lt;CMTItem key=&#123;i&#125; &#123;...item&#125;&lt;/CMTItem&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子组件通过props可以获取到父组件传递过来的数据</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-2-子组件传递给父组件"><a href="#4-4-2-子组件传递给父组件" class="headerlink" title="4.4.2 子组件传递给父组件"></a>4.4.2 子组件传递给父组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line"> &lt;CMTBox reload=&#123;loadCmts&#125;&gt;&lt;/CMTBox&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子组件通过props.reload() 来调用父组件的方法，调用的时候可以传递参数</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-3-评论列表发表评论"><a href="#4-4-3-评论列表发表评论" class="headerlink" title="4.4.3 评论列表发表评论"></a>4.4.3 评论列表发表评论</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">#1.CmtList.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> CmtItem <span class="keyword">from</span> <span class="string">&quot;./CmtItem&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> CmtBox <span class="keyword">from</span> <span class="string">&quot;./CmtBox&quot;</span>;</span><br><span class="line"><span class="comment">// import &quot;./CmtList.scss&quot;;</span></span><br><span class="line"><span class="keyword">import</span> cssObj <span class="keyword">from</span> <span class="string">&#x27;./CmtList.module.scss&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(cssObj)</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CmtList: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [commentList, SetCommentList] = useState([</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">user</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;哈哈，沙发&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">user</span>: <span class="string">&#x27;李四&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;哈哈，板凳&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">user</span>: <span class="string">&#x27;王五&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;哈哈，凉席&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">user</span>: <span class="string">&#x27;赵六&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;哈哈，砖头&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">5</span>, <span class="attr">user</span>: <span class="string">&#x27;田七&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;哈哈，楼下山炮&#x27;</span> &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> reload = <span class="function">(<span class="params">obj:&#123;id:number,user:string,content:string&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    SetCommentList([...commentList, obj])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &#123;<span class="comment">/* 样式的第一种写法：直接用行内样式 */</span>&#125;</span><br><span class="line">    &#123;<span class="comment">/* &lt;h1 style=&#123;&#123; color: &#x27;red&#x27;, fontSize: &#x27;35px&#x27;, zIndex: 3, fontWeight: 200, textAlign: &#x27;center&#x27; &#125;&#125;&gt;这是评论列表组件&lt;/h1&gt; */</span>&#125;</span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;这是评论列表组件&lt;/h1&gt;</span><br><span class="line">    &#123;commentList.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">CmtItem</span> &#123;<span class="attr">...item</span>&#125; <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">CmtItem</span>&gt;</span></span>)&#125;</span><br><span class="line">    &lt;CmtBox reload=&#123;reload&#125;&gt;&lt;/CmtBox&gt;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CmtList;</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">#2.CmtItem.jsx</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./CmtItem.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">CmtItem</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;user&quot;</span>&gt;</span>评论人：&#123;props.user&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;content&quot;</span>&gt;</span>评论内容：&#123;props.content&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#3.CmtBox.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./CmtItem.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  reload?(obj: <span class="built_in">Object</span>): <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CmtBox: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = useState&lt;string&gt;(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [content, setContent] = useState&lt;string&gt;(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//操作的是哪个文本框就去修改哪个文本框的数据</span></span><br><span class="line">  <span class="keyword">const</span> changeHandler = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> tag = e.currentTarget.id;</span><br><span class="line">    <span class="keyword">if</span> (tag == <span class="string">&quot;user&quot;</span>) &#123;</span><br><span class="line">      setUser(e.currentTarget.value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      setContent(e.currentTarget.value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> postComment = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user &amp;&amp; content) &#123;</span><br><span class="line">      props.reload &amp;&amp; props.reload(&#123;</span><br><span class="line">        user,</span><br><span class="line">        content,</span><br><span class="line">        id: <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * <span class="number">1000</span> + <span class="string">&#x27;&#x27;</span>) + <span class="number">100</span></span><br><span class="line">      &#125;)</span><br><span class="line">      setUser(<span class="string">&quot;&quot;</span>);</span><br><span class="line">      setContent(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &lt;label htmlFor=<span class="string">&quot;user&quot;</span>&gt;用户名&lt;/label&gt;</span><br><span class="line">    &lt;input id=<span class="string">&quot;user&quot;</span> type=<span class="string">&quot;text&quot;</span> value=&#123;user&#125; onChange=&#123;changeHandler&#125;&gt;&lt;/input&gt;</span><br><span class="line"></span><br><span class="line">    &lt;label htmlFor=<span class="string">&quot;content&quot;</span>&gt;内容&lt;/label&gt;</span><br><span class="line">    &lt;input id=<span class="string">&quot;content&quot;</span> type=<span class="string">&quot;text&quot;</span> value=&#123;content&#125; onChange=&#123;changeHandler&#125;&gt;&lt;/input&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;发表评论&quot;</span> onClick=&#123;<span class="function">() =&gt;</span> postComment()&#125; /&gt;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CmtBox;</span><br></pre></td></tr></table></figure>

<h1 id="5-React-事件处理"><a href="#5-React-事件处理" class="headerlink" title="5. React 事件处理"></a>5. React 事件处理</h1><p><a target="_blank" rel="noopener" href="https://reactjs.org/docs/events.html">https://reactjs.org/docs/events.html</a></p>
<h2 id="5-1-函数组件的事件绑定"><a href="#5-1-函数组件的事件绑定" class="headerlink" title="5.1 函数组件的事件绑定"></a>5.1 函数组件的事件绑定</h2><ol>
<li><p>事件的名称都是React的提供的，因此名称的首字母必须大写<code>onClick</code>、<code>onMouseOver</code></p>
</li>
<li><p>为事件提供的处理函数，必须是如下格式 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123; <span class="function"><span class="keyword">function</span> &#125;&gt;按钮&lt;/<span class="title">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>事件绑定方式：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> show = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;show方法&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> show2 = <span class="function">(<span class="params">msg:string</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;show2方法&quot;</span>, msg)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &lt;button onClick=&#123;show&#125;&gt;按钮&lt;/button&gt;</span><br><span class="line">    &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123; show2(<span class="string">&quot;参数&quot;</span>) &#125;&#125;&gt;按钮<span class="number">2</span>&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
</ol>
<h2 id="5-2-绑定文本框与state中的值"><a href="#5-2-绑定文本框与state中的值" class="headerlink" title="5.2 绑定文本框与state中的值"></a>5.2 绑定文本框与state中的值</h2><ol>
<li><p>在Vue中提供了<code>v-model</code>指令，可以很方便的实现 <code>数据的双向绑定</code>；</p>
</li>
<li><p>但是在React中只是<code>单向数据流</code>，也就是只能把state上的数据绑定到页面，无法把页面中数据的变化自动同步回 state ； 如果需要把页面上数据的变化保存到 state，则需要程序员手动监听<code>onChange</code>事件，拿到最新的数据，手动调用<code>this.setState(&#123;  &#125;)</code> 更改回去。 这种方式叫受控组件</p>
</li>
</ol>
<h3 id="5-2-1-表单受控组件"><a href="#5-2-1-表单受控组件" class="headerlink" title="5.2.1 表单受控组件"></a>5.2.1 表单受控组件</h3><p>在 HTML 中，表单元素（如<code>&lt;input&gt;</code>、 <code>&lt;textarea&gt;</code> 和 <code>&lt;select&gt;</code>）之类的表单元素通常自己维护 state，并根据用户输入进行更新。而在 React 中，可变状态（mutable state）通常保存在组件的 state 属性中，并且只能通过使用 <a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/react-component.html#setstate"><code>setState()</code></a>来更新。</p>
<p>我们可以把两者结合起来，使 React 的 state 成为“唯一数据源”。渲染表单的 React 组件还控制着用户输入过程中表单发生的操作。被 React 以这种方式控制取值的表单输入元素就叫做“受控组件”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState&lt;string&gt;(<span class="string">&quot;默认数据&quot;</span>)</span><br><span class="line">  <span class="keyword">const</span> inputChange = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    setValue(e.target.value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;input value=&#123;value&#125; onChange=&#123;inputChange&#125; /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-2-表单非受控组件"><a href="#5-2-2-表单非受控组件" class="headerlink" title="5.2.2 表单非受控组件"></a>5.2.2 表单非受控组件</h3><p>在大多数情况下，我们推荐使用 <a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/forms.html#controlled-components">受控组件</a> 来处理表单数据。在一个受控组件中，表单数据是由 React 组件来管理的。另一种替代方案是使用非受控组件，这时表单数据将交由 DOM 节点来处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//引用页面元素</span></span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef&lt;HTMLInputElement&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> handleSubmit = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(inputRef.current &amp;&amp; inputRef.current.value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;text&quot;</span> ref=&#123;inputRef&#125; /&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;点我&quot;</span> onClick=&#123;handleSubmit&#125;&gt;&lt;/input&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因为非受控组件将真实数据储存在 DOM 节点中，所以在使用非受控组件时，有时候反而更容易同时集成 React 和非 React 代码。如果你不介意代码美观性，并且希望快速编写代码，使用非受控组件往往可以减少你的代码量。否则，你应该使用受控组件。</p>
<h3 id="5-2-3-受控组件和非受控组件"><a href="#5-2-3-受控组件和非受控组件" class="headerlink" title="5.2.3 受控组件和非受控组件"></a>5.2.3 受控组件和非受控组件</h3><p>“受控”和“不受控制”的术语通常指的是表单输入，但他们还可以描述任何组件数据的位置。作为props传递进组件的数据可以被认为是<strong>受控的</strong>（因为父组件控制数据）。只存在于内部状态的数据可以被认为是<strong>不受控制的</strong>（因为父类不能直接更改它）。</p>
<h2 id="5-3-Ref-Hook"><a href="#5-3-Ref-Hook" class="headerlink" title="5.3 Ref Hook"></a>5.3 Ref Hook</h2><blockquote>
<p>“ref”对象是一个通用容器，其current属性是可变的。返回的 ref 对象在组件的整个生命周期内保持不变。</p>
</blockquote>
<h3 id="5-3-1-保存dom"><a href="#5-3-1-保存dom" class="headerlink" title="5.3.1 保存dom"></a>5.3.1 保存dom</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useRef, useEffect , RefObject &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Test: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> t:RefObject&lt;HTMLDivElement&gt; = useRef&lt;HTMLDivElement&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">//相当于componentDidMount 、componentDidUpdate</span></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(t.current); <span class="comment">// div</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div ref=&#123;t&#125;&gt; ... &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Test;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-2-forwardRef"><a href="#5-3-2-forwardRef" class="headerlink" title="5.3.2 forwardRef"></a>5.3.2 forwardRef</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// father</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Son <span class="keyword">from</span> <span class="string">&#x27;./Son&#x27;</span>;</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Father: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> refContainer = useRef&lt;HTMLInputElement&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> changeInput = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      refContainer.current&amp;&amp;(refContainer.current.value=<span class="string">&#x27;啊，我被改了!&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> &gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;changeInput&#125;</span>&gt;</span>changeInput<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Son</span> <span class="attr">ref</span>=<span class="string">&#123;refContainer&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Father;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Son</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; forwardRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Son = React.forwardRef&lt;HTMLInputElement&gt;(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Son;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-3-useImperativeHandle"><a href="#5-3-3-useImperativeHandle" class="headerlink" title="5.3.3 useImperativeHandle"></a>5.3.3 useImperativeHandle</h3><blockquote>
<p><code>useImperativeHandle</code> 可以让你在使用 <code>ref</code> 时给父组件暴露的指定的值。在大多数情况下，应当避免使用 ref 这样的命令式代码。<code>useImperativeHandle</code> 应当与 <code>forwardRef</code> 一起使用</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//father</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useRef, useEffect, RefObject &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Son <span class="keyword">from</span> <span class="string">&#x27;./Son&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InputRefProps &#125; <span class="keyword">from</span> <span class="string">&quot;./type&quot;</span>;</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Father: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> refContainer = useRef&lt;InputRefProps&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> changeInput = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    refContainer.current &amp;&amp; refContainer.current.focus()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> talk = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    refContainer.current &amp;&amp; refContainer.current.talk()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> &gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;changeInput&#125;</span>&gt;</span>changeInput<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;talk&#125;</span>&gt;</span>talk<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Son</span> <span class="attr">ref</span>=<span class="string">&#123;refContainer&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Father;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Son</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; forwardRef,useRef,useImperativeHandle &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; InputRefProps &#125; <span class="keyword">from</span> <span class="string">&quot;./type&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Son = React.forwardRef&lt;InputRefProps&gt;(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//新建一个ref  将此ref绑定在本组建内的input上</span></span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef&lt;HTMLInputElement&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">//将 使得本组件input获取焦点的方法赋给父组件传递来的ref上 </span></span><br><span class="line">  useImperativeHandle(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      focus: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        inputRef.current &amp;&amp; inputRef.current.focus();</span><br><span class="line">      &#125;,</span><br><span class="line">      talk: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;hello, world!&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Son;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//type.d.ts</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> InputRefProps &#123;</span><br><span class="line">  focus(): <span class="built_in">void</span>;</span><br><span class="line">  talk():<span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-3-4-保存事件-变量"><a href="#5-3-4-保存事件-变量" class="headerlink" title="5.3.4 保存事件/变量"></a>5.3.4 保存事件/变量</h3><p>在函数组件中，因为每次re-render就意味着函数重新执行一次，因此在函数内部保持变量引用是一件我们需要思考的事情(如果普通变量，每次re-render都会被重新初始化)。</p>
<p>在前面学习useState时我们知道，使用useState定义变量，可以做到这样的事情。同样的，利用ref的.current也可以。</p>
<p>一个很常见的应用场景就是对于定时器的清除。我们需要确保setInterval的执行结果timer的引用，才能准确的清除对应的定时器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Timer:FC&lt;<span class="built_in">Object</span>&gt; = <span class="function">(<span class="params">props</span>)=&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timerRef = useRef&lt;NodeJS.Timeout&gt;();</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      timerRef.current = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;do something&#x27;</span>);</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 组件卸载时，清除定时器</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          timerRef.current &amp;&amp; <span class="built_in">clearInterval</span>(timerRef.current);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-5-useState和useRef的区别"><a href="#5-3-5-useState和useRef的区别" class="headerlink" title="5.3.5 useState和useRef的区别"></a>5.3.5 useState和useRef的区别</h3><ul>
<li>每次 Render 的内容都会形成一个快照并保留下来，因此当状态变更而 re-render 时，就形成了 N 个 Render 状态，而每个 Render 状态都拥有自己固定不变的 Props 与 State。(每次Render都有自己的Props、State、事件处理、effect，这就是<strong>Capture Value</strong> 特性)</li>
<li>利用 <code>useRef</code> 就可以绕过 Capture Value 的特性。<strong>可以认为 ref 在所有 Render 过程中保持着唯一引用，因此所有对 ref 的赋值或取值，拿到的都只有一个最终状态</strong></li>
<li>也可以简洁的认为，<code>ref</code> 是 Mutable 的，而 <code>state</code> 是 Immutable 的。</li>
</ul>
<h1 id="6-类组件的生命周期"><a href="#6-类组件的生命周期" class="headerlink" title="6. 类组件的生命周期"></a>6. 类组件的生命周期</h1><h2 id="6-1-生命周期钩子函数介绍"><a href="#6-1-生命周期钩子函数介绍" class="headerlink" title="6.1 生命周期钩子函数介绍"></a>6.1 生命周期钩子函数介绍</h2><ul>
<li><p>生命周期的概念：每个组件的实例，从创建、运行、到销毁，在这个过程中会出发一些列事件，这些事件就叫做组件的生命周期函数；</p>
</li>
<li><p>React组件生命周期(React 16.4+)分为三部分：</p>
<ul>
<li><strong>组件创建阶段</strong>：</li>
</ul>
<blockquote>
<p>static 开头的     只会执行一次</p>
<p>constructor    构造器     只会执行一次</p>
<p>getDerivedStateFromProps: 每次re-rendering之前被调用，作用：将传递的props映射到state里面       会执行多次</p>
<p>render           构建虚拟dom，但是此时虚拟dom还没有渲染到页面        会执行多次</p>
<p>componentDidMount:组建的虚拟dom已经挂载到页面                      只会执行一次</p>
</blockquote>
<ul>
<li><strong>组件运行阶段</strong>：根据 props 属性 或 state 状态的改变，有选择性的执行0到多次</li>
</ul>
<blockquote>
<p>getDerivedStateFromProps:每次re-rendering之前被调用</p>
<p>shouldComponentUpdate:组件是否需要被更新，返回值是true或者false。此时可以获取最新的props和state数据</p>
<p>render: 重新更新渲染组件的虚拟dom</p>
<p>getSnapshotBeforeUpdate：在最近一次渲染提交到 DOM 节点之前调用。它的含义是在React更新Dom元素之前，获取一个快照，它返回的结果将作为componentDidUpdate的第三个参数。一般的用法就是获取更新前的DOM。</p>
<p>componentDidUpdate: 组件完成了更新，此时页面已经是最新的了</p>
</blockquote>
<ul>
<li><strong>组件卸载阶段</strong>：只执行一次</li>
</ul>
<blockquote>
<p>componentWillUnmount: 当组件从 DOM 中移除时会调用如下方法，此时组件还可以被使用</p>
<p><img src="assets/1574654437154.png" alt="1574654437154"></p>
</blockquote>
</li>
</ul>
<p>React生命周期的回调函数总结成表格如下：<br><img src="assets/1574666830021.png" alt="1574666830021"></p>
<h2 id="6-2-生命周期函数详解"><a href="#6-2-生命周期函数详解" class="headerlink" title="6.2 生命周期函数详解"></a>6.2 生命周期函数详解</h2><blockquote>
<p>在组件创建之前，会先初始化默认的props属性，这是全局调用一次，严格地来说，这不是组件的生命周期的一部分。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">#1.Counter.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">type IProps = Readonly&lt;&#123;</span><br><span class="line">  initCount: number;</span><br><span class="line">&#125;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">msg</span>: <span class="string">&#x27;张三&#x27;</span> &#125;;</span><br><span class="line">type IState = Readonly&lt;<span class="keyword">typeof</span> initialState&gt;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span>&lt;<span class="title">IProps</span>, <span class="title">IState</span>&gt; </span>&#123;</span><br><span class="line">  readonly state: IState = initialState;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//-------------------------------组件创建阶段----------------------------------------</span></span><br><span class="line">  <span class="comment">//1.在组件的创建阶段：第一个执行的是static开头的属性</span></span><br><span class="line">  <span class="comment">//设定props的默认值：当父组件没有给子组件传递props的时候就会使用这个默认值</span></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    initCount: <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//2.在组件创建阶段，第二个执行的是构造函数 (创建一个组件对象执行一次)</span></span><br><span class="line">  <span class="comment">//构造函数的作用：主要就是用来创建组件对象</span></span><br><span class="line">  <span class="comment">//我们可以在构造函数中声明当前组件的state</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props: IProps</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数中只可以给state赋予初始值</span></span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      msg: <span class="string">&quot;李四&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数中能够通过setState()来修改state的值</span></span><br><span class="line">    <span class="comment">// this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//     msg:&quot;李四&quot;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//3.在组件的创建阶段，第三个执行的是getDerivedStateFromProps</span></span><br><span class="line">  <span class="comment">//这个方法的作用：就是将props映射到state中</span></span><br><span class="line">  <span class="comment">//在每一次re-render的时候执行</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">getDerivedStateFromProps</span>(<span class="params">nextProps: IProps, prevState: IState</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;getDerivedStateFromProps&quot;</span>, nextProps, prevState)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//4.在组件的创建阶段，第四个执行的是render()方法。(在一个组件的各种生命周期阶段中，至少执行一次)</span></span><br><span class="line">  <span class="comment">//render()方法的主要作用：在内存中构建虚拟dom(此时虚拟dom还没有被挂载到页面)</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 在render()函数中不能通过setState()来修改state状态，因为这样会陷入死循环</span></span><br><span class="line">        <span class="comment">// 其实render()函数应该是一个纯函数，这个函数的作用本身就是给他什么数据，他就显示什么数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// this.setState(&#123;</span></span><br><span class="line">        <span class="comment">//     msg:&quot;王五&quot;</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">      &#125;</span><br><span class="line">      &lt;h3&gt;&#123;<span class="built_in">this</span>.props.initCount&#125;&lt;/h3&gt;</span><br><span class="line">      &lt;h3&gt;&#123;<span class="built_in">this</span>.state.msg&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//5.在组件的创建阶段，第五个执行的是componentDidMount。(创建一个组件对象执行一次)</span></span><br><span class="line">  <span class="comment">//componentDidMount执行的时候就表示内存中的虚拟dom已经挂载到页面了，此时页面是最新的</span></span><br><span class="line">  <span class="comment">//只有componentDidMount()钩子函数才可以通过setState()来修改state</span></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//componentDidMount()方法允许我们通过setState()来修改状态</span></span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      msg: <span class="string">&quot;赵六&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;componentDidMount方法执行了&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//-------------------------------组价的运行阶段-------------------------------</span></span><br><span class="line">  <span class="comment">//当前组件的状态发生改变之后，会进入组件的运行阶段</span></span><br><span class="line">  <span class="comment">//1.在组件运行阶段，第一个执行的函数是getDerivedStateFromProps</span></span><br><span class="line">  <span class="comment">// static getDerivedStateFromProps(nextProps: IProps, prevState: IState) &#123;</span></span><br><span class="line">  <span class="comment">//   console.log(&quot;getDerivedStateFromProps&quot;, nextProps, prevState)</span></span><br><span class="line">  <span class="comment">//   return null;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//2.在组件的运行阶段，第二个执行的函数是shouldComponentUpdate。(在组件的各种生命周期阶段中，执行&gt;=0次)</span></span><br><span class="line">  <span class="comment">//作用：让程序员手动控制是否要更新组件</span></span><br><span class="line">  <span class="comment">//如果这个方法返回false，就不会更新组件(后续的生命周期函数就不会执行了)；如果这个方法返回true，就会更新组件(后续的生命周期会执行)</span></span><br><span class="line">  <span class="function"><span class="title">shouldComponentUpdate</span>(<span class="params">nextProps: IProps, nextState: IState</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// shouldComponentUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span></span><br><span class="line">    <span class="comment">// this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//     msg:&quot;王五&quot;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;shouldComponentUpdate&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//3.在组件的运行阶段，第三个执行的函数是render()函数</span></span><br><span class="line">  <span class="comment">//render()函数的作用：在内存中构建虚拟dom(此时虚拟dom还没有被挂载到页面)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//4.在组件的运行阶段，第四个执行的函数是getSnapshotBeforeUpdate。(在组件的各种生命周期阶段中，执行&gt;=0次)</span></span><br><span class="line">  <span class="comment">//主要作用：获取更新页面之前的dom信息</span></span><br><span class="line">  <span class="comment">//这个方法的返回值会作为componentDidUpdate()方法第三个参数入参  https://react.docschina.org/docs/react-component.html</span></span><br><span class="line">  <span class="function"><span class="title">getSnapshotBeforeUpdate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// getSnapshotBeforeUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span></span><br><span class="line">    <span class="comment">// this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//     msg:&quot;王五&quot;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;getSnapshotBeforeUpdate&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">aa</span>: <span class="number">123</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//5.在组件的运行阶段，第五个执行的函数是componentDidUpdate。(在组件的各种生命周期阶段中，执行&gt;=0次)</span></span><br><span class="line">  <span class="comment">//主要作用：虚拟dom已经挂载到页面，此时页面是最新的</span></span><br><span class="line">  <span class="function"><span class="title">componentDidUpdate</span>(<span class="params">prevProps: IProps, prevState: IState, snapshot: any</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// componentDidUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span></span><br><span class="line">    <span class="comment">// this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//     msg: &quot;王五&quot;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;componentDidUpdate&quot;</span>, snapshot)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//----------------------------组件的卸载阶段-----------------------------</span></span><br><span class="line">  <span class="comment">//可以在componentWillUnmount()方法中进行一些资源的释放工作。比如关闭定时器、移除事件监听。(卸载一个组件执行一次)</span></span><br><span class="line">  <span class="function"><span class="title">componentWillUnmount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;componentWillUnmount&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Counter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#App.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">&#x27;./components4/Counter&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">1</span> &#125;</span><br><span class="line">type IState = Readonly&lt;<span class="keyword">typeof</span> initialState&gt;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  readonly state: IState = initialState;</span><br><span class="line"></span><br><span class="line">  handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(<span class="function">(<span class="params">prev: IState</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        count: prev.count + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">      这是App组件</span><br><span class="line">      &#123;<span class="comment">/* &lt;Counter initCount=&#123;this.state.count&#125;&gt;&lt;/Counter&gt; */</span>&#125;</span><br><span class="line">      &lt;Counter&gt;&lt;/Counter&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="built_in">this</span>.handleClick&#125;&gt;改变count&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<h2 id="6-3-组件的重新渲染和优化"><a href="#6-3-组件的重新渲染和优化" class="headerlink" title="6.3 组件的重新渲染和优化"></a>6.3 组件的重新渲染和优化</h2><h3 id="6-3-1-类组件的re-render的时机"><a href="#6-3-1-类组件的re-render的时机" class="headerlink" title="6.3.1 类组件的re-render的时机"></a>6.3.1 类组件的re-render的时机</h3><blockquote>
<p>1.组件重新被创建</p>
<p>2.调用setState，就会触发组件的重新渲染，无论前后的state是否不同</p>
<p>3.父组件更新，子组件也会自动的更新</p>
</blockquote>
<p>也就是说只要调用setState方法(即使父组件和当前组件的state没有发生任何变化)，都会引起组件的re-render，进而触发一系列的生命周期钩子(getDerivedStateFromProps\shouldComponentUpdate\render\getSnapshotBeforeUpdate\componentDidMount\componentDidUpdate)。</p>
<p>当我们在父组件修改了与子组件无关的state，而子组件没有用到这个状态，发现子组件也会re-render，这个时候就需要借助shouldComponentUpdate钩子函数来做优化。</p>
<p>我们通常的解决方案是：</p>
<blockquote>
<ol>
<li>使用immutable进行比较，在不相等的时候调用setState；</li>
<li>在shouldComponentUpdate中判断前后的props和state，如果没有变化，则返回false来阻止更新。</li>
<li>创建一个类继承PureComponent，判断页面是否要更新的时候进行浅比较</li>
</ol>
</blockquote>
<h3 id="6-3-2-shouldComponentUpdate优化"><a href="#6-3-2-shouldComponentUpdate优化" class="headerlink" title="6.3.2 shouldComponentUpdate优化"></a>6.3.2 shouldComponentUpdate优化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//作用：让程序员手动控制是否要更新组件</span></span><br><span class="line"><span class="comment">//如果这个方法返回false，就不会更新组件(后续的生命周期函数就不会执行了)；如果这个方法返回true，就会更新组件(后续的生命周期会执行)</span></span><br><span class="line"><span class="function"><span class="title">shouldComponentUpdate</span>(<span class="params">nextProps: IProps, nextState: IState</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//当下次传递过来的initCount为偶数的时候，不更新页面。为奇数的时候更新页面</span></span><br><span class="line">    <span class="keyword">if</span>(nextProps.initCount%<span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-3-PureComponent优化"><a href="#6-3-3-PureComponent优化" class="headerlink" title="6.3.3 PureComponent优化"></a>6.3.3 PureComponent优化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ListOfWords.tsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">type IProps = Readonly&lt;&#123;</span><br><span class="line">  words: string[];</span><br><span class="line">&#125;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承React.Component的时候，视图更新通过shouldComponentUpdate完成</span></span><br><span class="line"><span class="comment">// class ListOfWords extends React.Component&lt;IProps&gt; &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承React.PureComponent的时候，视图更新通过数据源的内存地址判断完成</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListOfWords</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">PureComponent</span>&lt;<span class="title">IProps</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// shouldComponentUpdate(nextProps: IProps) &#123;</span></span><br><span class="line">  <span class="comment">//   console.log(nextProps.words,&quot;0000000000000000000000&quot;)</span></span><br><span class="line">  <span class="comment">//   return true;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">      &#123;<span class="built_in">console</span>.log(<span class="string">&quot;render&quot;</span>)&#125;</span><br><span class="line">      &#123;<span class="built_in">this</span>.props.words.join(<span class="string">&quot;-&quot;</span>)&#125;</span><br><span class="line">    &lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ListOfWords</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//App.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC, useState, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ListOfWords <span class="keyword">from</span> <span class="string">&#x27;./components4/ListOfWords&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">words</span>: [<span class="string">&#x27;marklar&#x27;</span>] &#125;</span><br><span class="line">type IState = Readonly&lt;<span class="keyword">typeof</span> initialState&gt;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  readonly state: IState = initialState;</span><br><span class="line"></span><br><span class="line">  handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 当ListOfWords组件继承React.PureComponent的时候，下面的代码不会触发视图的刷新，因为当前的words虽然修改了，但总是引用同一块内存</span></span><br><span class="line">    <span class="comment">// this.setState((prev:IState)=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//   prev.words.push(&quot;marklar&quot;)</span></span><br><span class="line">    <span class="comment">//   return &#123;</span></span><br><span class="line">    <span class="comment">//     words:prev.words</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//下面代码会触发ListOfWords视图更新，因为每次点击按钮都给words赋值一个新的数组，此时新数组和原来数组的内存地址肯定不一致，从而组件才可能更新</span></span><br><span class="line">    <span class="built_in">this</span>.setState(<span class="function">(<span class="params">prev:IState</span>)=&gt;</span>&#123;</span><br><span class="line">      prev.words.push(<span class="string">&quot;marklar&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        words:[...prev.words]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">      这是App组件</span><br><span class="line">      &lt;ListOfWords words=&#123;<span class="built_in">this</span>.state.words&#125;&gt;&lt;/ListOfWords&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="built_in">this</span>.handleClick&#125;&gt;添加words&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1.继承Component时，数据源发生变化之后，会通过shouldComponentUpdate的返回值来判断页面是否需要刷新</span></span><br><span class="line"><span class="comment">2.继承PureComponent时，数据源发生变化之后，默认进行的是浅比较(只会比较数据的内存地址是否一致)，不能再重写shouldComponentUpdate</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="6-4-getDerivedStateFromProps存在的问题"><a href="#6-4-getDerivedStateFromProps存在的问题" class="headerlink" title="6.4 getDerivedStateFromProps存在的问题"></a>6.4 getDerivedStateFromProps存在的问题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getDerivedStateFromProps 函数会在每次re-rendering之前被调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//为什么要用getDerivedStateFromProps？答案：组件接收的props数据是只读的，我们可以使用该方法将传递的props映射到state里面，实现修改(会有诸多问题)</span></span><br><span class="line"><span class="comment">//注意点：该方法是一个静态方法，方法中没有this，故而不可以直接通过this.setState()来改变状态，而是需要通过return来改变状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数：</span></span><br><span class="line"><span class="comment">//1.nextProps外部传递过来的props属性</span></span><br><span class="line"><span class="comment">//2.prevState之前的state状态</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="function"><span class="title">getDerivedStateFromProps</span>(<span class="params">nextProps, prevState</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;getDerivedStateFromProps&quot;</span>, nextProps, prevState)</span><br><span class="line">    <span class="comment">//获取到父组件中传递过来的initcount值</span></span><br><span class="line">    <span class="keyword">const</span> &#123; initcount &#125; = nextProps;</span><br><span class="line">    <span class="comment">//当父组件中传递过来的initcount发生改变了</span></span><br><span class="line">    <span class="keyword">if</span> (initcount != prevState.prevCount) &#123;</span><br><span class="line">        <span class="comment">//在方法中返回&#123;count:initcount&#125; 替换掉当前state中的 count值</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            count: initcount,</span><br><span class="line">            prevCount:initcount</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果props传入的内容不需要影响到你的state，那么就需要返回一个null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//问题：</span></span><br><span class="line"><span class="number">1.</span>当前组件的状态由多个源控制，父组件中控制列表数据，子组件中又控制了type这个state。</span><br><span class="line">因此父组件state改掉之后，会触发子组件重新渲染；本身组件state改掉之后，会触发当前组件重新渲染</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>如果你的组件内部既需要修改自己的type，又需要接收从外部修改的type。逻辑非常混乱！getDerivedStateFromProps中你根本不知道该做什么。</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (initcount != prevState.prevCount) &#123;</span><br><span class="line">    <span class="comment">//在方法中返回&#123;count:initcount&#125; 替换掉当前state中的 count值</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        count: initcount,</span><br><span class="line">        prevCount:initcount</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">如果彻底解决这个问题呢？</span><br><span class="line">答案：好好组织你的组件，在非必须的时候，摒弃这种写法(派生属性)。type要么由props驱动，要么完全由state驱动。</span><br><span class="line"></span><br><span class="line">从这个生命周期的更新来看，react更希望将受控的props和state进行分离，就如同Redux作者Dan Abramov在redux文档当中写的一样Presentational and Container Components，将所有的组件分离称为展示型组件和容器型组件，一个只负责接收props来改变自己的样式，一个负责保持其整个模块的state。这样可以让代码更加清晰。但是在实际的业务逻辑中，我们有时很难做到这一点，而且这样可能会导致容器型组件变得非常庞大以致难以管理，如何进行取舍还是需要根据实际场景决定的</span><br></pre></td></tr></table></figure>

<h2 id="6-5-React老版本生命周期"><a href="#6-5-React老版本生命周期" class="headerlink" title="6.5 React老版本生命周期"></a>6.5 React老版本生命周期</h2><p><img src="./assets/3284159097-5bbb08d17db33_articlex-1584956954768.png" alt="3284159097-5bbb08d17db33_articlex"></p>
<h1 id="7-函数组件的生命周期"><a href="#7-函数组件的生命周期" class="headerlink" title="7.函数组件的生命周期"></a>7.函数组件的生命周期</h1><h2 id="7-1-useEffect介绍"><a href="#7-1-useEffect介绍" class="headerlink" title="7.1 useEffect介绍"></a>7.1 useEffect介绍</h2><p><code>useEffect</code> 就是一个 Effect Hook，给函数组件增加了操作副作用的能力。它跟 class 组件中的 <code>componentDidMount</code>、<code>componentDidUpdate</code> 和 <code>componentWillUnmount</code> 具有相同的用途，只不过被合并成了一个 API。</p>
<p>在调用这个hook时，就是告诉React在完成对DOM的更改后运行这个hook，在这里你可以访问到state和props。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- 纯函数：如果函数的调用参数相同，则永远返回相同的结果。它不依赖于程序执行期间函数外部任何状态或数据的变化，必须只依赖于其输入参数。</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">priceAfterTax</span>(<span class="params">productPrice</span>) </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> (productPrice * <span class="number">0.20</span>) + productPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">- 副作用：一个可以被观察的副作用是在函数内部与其外部的任意交互。这可能是在函数内修改外部的变量，或者在函数里调用另外一个函数等。</span><br><span class="line">    <span class="keyword">var</span> tax = <span class="number">20</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">calculateTax</span>(<span class="params">productPrice</span>) </span>&#123;</span><br><span class="line">        tax = tax/<span class="number">100</span></span><br><span class="line">        <span class="keyword">return</span> (productPrice * tax) + productPrice;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-2-useEffect用法"><a href="#7-2-useEffect用法" class="headerlink" title="7.2 useEffect用法"></a>7.2 useEffect用法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1  componentDidMount执行一次，依赖项每次改变时执行一次</span></span><br><span class="line">useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//副作用动作</span></span><br><span class="line">&#125;,[依赖项])</span><br><span class="line"></span><br><span class="line"><span class="comment">//2  相当于componentDidMount</span></span><br><span class="line">useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//副作用动作</span></span><br><span class="line">&#125;,[])</span><br><span class="line"></span><br><span class="line"><span class="comment">//3  相当于componentDidMount 、componentDidUpdate</span></span><br><span class="line">useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//副作用动作</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="7-3-useEffect使用"><a href="#7-3-useEffect使用" class="headerlink" title="7.3 useEffect使用"></a>7.3 useEffect使用</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line">type IProps = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo2: FC&lt;IProps&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//count代表state的变量</span></span><br><span class="line">  <span class="comment">//setCount是一个function，如果我们要修改count变量，需要通过setCount来修改</span></span><br><span class="line">  <span class="keyword">let</span> [count, setCount] = useState&lt;number&gt;(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">let</span> [count2, setCount2] = useState&lt;number&gt;(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//useEffect函数可以来模拟class组件的中指定生命周期的钩子函数 componentDidMount，componentDidUpdate，componentWillUnmount</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//相当于componentDidMount 、componentDidUpdate</span></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;xxxxxxxxxxx&quot;</span>, count)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//相当于componentDidMount</span></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;yyyyyyyyy&quot;</span>)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">//相当于componentDidMount 和 当count2的值被改变之后执行当前的useEffect</span></span><br><span class="line">  <span class="comment">//其他值改变不会执行这个useEffect</span></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;zzzzzzzzzzzzz&quot;</span>)</span><br><span class="line">  &#125;, [count2])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    count的值是：&#123;count&#125;</span><br><span class="line">    &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123; setCount(++count) &#125;&#125;&gt;点我修改count&lt;/button&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    count2的值是:&#123;count2&#125;</span><br><span class="line">    &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123; setCount2(++count2) &#125;&#125;&gt;点我修改count2&lt;/button&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo2;</span><br></pre></td></tr></table></figure>

<h2 id="7-4-清除副作用"><a href="#7-4-清除副作用" class="headerlink" title="7.4 清除副作用"></a>7.4 清除副作用</h2><h3 id="a-无需清理的副作用"><a href="#a-无需清理的副作用" class="headerlink" title="a) 无需清理的副作用"></a>a) 无需清理的副作用</h3><blockquote>
<p>有时候，我们只想<strong>在 React 更新 DOM 之后运行一些额外的代码。</strong>比如发送网络请求，手动变更 DOM，记录日志，这些都是常见的无需清除的操作。因为我们在执行完这些操作之后，就可以忽略他们了。</p>
</blockquote>
<p>需求：监听url的变化来发送网络请求，保存返回结果</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ajax <span class="keyword">from</span> <span class="string">&#x27;@utils/ajax&#x27;</span></span><br><span class="line"></span><br><span class="line">type IProps = &#123;</span><br><span class="line">  location:string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Example: FC&lt;IProps&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = useState(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getData();</span><br><span class="line">  &#125;, [props.location]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getData = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ajax.post().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      setData(res);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Example;</span><br></pre></td></tr></table></figure>

<p>当location发生变化时，useEffect中函数就会自动执行</p>
<h3 id="b-需要清理的副作用"><a href="#b-需要清理的副作用" class="headerlink" title="b) 需要清理的副作用"></a>b) 需要清理的副作用</h3><blockquote>
<p>之前我们研究了如何使用不需要清除的副作用，还有一些副作用是需要清除的。例如<strong>定时器</strong>、<strong>订阅外部数据源</strong>。这种情况下，清除工作是非常重要的，可以防止引起内存泄露！</p>
</blockquote>
<p>在useEffect中可选的返回一个清除函数，该清除函数会在组件<strong>卸载</strong>时自动执行，以达到清除effect的目的；</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//useEffect函数中return的function会在组件卸载时自动执行</span></span><br><span class="line">useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//副作用动作</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//清除effect</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>使用示例</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;useEffect在组件挂载和更新的时候执行&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;定时器打印&quot;</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//如果useEffect的function中返回了一个函数，那么该函数会在组件卸载的时候执行</span></span><br><span class="line">        <span class="comment">//就相当于componentWillUnMount</span></span><br><span class="line">        <span class="comment">//现在每一次重新渲染都会返回一个新的清除函数，把上一次组件装在执行的定时器清除掉(这边由于闭包的原因，之前的定时器以及一些变量都会被释放)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function">()=&gt;</span>&#123;  </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;清除定时器&quot;</span>)  </span><br><span class="line">            timer &amp;&amp; <span class="built_in">clearInterval</span>(timer)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="c-useEffect返回清除函数的执行时机"><a href="#c-useEffect返回清除函数的执行时机" class="headerlink" title="c) useEffect返回清除函数的执行时机"></a>c) useEffect返回清除函数的执行时机</h3><p>这里是组件<strong>卸载</strong>时自动执行，当前状态下的函数组件render完之后会立即执行上一个函数状态中<code>useEffect</code>返回的清除函数，而这个清除函数中所带的参数也是处于上一个状态中（闭包的特性）。</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018639033">https://segmentfault.com/a/1190000018639033</a></p>
<blockquote>
<p>假设在组件的使用过程中，外部传入的props参数id，改变了两次，第一次传入<code>id: 1</code>， 第二次传入<code>id: 2</code></p>
<p>那么我们来梳理一下整个过程：</p>
<ol>
<li>传入<code>props.id = 1</code></li>
<li>组件渲染</li>
<li>DOM渲染完成，useEffect逻辑执行，返回清除副作用函数<code>clear，</code>命名为<code>clear1</code></li>
<li>传入<code>props.id = 2</code></li>
<li>组件渲染</li>
<li>组件渲染完成，clear1执行</li>
<li>useEffect逻辑执行，返回另一个clear函数，命名为<code>clear2</code></li>
<li>组件卸载，clear2执行</li>
</ol>
<p>执行过程有点绕，因为与你印象中的执行过程似乎不一样。其实关键的地方就在于clear函数的执行，它的特征如下：</p>
<ul>
<li>每次useEffect执行，都会返回一个新的clear函数</li>
<li>clear函数会在下一次useEffect逻辑之前执行（DOM渲染完成之后）</li>
<li>组件卸载也会执行一次</li>
</ul>
</blockquote>
<h2 id="7-5-useLayoutEffect"><a href="#7-5-useLayoutEffect" class="headerlink" title="7.5 useLayoutEffect"></a>7.5 useLayoutEffect</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useLayoutEffect( <span class="function">() =&gt;</span> &#123; &#125;, [ 依赖项 ] );</span><br></pre></td></tr></table></figure>

<p>其函数签名与 <code>useEffect</code> 相同，但它会在所有的 DOM 变更之后<strong>同步调用</strong> effect。可以使用它来读取 DOM 布局并同步触发重渲染。</p>
<p>这个是用在处理DOM的时候，当你的useEffect里面的操作需要处理DOM。并且会改变页面的样式，就需要用这个，否则可能会出现出现闪屏问题</p>
<p><a target="_blank" rel="noopener" href="https://cllxx.cn/2019/07/21/react-xin-te-xing-hooks-zhi-useeffect-he-uselayouteffect-wu/">https://cllxx.cn/2019/07/21/react-xin-te-xing-hooks-zhi-useeffect-he-uselayouteffect-wu/</a></p>
<blockquote>
<p>useEffect和useLayoutEffect的异同：</p>
<ul>
<li>useLayoutEffect是在虚拟DOM构建完成后立即执行，useEffect是在真实DOM构建完成后立即执行</li>
</ul>
<ul>
<li>useLayoutEffect是同步执行，useEffect是异步执行</li>
</ul>
</blockquote>
<h2 id="7-6-useEffect使用注意点"><a href="#7-6-useEffect使用注意点" class="headerlink" title="7.6 useEffect使用注意点"></a>7.6 useEffect使用注意点</h2><p>useEffect的函数需要返回一个cleanup的清除函数或者undefined。而当我们使用await、async的时候，会默认返回一个Promise，所以我们不能在useEffect函数中使用async</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//错误</span></span><br><span class="line">useEffect(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">     <span class="keyword">await</span> fetchSomething();</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">//正确</span></span><br><span class="line">useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> fetchSomething();</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<h1 id="8-其他常用hook"><a href="#8-其他常用hook" class="headerlink" title="8.其他常用hook"></a>8.其他常用hook</h1><h2 id="8-1-函数组件re-render的时机"><a href="#8-1-函数组件re-render的时机" class="headerlink" title="8.1 函数组件re-render的时机"></a>8.1 函数组件re-render的时机</h2><blockquote>
<ol>
<li>组件重新被创建</li>
<li>当前组件state的内存地址发生了变化</li>
<li>父组件更新，子组件也会自动的更新</li>
<li>组件更新时，会卸载所有function，并重新创建function (执行函数组件的所有逻辑)</li>
</ol>
</blockquote>
<p>也就是说，在函数组件中，只要父组件或者当前组件的state内存地址发生变化，都会触发当前组件以及当前组件的子组件re-render，无论当前组件是否使用到父组件中的state。</p>
<p>而在函数组件中，react不再区分mount和update两个状态，这意味着函数组件的每一次调用都会执行其内部的所有逻辑，那么会带来较大的性能损耗。因此useMemo 和useCallback就是解决性能问题的杀手锏。</p>
<h2 id="8-2-memo-useMemo-useCallback"><a href="#8-2-memo-useMemo-useCallback" class="headerlink" title="8.2 memo\useMemo\useCallback"></a>8.2 memo\useMemo\useCallback</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Child.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;date.toLocaleString()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Child;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC,useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent:FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count,setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;数量为:&#123;count&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">()=&gt;</span>&#123;setCount(count+<span class="number">1</span>)&#125;&#125;&gt;点我加<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">      &lt;Child&gt;&lt;/Child&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">  &lt;Parent&gt;&lt;/Parent&gt;</span><br><span class="line">&lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//案例存在的问题：每点击一次按钮，会重新渲染一次时间，说明父组件更新的时候，子组件也重新渲染了</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-1-使用memo高阶函数"><a href="#8-2-1-使用memo高阶函数" class="headerlink" title="8.2.1 使用memo高阶函数"></a>8.2.1 使用memo高阶函数</h3><p><code>React.memo()</code>是一个高阶函数，它与 <a target="_blank" rel="noopener" href="https://reactjs.org/docs/react-api.html#reactpurecomponent"><code>React.PureComponent</code></a>类似，但是一个函数组件而非一个类。</p>
<p>React.memo()可接受2个参数，第一个参数为纯函数的组件，第二个参数用于对比props控制是否刷新，与<a target="_blank" rel="noopener" href="https://reactjs.org/docs/react-component.html#shouldcomponentupdate"><code>shouldComponentUpdate()</code></a>功能类似</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Child.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC,memo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child: FC&lt;&#123;count?:number&#125;&gt; = memo(<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;date.toLocaleString()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;,<span class="function">(<span class="params">prev,next</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(prev.count,next.count); <span class="keyword">return</span> prev.count==next.count &#125;);</span><br><span class="line"> <span class="comment">//这边只要父亲传递给孩子的props发生了变化就应该刷新子组件(如果父亲没有给子组件传递props或者父亲给子组件传递的props没有改变，则子组件不应该刷新)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Child;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC,useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent:FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count,setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;数量为:&#123;count&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">()=&gt;</span>&#123;setCount(count+<span class="number">1</span>)&#125;&#125;&gt;点我加<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">      &lt;Child count=&#123;count&#125;&gt;&lt;/Child&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-2-useMemo"><a href="#8-2-2-useMemo" class="headerlink" title="8.2.2 useMemo"></a>8.2.2 useMemo</h3><h4 id="a-没有使用useMemo存在的问题"><a href="#a-没有使用useMemo存在的问题" class="headerlink" title="a) 没有使用useMemo存在的问题"></a>a) 没有使用useMemo存在的问题</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;</span><br><span class="line">    name: <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;数量为:&#123;count&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          setCount(count + <span class="number">1</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        点我加<span class="number">1</span></span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;Child obj=&#123;obj&#125;&gt;&lt;/Child&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Child.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, memo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child: FC&lt;&#123; <span class="attr">obj</span>: &#123; name?: string &#125; &#125;&gt; = memo(</span><br><span class="line">  (props) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;date.toLocaleString()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  (prev, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> prev.obj == next.obj;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Child;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//案例存在的问题：每点击一次按钮，会重新渲染一次时间，但是每一次点击按钮的时候，父组件给子组件传递的都是相同的obj对象，为什么子组件还是会刷新呢?</span></span><br><span class="line"><span class="comment">//原因是每一次点击按钮的时候，会重新刷新父组件，父组件中的obj会重新被实例化，所以新实例化的obj和上一次实例化的obj不是同一个对象</span></span><br></pre></td></tr></table></figure>

<h4 id="b-useMemo-hook"><a href="#b-useMemo-hook" class="headerlink" title="b) useMemo hook"></a>b) useMemo hook</h4><p>useMemo可以用来缓存一些变量，并指定哪些条件变化后重新计算缓存的变量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedValue = useMemo(<span class="function">() =&gt;</span> computeExpensiveValue(a, b), [a, b]);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>useMemo第一个参数是一个 factory 函数，该函数的返回结果会通过useMemo缓存下来</p>
<p>​                  第二个参数是factory函数的依赖(deps)，当依赖(deps)改变时才重新执行 factory 函数，memoizedValue 才会被重新计算</p>
</blockquote>
<p>也就是在依赖未改变时（或空数组无依赖时），memoizedValue 总是返回通过useMemo缓存的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState,useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">//使用useMemo缓存变量值  依赖项没有指定</span></span><br><span class="line">  <span class="keyword">const</span> obj = useMemo(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name: <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,[])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;数量为:&#123;count&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          setCount(count + <span class="number">1</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        点我加<span class="number">1</span></span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;Child obj=&#123;obj&#125;&gt;&lt;/Child&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-3-useCallback"><a href="#8-2-3-useCallback" class="headerlink" title="8.2.3 useCallback"></a>8.2.3 useCallback</h3><h4 id="a-没有使用useCallback的问题"><a href="#a-没有使用useCallback的问题" class="headerlink" title="a) 没有使用useCallback的问题"></a>a) 没有使用useCallback的问题</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState,useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [text,setText] = useState(<span class="string">&quot;&quot;</span>)</span><br><span class="line">  <span class="keyword">const</span> changeHandler = <span class="function">(<span class="params">event:React.ChangeEvent&lt;HTMLInputElement&gt;</span>)=&gt;</span>&#123;</span><br><span class="line">    setText(event.target.value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;text文本为:&#123;text&#125;&lt;/div&gt;</span><br><span class="line">      &lt;Child onChange=&#123;changeHandler&#125;&gt;&lt;/Child&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Child.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, memo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child: FC&lt;&#123;</span><br><span class="line">  onChange?: <span class="function">(<span class="params">event: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">&#125;&gt; = memo(<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;date.toLocaleString()&#125;</span><br><span class="line">      &lt;input type=<span class="string">&quot;text&quot;</span> onChange=&#123;props.onChange&#125;&gt;&lt;/input&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Child;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//上面代码中，我们在子组件中修改文本框的值，会触发子组件的onChange，从而触发父组件的changeHandler方法，在父组件中的changeHandler方法中修改了text文本，所以页面上的text值发生了改变。 </span></span><br><span class="line"><span class="comment">//但是除了我们发现页面上text文本改变之外，子组件中的时间也发生了改变 (说明每一次子组件输入内容的时候都会触发子组件的重新渲染)</span></span><br><span class="line"><span class="comment">//原因是每一次子组件输入内容，父组件的text文本发生变化，造成父组件被重新渲染，从而造成父组件传递给子组件的changeHandler方法(props)发生了变化，从而造成子组件的重新渲染</span></span><br></pre></td></tr></table></figure>

<h4 id="b-useCallback-hook"><a href="#b-useCallback-hook" class="headerlink" title="b) useCallback   hook"></a>b) useCallback   hook</h4><p>useMemo缓存的是值</p>
<p>useCallback缓存的是函数。有两个参数，第一个参数是需要缓存的函数，第二个参数是依赖项。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState,useCallback &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [text,setText] = useState(<span class="string">&quot;&quot;</span>)</span><br><span class="line">  <span class="comment">//使用useCallback缓存函数</span></span><br><span class="line">  <span class="keyword">const</span> changeHandler = useCallback(<span class="function">(<span class="params">event:React.ChangeEvent&lt;HTMLInputElement&gt;</span>)=&gt;</span>&#123;</span><br><span class="line">    setText(event.target.value)</span><br><span class="line">  &#125;,[])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;text文本为:&#123;text&#125;&lt;/div&gt;</span><br><span class="line">      &lt;Child onChange=&#123;changeHandler&#125;&gt;&lt;/Child&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-4-useMemo和useCallback的区别和联系"><a href="#8-2-4-useMemo和useCallback的区别和联系" class="headerlink" title="8.2.4 useMemo和useCallback的区别和联系"></a>8.2.4 useMemo和useCallback的区别和联系</h3><p>实际上<code>useCallback</code>是基于<code>useMemo</code>实现的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useCallback</span>(<span class="params">callback, args</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> useMemo(<span class="function">() =&gt;</span> callback, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>useMemo</code>是返回<code>callback</code>执行后的结果</li>
<li><code>useCallback</code> 是直接返回被<code>useMemo</code>修饰的<code>callback</code>函数</li>
</ol>
<h2 id="8-3-useReducer和useContext"><a href="#8-3-useReducer和useContext" class="headerlink" title="8.3 useReducer和useContext"></a>8.3 useReducer和useContext</h2><h3 id="8-3-1-useContext"><a href="#8-3-1-useContext" class="headerlink" title="8.3.1 useContext"></a>8.3.1 useContext</h3><blockquote>
<p>跨级组件通信，实现同一子树下所有节点可统一共享子树根节点的数据</p>
</blockquote>
<p>useContext接收一个 context 对象（<code>React.createContext</code> 的返回值）并返回该 context 的当前值。当前的 context 值由上层组件中距离当前组件最近的 <code>&lt;MyContext.Provider&gt;</code> 的 <code>value</code> 决定。</p>
<p>当组件上层最近的 <code>&lt;MyContext.Provider&gt;</code> 更新时，该 Hook 会触发重渲染，并使用最新传递给 <code>MyContext</code> provider 的 context <code>value</code> 值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = useContext(MyContext);</span><br></pre></td></tr></table></figure>

<p>基本用法：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#1.index.jsx</span><br><span class="line"><span class="keyword">import</span> MyContext <span class="keyword">from</span> <span class="string">&#x27;./context.js&#x27;</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;name:</span>&quot;<span class="attr">zhangsan</span>&quot;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Parent</span>&gt;</span><span class="tag">&lt;/<span class="name">Parent</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">MyContext.Provider</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2.context.js</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">const</span> MyContext = React.createContext();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyContext;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#3.Parent.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC,useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> MyContext <span class="keyword">from</span> <span class="string">&#x27;../context.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//在子组件中获取根组件暴露的数据</span></span><br><span class="line">  <span class="keyword">const</span> contextValue = useContext(MyContext);</span><br><span class="line">  <span class="built_in">console</span>.log(contextValue)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;text文本为:&#123;contextValue.name&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-2-useReducer"><a href="#8-3-2-useReducer" class="headerlink" title="8.3.2 useReducer"></a>8.3.2 useReducer</h3><p>useReducer提供类似 Redux 的功能。他接收两个参数，第一个参数是一个recuder(纯函数)，第二个参数是state的初始值。</p>
<p>他返回一个状态 state和 dispath，state是返回状态中的值，而 dispatch 是一个可以发布事件来更新 state 的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reducer 纯函数，用于修改state</span></span><br><span class="line"><span class="comment">// initialArg 初始化的state状态</span></span><br><span class="line"><span class="comment">// init 一个函数用于惰性计算state初始值</span></span><br><span class="line"><span class="comment">// state 获取state数据</span></span><br><span class="line"><span class="comment">// dispatch 派发器，用于接收一个action来触发reducer，从而修改state</span></span><br><span class="line"><span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initialArg, init);</span><br></pre></td></tr></table></figure>

<h3 id="8-3-3-useReducer和useContext-了解"><a href="#8-3-3-useReducer和useContext-了解" class="headerlink" title="8.3.3 useReducer和useContext(了解)"></a>8.3.3 useReducer和useContext(了解)</h3><p>useReducer和useContext结合使用的时候可以提供类似Vuex那样的全局状态管理</p>
<p>useContext负责向子孙组件暴露数据</p>
<p>useReducer提供全局的state、reducers、dispatch等 (useReducer必须要在函数组件中才能使用，所以这边得把代码放到App.tsx中)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">#1.index.tsx</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span>&gt;</span><span class="tag">&lt;/<span class="name">App</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br><span class="line">                </span><br><span class="line">#2.App.tsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Parent <span class="keyword">from</span> <span class="string">&quot;./components8/Parent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> MyContext <span class="keyword">from</span> <span class="string">&#x27;./context.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个reducer(纯函数，将action转换为state)</span></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state = <span class="number">0</span>, action:&#123;type:string&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;ADD&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;SUB&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC&lt;&#123;&#125;&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, dispatcher] = useReducer(reducer, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;[count,dispatcher]&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Parent</span>&gt;</span><span class="tag">&lt;/<span class="name">Parent</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">MyContext.Provider</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line"></span><br><span class="line">#3.Parent.tsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC,useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> MyContext <span class="keyword">from</span> <span class="string">&#x27;../context.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//在子组件中获取根组件暴露的数据</span></span><br><span class="line">  <span class="keyword">const</span> [count,dispatcher] = useContext(MyContext);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      父组件</span><br><span class="line">      数量:&#123;count&#125;&lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123; dispatcher(&#123; <span class="attr">type</span>: <span class="string">&quot;ADD&quot;</span> &#125;) &#125;&#125;&gt;加<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123; dispatcher(&#123; <span class="attr">type</span>: <span class="string">&quot;SUB&quot;</span> &#125;) &#125;&#125;&gt;减<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">      &lt;Child&gt;&lt;/Child&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br><span class="line"></span><br><span class="line">#4.Child.tsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> MyContext <span class="keyword">from</span> <span class="string">&#x27;../context.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count,dispatcher] = useContext(MyContext);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      子组件</span><br><span class="line">      数量:&#123;count&#125;&lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123; dispatcher(&#123; <span class="attr">type</span>: <span class="string">&quot;ADD&quot;</span> &#125;) &#125;&#125;&gt;子组件加<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123; dispatcher(&#123; <span class="attr">type</span>: <span class="string">&quot;SUB&quot;</span> &#125;) &#125;&#125;&gt;子组件减<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Child;</span><br></pre></td></tr></table></figure>

<p>useReducer和useContext的出现并不是为了取代redux，redux是独立于任何第三方库，redux有优秀的中间件(异步数据流、debug)。当状态比较简单的时候，我们可以使用useReducer和useContext来实现组件之间的数据共享，但是当状态变得特别复杂的时候，建议使用redux。</p>
<h2 id="8-4-Hook的规则"><a href="#8-4-Hook的规则" class="headerlink" title="8.4 Hook的规则"></a>8.4 Hook的规则</h2><h3 id="8-4-1-只在组件顶层中使用Hook"><a href="#8-4-1-只在组件顶层中使用Hook" class="headerlink" title="8.4.1 只在组件顶层中使用Hook"></a>8.4.1 只在组件顶层中使用Hook</h3><blockquote>
<p><strong>不要在循环，条件或嵌套函数中调用 Hook，</strong> 确保总是在你的 React 函数的最顶层调用他们。遵守这条规则，你就能确保 Hook 在每一次渲染中都按照同样的顺序被调用。这让 React 能够在多次的 <code>useState</code> 和 <code>useEffect</code> 调用之间保持 hook 状态的正确。</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>); <span class="comment">//Yes</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(props.id)&#123;</span><br><span class="line">        <span class="comment">// const [count, setCount] = useState(0); //No</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   	<span class="keyword">const</span> fn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// const [count, setCount] = useState(0); //No</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-4-2-只在React-函数中调用Hook"><a href="#8-4-2-只在React-函数中调用Hook" class="headerlink" title="8.4.2 只在React 函数中调用Hook"></a>8.4.2 只在React 函数中调用Hook</h3><blockquote>
<p><strong>不要在普通的 JavaScript 函数中调用 Hook。</strong>你可以：</p>
<ul>
<li>在 React 的函数组件中调用 Hook</li>
<li>在自定义 Hook 中调用其他 Hook</li>
<li>在class组件中不能使用Hook</li>
</ul>
<p>遵循此规则，确保组件的状态逻辑在代码中清晰可见。</p>
</blockquote>
<h2 id="8-5-Hook参照文章："><a href="#8-5-Hook参照文章：" class="headerlink" title="8.5 Hook参照文章："></a>8.5 Hook参照文章：</h2><ol>
<li><a target="_blank" rel="noopener" href="https://react-1251415695.cos-website.ap-chengdu.myqcloud.com/docs/getting-started.html">React官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_17775997/article/details/94453167">useMemo与useCallback使用指南</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/gtLBTNq9mr3/article/details/93984397">useReducerde使用和原理</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021133222">五个大型项目实践总结，解密React Hooks最佳实践</a></li>
<li><a target="_blank" rel="noopener" href="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/">useEffect完整指南</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/88135310">一文彻底搞懂 react hooks 的原理和实现</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b9ac8fa849f1">React Hooks的原理</a></li>
</ol>
<h1 id="9-React-router"><a href="#9-React-router" class="headerlink" title="9. React-router"></a>9. React-router</h1><h2 id="9-1-前端路由的两种实现方案"><a href="#9-1-前端路由的两种实现方案" class="headerlink" title="9.1 前端路由的两种实现方案"></a>9.1 前端路由的两种实现方案</h2><ol>
<li><p>hash : hash原本的作用是为一个很长的文档页添加锚点信息，它自带不改变url刷新页面的功能，所以自然而然被用单页面应用程序中了。</p>
</li>
<li><p>history : 应该说history是主流的解决方案，浏览器的前进后退用的就是这个，它是window对象下的，以前的history提供的方法只能做页面之间的前进后退，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">history.go(number|URL) 可加载历史列表中的某个具体的页面</span><br><span class="line">history.forward() 可加载历史列表中的下一个 URL</span><br><span class="line">history.back() 可加载历史列表中的前一个 URL</span><br></pre></td></tr></table></figure>

<p>为了在不刷新浏览器的情况下，创建新的浏览记录并插入浏览记录队列中，html5新增了如下方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. history.pushState(state, title, url)</span><br><span class="line">   添加一条历史记录， state用于传递参数，可以为空。title是设置历史记录的标题，可以为空。url是历史记录的URL，不可以为空。</span><br><span class="line"></span><br><span class="line">2.history.replaceState(state, title, url)</span><br><span class="line">将history堆栈中当前的记录替换成这里的url，参数同上。</span><br><span class="line"></span><br><span class="line">这个特性后来用到了单页面应用中比如：vue-router，react-router-dom里面。</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="9-2-Reac中的路由"><a href="#9-2-Reac中的路由" class="headerlink" title="9.2 Reac中的路由"></a>9.2 Reac中的路由</h2><p><code>&lt;Router&gt;</code>是React中实现路由最外层的容器，一般情况下我们不再需要直接使用它，而是使用在它基础之上封装的几个适用于不同环境的组件，react-router-dom的Router有四种：</p>
<table>
<thead>
<tr>
<th>Router</th>
<th>适用情况</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://reacttraining.com/react-router/web/api/BrowserRouter">BrowserRouter</a></td>
<td>react-router-dom扩展，利用HTML5 新增的history API (pushState, replaceState)，是web应用最常用的路由组件</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://reacttraining.com/react-router/web/api/HashRouter">HashRouter</a></td>
<td>react-router-dom扩展，利用window.location.hash，适用于低版本浏览器或者一些特殊情境</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://reacttraining.com/react-router/web/api/MemoryRouter">MemoryRouter</a></td>
<td>继承自react-router ，用户在地址栏看不到任何路径变化，一般用在测试或者非浏览器环境开发中</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://reacttraining.com/react-router/web/api/StaticRouter">StaticRouter</a></td>
<td>继承自react-router，某些页面从渲染出来以后没有多的交互，所以没有状态的变化需要存储，就可以使用静态路由，静态路由适用于服务器端</td>
</tr>
</tbody></table>
<p>一般我们很少会用到MemoryRouter和StaticRouter，在web应用中更多的是用   <code>react-router-dom</code>扩展出来的BrowserRouter和HashRouter，这两个就是我前面提到的前端路由的两种解决办法的各自实现。</p>
<h2 id="9-3-HashRouter的基本使用"><a href="#9-3-HashRouter的基本使用" class="headerlink" title="9.3 HashRouter的基本使用"></a>9.3 HashRouter的基本使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-router react-router-dom @types/react-router-dom</span><br><span class="line"></span><br><span class="line">#1.main.js </span><br><span class="line"><span class="comment">// 1. 导入包</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.jsx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 render 函数渲染 虚拟DOM</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span>&gt;</span><span class="tag">&lt;/<span class="name">App</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>))</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">#2.App.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HashRouter 表示一个路由的跟容器，所有的路由相关的东西，都要包裹在 HashRouter 里面</span></span><br><span class="line"><span class="comment">// Route 表示一个路由规则， 在 Route 上有两个比较重要的属性：path   component</span></span><br><span class="line"><span class="comment">// Link 表示一个路由的链接 ，就好比 vue 中的 &lt;router-link to=&quot;&quot;&gt;&lt;/router-link&gt;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter, Route, Link &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;./components6/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Movie <span class="keyword">from</span> <span class="string">&#x27;./components6/Movie&#x27;</span></span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&#x27;./components6/About&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC&lt;&#123;&#125;&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 当 使用 HashRouter 把 App 根组件的元素包裹起来之后，网站就已经启用路由了</span></span><br><span class="line">  <span class="comment">// 在一个 HashRouter 中，只能有唯一的一个根元素</span></span><br><span class="line">  <span class="comment">// 在一个网站中，只需要使用 唯一的一次 &lt;HashRouter&gt;&lt;/HashRouter&gt; 就行了</span></span><br><span class="line">  <span class="keyword">return</span> (&lt;HashRouter&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;这是网站的APP根组件&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Link to=<span class="string">&quot;/home&quot;</span>&gt;首页&lt;/Link&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">      &lt;Link to=<span class="string">&quot;/movie/top250/10&quot;</span>&gt;电影&lt;/Link&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">      &lt;Link to=<span class="string">&quot;/about&quot;</span>&gt;关于&lt;/Link&gt;</span><br><span class="line"></span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* Route 创建的标签，就是路由规则，其中 path 表示要匹配的路由，component 表示要展示的组件 */</span>&#125;</span><br><span class="line">      &#123;<span class="comment">/* 在 vue 中有个 router-view 的路由标签专门用来放置匹配到的路由组件的，但是在 react-router 中并没有类似于这样的标签，而是直接把 Route 标签当作的坑（占位符） */</span>&#125;</span><br><span class="line">      &#123;<span class="comment">/* Route 具有两种身份：1. 它是一个路由匹配规则； 2. 它是一个占位符，表示将来匹配到的组件都放到这个位置， 如果想让路由规则进行精确匹配，可以为 Route添加 exact 属性，表示启用精确匹配模式 */</span>&#125;</span><br><span class="line">      &lt;Route path=<span class="string">&quot;/home&quot;</span> component=&#123;Home&#125;&gt;&lt;/Route&gt;</span><br><span class="line">      &#123;<span class="comment">/* 注意：默认情况下，路由中的规则是模糊匹配的，如果路由可以部分匹配成功，就会展示这个路由对应的组件 */</span>&#125;</span><br><span class="line">      &#123;<span class="comment">/* 如果要匹配参数，可以在匹配规则中使用 : 修饰符，表示这个位置匹配到的是参数 */</span>&#125;</span><br><span class="line">      &lt;Route path=<span class="string">&quot;/movie/:type/:id&quot;</span> component=&#123;Movie&#125; exact&gt;&lt;/Route&gt;</span><br><span class="line">      &lt;Route path=<span class="string">&quot;/about&quot;</span> component=&#123;About&#125;&gt;&lt;/Route&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/HashRouter&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line">                </span><br><span class="line">#3.components/Home.jsx    </span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home:FC&lt;&#123;&#125;&gt; = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>主页<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home;</span><br><span class="line"></span><br><span class="line">#4. components/Movie.jsx </span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RouteComponentProps &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line">type ParamsProps = &#123;</span><br><span class="line">  type?: string | <span class="literal">undefined</span>,</span><br><span class="line">  id?: string | <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br><span class="line">type IProps = &#123;</span><br><span class="line">  name?: string</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Movie: FC&lt;IProps &amp; RouteComponentProps&lt;ParamsProps&gt;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>电影--- &#123;props.match.params.type&#125; --- &#123;props.match.params.id&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movie;</span><br><span class="line"></span><br><span class="line">#5. components/About.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> About:FC&lt;&#123;&#125;&gt; = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>关于我们<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> About;</span><br></pre></td></tr></table></figure>

<h2 id="9-4-匹配规则"><a href="#9-4-匹配规则" class="headerlink" title="9.4 匹配规则"></a>9.4 匹配规则</h2><p><strong>默认：</strong></p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one</td>
<td>/one</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/111</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/aaa/bbb</td>
<td>是</td>
</tr>
</tbody></table>
<p><strong>exact配置：</strong>exact属性为true时路径中的hash值必须和path完全一致才渲染对应的组件，如果为false则’/‘也可以匹配’/xxx’</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>exact</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one</td>
<td>/one/two</td>
<td>true</td>
<td>否</td>
</tr>
<tr>
<td>/one</td>
<td>/one/two</td>
<td>false</td>
<td>是</td>
</tr>
</tbody></table>
<p><strong>strict配置：</strong>strict属性主要就是匹配反斜杠，规定是否匹配末尾包含反斜杠的路径，如果strict为true，则如果path中不包含反斜杠结尾，则他也不能匹配包含反斜杠结尾的路径</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>strict</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one/</td>
<td>/one</td>
<td>true</td>
<td>否</td>
</tr>
<tr>
<td>/one/</td>
<td>/one/</td>
<td>true</td>
<td>是</td>
</tr>
<tr>
<td>/one/</td>
<td>/one/two</td>
<td>true</td>
<td>是</td>
</tr>
</tbody></table>
<h2 id="9-5-Switch和Redirect"><a href="#9-5-Switch和Redirect" class="headerlink" title="9.5 Switch和Redirect"></a>9.5 Switch和Redirect</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HashRouter, Route, Link, Switch, Redirect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (&lt;HashRouter&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;这是网站的APP根组件&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Link to=<span class="string">&quot;/home&quot;</span>&gt;首页&lt;/Link&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">      &lt;Link to=<span class="string">&quot;/movie/top250/10&quot;</span>&gt;电影&lt;/Link&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">      &lt;Link to=<span class="string">&quot;/about&quot;</span>&gt;关于&lt;/Link&gt;</span><br><span class="line"></span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/*&lt;/Switch&gt;</span></span><br><span class="line"><span class="comment">       Switch表示路由互斥，如果没有Switch，会根据路由找到所有匹配的组件显示</span></span><br><span class="line"><span class="comment">       比如http://localhost:3000/#/user  会找到/、/user所匹配的路由(下面home没有找到是因为精确匹配了)</span></span><br><span class="line"><span class="comment">    */</span>&#125;</span><br><span class="line">      &lt;Switch&gt;</span><br><span class="line">        &#123;<span class="comment">/*</span></span><br><span class="line"><span class="comment">        path:/ 表示访问根路径的情况下默认载入home组件</span></span><br><span class="line"><span class="comment">        exact精确匹配，为了给其他组件一个机会获取到url改变</span></span><br><span class="line"><span class="comment">        strict 在确定路径是否与当前URL匹配时，将考虑路径后的斜线；</span></span><br><span class="line"><span class="comment">       */</span>&#125;</span><br><span class="line">        &lt;Route path=<span class="string">&quot;/home&quot;</span> component=&#123;Home&#125;&gt;&lt;/Route&gt;</span><br><span class="line">        &lt;Route path=<span class="string">&quot;/movie/:type/:id&quot;</span> component=&#123;Movie&#125; exact&gt;&lt;/Route&gt;</span><br><span class="line">        &lt;Route path=<span class="string">&quot;/about&quot;</span> component=&#123;About&#125;&gt;&lt;/Route&gt;</span><br><span class="line">        &#123;<span class="comment">/*没有匹配到路径的时候重定向到根路径*/</span>&#125;</span><br><span class="line">        &lt;Redirect to=<span class="string">&quot;/&quot;</span> /&gt;</span><br><span class="line">      &lt;/Switch&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/HashRouter&gt;)</span><br></pre></td></tr></table></figure>

<h2 id="9-6-React中的编程式导航和路由传参"><a href="#9-6-React中的编程式导航和路由传参" class="headerlink" title="9.6 React中的编程式导航和路由传参"></a>9.6 React中的编程式导航和路由传参</h2><h3 id="9-6-1-withRouter的使用"><a href="#9-6-1-withRouter的使用" class="headerlink" title="9.6.1 withRouter的使用"></a>9.6.1 withRouter的使用</h3><p>withRouter可以包装任何自定义组件，将react-router 的 history,location,match 三个对象传入。 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route exact path=<span class="string">&quot;/Home&quot;</span> component=&#123;Home&#125;/&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 1.只有包裹在Route组件里的才能使用<code>props.location</code>，<br> 2.假如有个需求，是面包屑或者导航组件里需要拿到<code>props.location</code>（导航组件或者面包屑一般不会包裹在<code>Route</code>里），那么直接这么写显然就不行了。<br> 这个时候<code>withRouter</code>修饰一下，就可以这么写了。</p>
</blockquote>
<h3 id="9-6-2-使用withRouter跳转页面"><a href="#9-6-2-使用withRouter跳转页面" class="headerlink" title="9.6.2 使用withRouter跳转页面"></a>9.6.2 使用withRouter跳转页面</h3><blockquote>
<p>只有在 <Route> 包裹的组件中才能在 this.props 属性中找到 history 对象。但有些情况下我们就是希望在一个没被 <Route> 包裹的组件中用到 history 对象，我们可以这样用</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Header.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RouteComponentProps, withRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Header: FC&lt;RouteComponentProps&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> goAbout = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    props.history.push(&#123; <span class="attr">pathname</span>: <span class="string">&quot;/about&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    网页头</span><br><span class="line">    &lt;button onClick=&#123;goAbout&#125;&gt;点我跳转About页面&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(Header);</span><br></pre></td></tr></table></figure>

<h3 id="9-6-3-路由传参"><a href="#9-6-3-路由传参" class="headerlink" title="9.6.3 路由传参"></a>9.6.3 路由传参</h3><p>TS 路由接口：RouteComponentProps</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; RouteComponentProps &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> RouterInfo &#123;</span><br><span class="line">  id: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props: RouteComponentProps&lt;RouterInfo&gt;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1 className=&#123;styles.title&#125;&gt;Page productDetail/index ---&#123;props.match.params.id&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="a-params方式传参"><a href="#a-params方式传参" class="headerlink" title="a) params方式传参"></a>a) params方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">&#x27;/path/:name&#x27;</span> component=&#123;Path&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Link to=<span class="string">&quot;/path/2&quot;</span>&gt;xxx&lt;/Link&gt;</span><br><span class="line">props.history.push(&#123;<span class="attr">pathname</span>:<span class="string">&quot;/path/&quot;</span> + name&#125;);</span><br><span class="line"></span><br><span class="line">读取参数用:props.match.params.name</span><br></pre></td></tr></table></figure>

<p>优势 ： 刷新地址栏，参数依然存在<br>缺点  :   只能传字符串，并且如果传的值太多的话，url会变得长而丑陋。</p>
<h4 id="b-search方式传参"><a href="#b-search方式传参" class="headerlink" title="b) search方式传参"></a>b) search方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">&#x27;/web/departManange &#x27;</span> component=&#123;DepartManange&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;link to=<span class="string">&quot;web/departManange?tenantId=12121212&quot;</span>&gt;xxx&lt;/Link&gt;</span><br><span class="line">props.history.push(&#123;<span class="attr">pathname</span>:<span class="string">&quot;/web/departManange&quot;</span>,<span class="attr">search</span>: <span class="string">&#x27;tenantId=12121212&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">读取参数用: props.location.search</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//search参数的解析</span></span><br><span class="line">yarn add url -S</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> url <span class="keyword">from</span> <span class="string">&#x27;url&#x27;</span></span><br><span class="line"><span class="keyword">const</span> httpUrl = props.location.search;</span><br><span class="line">url.parse(httpUrl, <span class="literal">true</span>).query.tenantId;</span><br></pre></td></tr></table></figure>

<p>优势 ： 刷新地址栏，参数依然存在</p>
<p>缺点  :   只能传字符串，并且如果传的值太多的话，url会变得长而丑陋。</p>
<h4 id="c-query方式传参"><a href="#c-query方式传参" class="headerlink" title="c) query方式传参"></a>c) query方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">&#x27;/query&#x27;</span> component=&#123;Query&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Link to=&#123;&#123; <span class="attr">pathname</span> : <span class="string">&#x27; /query&#x27;</span> , <span class="attr">query</span> : &#123; <span class="attr">name</span> : <span class="string">&#x27;sunny&#x27;</span> &#125;&#125;&#125;&gt;</span><br><span class="line">props.history.push(&#123;<span class="attr">pathname</span>:<span class="string">&quot;/query&quot;</span>,<span class="attr">query</span>: &#123; <span class="attr">name</span> : <span class="string">&#x27;sunny&#x27;</span> &#125;&#125;);</span><br><span class="line"></span><br><span class="line">读取参数用: props.location.query.name</span><br></pre></td></tr></table></figure>

<p>优势：传参优雅，传递参数可传对象；<br>缺点：刷新地址栏，参数丢失</p>
<h4 id="d-state方式传参"><a href="#d-state方式传参" class="headerlink" title="d) state方式传参"></a>d) state方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">&#x27;/sort &#x27;</span> component=&#123;Sort&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Link to=&#123;&#123; <span class="attr">pathname</span> : <span class="string">&#x27; /sort &#x27;</span> , <span class="attr">state</span> : &#123; <span class="attr">name</span> : <span class="string">&#x27;sunny&#x27;</span> &#125;&#125;&#125;&gt; </span><br><span class="line">props.history.push(&#123;<span class="attr">pathname</span>:<span class="string">&quot;/sort &quot;</span>,<span class="attr">state</span> : &#123; <span class="attr">name</span> : <span class="string">&#x27;sunny&#x27;</span> &#125;&#125;);</span><br><span class="line"></span><br><span class="line">读取参数用: props.location.state.name </span><br></pre></td></tr></table></figure>

<p>优势：传参优雅，传递参数可传对象，state传的参数是加密的<br>缺点：刷新地址栏，参数丢失</p>
<h2 id="9-7-组件懒加载和基于路由的代码分割"><a href="#9-7-组件懒加载和基于路由的代码分割" class="headerlink" title="9.7 组件懒加载和基于路由的代码分割"></a>9.7 组件懒加载和基于路由的代码分割</h2><p><code>React.lazy</code> 函数能让你像渲染常规组件一样处理动态引入（的组件）。</p>
<p><code>React.lazy</code> 接受一个函数，这个函数需要动态调用 <code>import()</code>。它必须返回一个 <code>Promise</code>，该 Promise 需要 resolve 一个 <code>defalut</code> export 的 React 组件。</p>
<p>然后应在 <code>Suspense</code> 组件中渲染 lazy 组件(Suspense 就是实现所谓的延迟加载效果)，如此使得我们可以使用在等待加载 lazy 组件时做优雅降级（如 loading 指示器等）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Switch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; Suspense, lazy &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/Home&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> About = lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./routes/About&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    <span class="comment">//fallback 属性接受任何在组件加载过程中你想展示的 React 元素</span></span><br><span class="line">    &lt;Suspense fallback=&#123;<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&gt;</span><br><span class="line">      &lt;Switch&gt;</span><br><span class="line">        &lt;Route exact path=<span class="string">&quot;/&quot;</span> component=&#123;Home&#125;/&gt;</span><br><span class="line">        &lt;Route path=<span class="string">&quot;/about&quot;</span> component=&#123;About&#125;/&gt;</span><br><span class="line">      &lt;/Switch&gt;</span><br><span class="line">    &lt;/Suspense&gt;</span><br><span class="line">  &lt;/Router&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h1 id="10-高阶组件"><a href="#10-高阶组件" class="headerlink" title="10.高阶组件"></a>10.高阶组件</h1><h2 id="10-1-高阶函数"><a href="#10-1-高阶函数" class="headerlink" title="10.1 高阶函数"></a>10.1 高阶函数</h2><p><strong>高阶函数是一个函数，它接收函数作为参数或将函数作为输出返回</strong></p>
<ul>
<li><p>举个栗子:</p>
<ul>
<li><p>接收函数作为参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function a(x) &#123;</span><br><span class="line">  x();</span><br><span class="line">&#125;</span><br><span class="line">function b() &#123;</span><br><span class="line">  alert(&#39;hello&#39;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a(b);</span><br></pre></td></tr></table></figure>
</li>
<li><p>将函数作为输出返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function a() &#123;</span><br><span class="line">  function b() &#123;</span><br><span class="line">    alert(&#39;hello&#39;);</span><br><span class="line">  &#125;</span><br><span class="line">  return b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a()();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>以上函数a就是一个高阶函数, 用法非常简单, 那么实际开发中又有哪些是高阶函数呢？</p>
<ul>
<li>Array 的 map 、reduce 、filter 等方法</li>
<li>Object 的 keys 、values 等方法</li>
</ul>
</li>
</ul>
<h2 id="10-2-高阶组件"><a href="#10-2-高阶组件" class="headerlink" title="10.2 高阶组件"></a>10.2 高阶组件</h2><ul>
<li>概念：<strong>高阶组件就是一个函数，且该函数接受一个组件作为参数，并返回一个新的组件</strong></li>
</ul>
<blockquote>
<p>高阶组件可以看做是装饰器模式(Decorator Pattern)在React的实现。即允许向一个现有的对象添加新的功能，同时又不改变其结构，属于包装模式(Wrapper Pattern)的一种。最大的特点就是重用组件逻辑</p>
</blockquote>
<h3 id="10-2-1-高阶组件的实现方式-属性代理"><a href="#10-2-1-高阶组件的实现方式-属性代理" class="headerlink" title="10.2.1 高阶组件的实现方式-属性代理"></a>10.2.1 高阶组件的实现方式-属性代理</h3><p>属性代理(Props Proxy)：<code>HOC</code>是包裹在普通组件外面的一层高阶函数，任何要传入普通组件内的<code>props</code> 或者 <code>state</code> 首先都要经过 <code>HOC</code>。</p>
<p><code>props</code>和 <code>state</code>等属性原本是要流向 目标组件的腰包的，但是却被 雁过拔毛的<code>HOC</code>拦路打劫，那么最终这些 <code>props</code>和 <code>states</code>数据到底还能不能再到达 目标组件，或者哪些能到达以及到达多少就全由 <code>HOC</code>说了算了，也就是说，<code>HOC</code>拥有了提前对这些属性进行修改的能力。</p>
<p>属性代理的作用：</p>
<ul>
<li>更改prop</li>
<li>通过refs获取组件实例(类组件)</li>
<li>抽象state</li>
<li>把WrappedComponent与其他elements包装在一起</li>
</ul>
<h4 id="a-属性代理-用其他元素包装组件"><a href="#a-属性代理-用其他元素包装组件" class="headerlink" title="a) 属性代理-用其他元素包装组件"></a>a) 属性代理-用其他元素包装组件</h4><p>为了封装样式、布局或别的目的，可以用其它组件和元素包裹 WrappedComponent。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被包裹组件</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> HocComponent <span class="keyword">from</span> <span class="string">&#x27;../HOC/HocComponent&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyComponent: SFC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>被包裹组件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HocComponent(MyComponent);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">//高阶组件</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">HocComponent</span>(<span class="params">WrappedComponent: SFC&lt;&#123;&#125;&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> NewComponent: SFC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> &quot;<span class="attr">red</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> NewComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="b-属性代理-更改props"><a href="#b-属性代理-更改props" class="headerlink" title="b) 属性代理-更改props"></a>b) 属性代理-更改props</h4><p>在高阶组件中添加新的 props，可以在 WrappedComponent 中通过 this.props.name访问到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyComponent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> HocComponent <span class="keyword">from</span> <span class="string">&#x27;../HOC/HocComponent&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; PrametersType &#125; <span class="keyword">from</span> <span class="string">&#x27;../HOC/Type&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyComponent: SFC&lt;PrametersType&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello React ---- &#123;props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HocComponent(MyComponent);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//HocComponent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; PrametersType &#125; <span class="keyword">from</span> <span class="string">&#x27;./Type&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">HocComponent</span>(<span class="params">WrappedComponent: SFC&lt;PrametersType&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> NewComponent: SFC&lt;PrametersType&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">WrappedComponent</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> NewComponent;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Type.tsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type PrametersType = &#123;</span><br><span class="line">  name?:string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="c-属性代理-抽取公共state"><a href="#c-属性代理-抽取公共state" class="headerlink" title="c) 属性代理-抽取公共state"></a>c) 属性代理-抽取公共state</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyInput.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyInput: SFC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState&lt;string&gt;(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    setValue(e.target.value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyInput;</span><br><span class="line"></span><br><span class="line">          </span><br><span class="line"><span class="comment">//MyTextArea.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyTextArea: SFC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState&lt;string&gt;(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLTextAreaElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    setValue(e.target.value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyTextArea;</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line"><span class="keyword">import</span> MyInput <span class="keyword">from</span> <span class="string">&#x27;./components7/MyInput&#x27;</span></span><br><span class="line"><span class="keyword">import</span> MyTextArea <span class="keyword">from</span> <span class="string">&#x27;./components7/MyTextArea&#x27;</span></span><br><span class="line">          </span><br><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">  &lt;MyInput&gt;&lt;/MyInput&gt;</span><br><span class="line">  &lt;MyTextArea&gt;&lt;/MyTextArea&gt;</span><br><span class="line">&lt;/div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//这边代码存在的问题：MyInput和MyTextArea组件都有自己的state和change方法，代码重用性太大</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyInput.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;TextPrametersType&#125; <span class="keyword">from</span> <span class="string">&#x27;../HOC/Type&#x27;</span></span><br><span class="line"><span class="keyword">import</span> HocTextComponent <span class="keyword">from</span> <span class="string">&#x27;../HOC/HocTextComponent&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyInput: SFC&lt;TextPrametersType&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;props.value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;props.change&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HocTextComponent(MyInput);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">//MyTextArea.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;TextPrametersType&#125; <span class="keyword">from</span> <span class="string">&#x27;../HOC/Type&#x27;</span></span><br><span class="line"><span class="keyword">import</span> HocTextComponent <span class="keyword">from</span> <span class="string">&#x27;../HOC/HocTextComponent&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyTextArea: SFC&lt;TextPrametersType&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">value</span>=<span class="string">&#123;props.value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;props.change&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyTextArea;</span><br><span class="line">      </span><br><span class="line">          </span><br><span class="line"><span class="comment">//HocTextComponent.tsx      </span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; TextPrametersType &#125; <span class="keyword">from</span> <span class="string">&#x27;./Type&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">HocTextComponent</span>(<span class="params">WrappedComponent: SFC&lt;TextPrametersType&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> NewComponent: React.FC&lt;TextPrametersType&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [value, setValue] = useState&lt;string&gt;(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement|HTMLTextAreaElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      setValue(e.target.value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> newProps = &#123;</span><br><span class="line">      value: value,</span><br><span class="line">      change: handleChange</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125; &#123;<span class="attr">...newProps</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">WrappedComponent</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> NewComponent;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//Type.tsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type TextPrametersType = &#123;</span><br><span class="line">  value?:string,</span><br><span class="line">  change?(e: React.ChangeEvent):<span class="keyword">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-2-高阶组件的实现方式-反向继承"><a href="#10-2-2-高阶组件的实现方式-反向继承" class="headerlink" title="10.2.2 高阶组件的实现方式-反向继承"></a>10.2.2 高阶组件的实现方式-反向继承</h3><p>反向继承( Inheritance Inversion )：返回的 HOC 类（Enhancer）继承了 WrappedComponent。之所以被称为 Inheritance Inversion 是因为 WrappedComponent 被 Enhancer 继承了，而不是 WrappedComponent 继承了 Enhancer。在这种方式中，它们的关系看上去被反转（inverse）了。</p>
<p>通过继承WrappedComponent，除了一些静态方法，包括生命周期，state，各种function，我们都可以得到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iiHOC</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Enhancer</span> <span class="keyword">extends</span> <span class="title">WrappedComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">super</span>.render()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反向继承的作用：</p>
<ul>
<li>渲染劫持</li>
<li>操作state</li>
</ul>
<h4 id="a-反向继承-渲染劫持"><a href="#a-反向继承-渲染劫持" class="headerlink" title="a) 反向继承-渲染劫持"></a>a) 反向继承-渲染劫持</h4><p>之所以被称为渲染劫持是因为 HOC 控制着 WrappedComponent 的渲染输出，可以用它做各种各样的事。通过渲染劫持可以：</p>
<ul>
<li>在由 render输出的任何 React 元素中读取、添加、编辑、删除 props</li>
<li>读取和修改由 render 输出的 React 元素树</li>
<li>有条件地渲染元素树</li>
<li>把样式包裹进元素树（就像在 Props Proxy 中的那样）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">&#x27;./logo.svg&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">name</span>=<span class="string">&quot;pp&quot;</span>&gt;</span>被包裹组件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iiHOC</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Enhancer</span> <span class="keyword">extends</span> <span class="title">WrappedComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> elementsTree = <span class="built_in">super</span>.render();</span><br><span class="line">      <span class="comment">//打印父组件的属性值</span></span><br><span class="line">      <span class="built_in">console</span>.log(elementsTree.props)</span><br><span class="line">      <span class="comment">//添加新的 属性返回</span></span><br><span class="line">      <span class="keyword">let</span> newProps = &#123;<span class="attr">style</span>:&#123;<span class="attr">color</span>:<span class="string">&#x27;red&#x27;</span>&#125;&#125;;</span><br><span class="line">      <span class="keyword">const</span> props = <span class="built_in">Object</span>.assign(&#123;&#125;,elementsTree.props,newProps);</span><br><span class="line">      <span class="keyword">const</span> newElement = React.cloneElement(elementsTree, props, elementsTree.props.children)</span><br><span class="line">      <span class="keyword">return</span> newElement;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NewComponent = iiHOC(MyComponent)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;NewComponent&gt;&lt;/NewComponent&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<h4 id="b-反向继承-修改state"><a href="#b-反向继承-修改state" class="headerlink" title="b) 反向继承-修改state"></a>b) 反向继承-修改state</h4><p>HOC 可以读取、编辑和删除 WrappedComponent 实例的 state，如果需要，也可以给它添加更多的 state。但是这会搞乱 WrappedComponent 的 state，可能会导致破坏某些东西，通常不建议使用高阶组件修改添加state。</p>
<p>下面通过访问 WrappedComponent 的 props 和 state 来做测试。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">IIHOCDEBUGGER</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">II</span> <span class="keyword">extends</span> <span class="title">WrappedComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;h2&gt;HOC Debugger Component&lt;/h2&gt;</span><br><span class="line">          &lt;p&gt;Props&lt;<span class="regexp">/p&gt; &lt;pre&gt;&#123;JSON.stringify(this.props)&#125;&lt;/</span>pre&gt;</span><br><span class="line">          &lt;p&gt;State&lt;<span class="regexp">/p&gt;&lt;pre&gt;&#123;JSON.stringify(this.state)&#125;&lt;/</span>pre&gt;</span><br><span class="line">          &#123;<span class="built_in">super</span>.render()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>​</li>
</ol>
<h1 id="11-安装-React-Developer-Tools-调试工具"><a href="#11-安装-React-Developer-Tools-调试工具" class="headerlink" title="11.安装 React Developer Tools 调试工具"></a>11.安装 React Developer Tools 调试工具</h1><p><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=zh-CN">React Developer Tools - Chrome 扩展下载安装地址</a></p>
<h1 id="12-相关文章"><a href="#12-相关文章" class="headerlink" title="12. 相关文章"></a>12. 相关文章</h1><ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/gV-w_rRfdBVAqsOpBGZaVw">2018 年，React 将独占前端框架鳌头？</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/0wXWqKIigaKzMSfy4vJMVw">前端框架三巨头年度走势对比：Vue 增长率最高</a></li>
</ul>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.cnblogs.com/tim100/p/6050514.html">React数据流和组件间的沟通总结</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000005876655/a-1020000005876751">单向数据流和双向绑定各有什么优缺点？</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/29504639?sort=created">怎么更好的理解虚拟DOM?</a></li>
<li><a target="_blank" rel="noopener" href="http://www.css88.com/react/index.html">React中文文档 - 版本较低</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/yczz/article/details/49886061">React 源码剖析系列 － 不可思议的 react diff</a></li>
<li><a target="_blank" rel="noopener" href="http://www.infoq.com/cn/articles/react-dom-diff?from=timeline&isappinstalled=0">深入浅出React（四）：虚拟DOM Diff算法解析</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cocoachina.com/webapp/20150721/12692.html">一看就懂的ReactJs入门教程（精华版）</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/06/css_modules.html">CSS Modules 用法教程</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/itzhongzi/article/details/66045880">将MarkDown转换为HTML页面</a></li>
<li><a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/0320e2c1c9cf0e1b87507b26.html">win7命令行 端口占用 查询进程号 杀进程</a></li>
<li><a target="_blank" rel="noopener" href="https://facebook.github.io/react/docs/typechecking-with-proptypes.html">类型校验</a></li>
</ul>
<ul>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/animation.html#high-level-api-reactcsstransitiongroup">Animation Add-Ons</a></li>
</ul>

			  </article>
		</div>
		
		


		 	
				<style>
.veditor {
    background: url('https://www.calamus.xyz/wp-content/themes/lensnews2.2/images/loading/comment.gif') no-repeat #fcfcfc!important;
    background-size: auto 130px!important;
    background-position: right bottom!important;
}
</style>
<div id="vcomments" class="comment">

</div>
<script>
	window.valine = new Valine({
		el: '#vcomments',
		appId: 'jNrzXxvqR3NhebnE7swyQBFp-gzGzoHsz',
		appKey: 'iqXsTlkThMqeaKdhYcgajztG',
		avatar: 'robohash',
		placeholder: '留下你的小脚印吧~',
		path: window.location.pathname,   //[重点] 记得添加path路径
	});
	
    // 使用方法 https://valine.js.org/quickstart.html
	/*
		var $vcomments = document.querySelector('.comment');
		var $div= document.createElement('div');
		$div.setAttribute("id","#vcomments");
		$vcomments.appendChild($div);
    new Valine({
        el: '#vcomments',
        appId: 'jNrzXxvqR3NhebnE7swyQBFp-gzGzoHsz',
        appKey: 'iqXsTlkThMqeaKdhYcgajztG',
		avatar: 'robohash',
        placeholder: '输入前请确认 <昵称> <邮箱> <你的网站> 是否已填写，支持markdown 格式编写 ',
    });*/
        //placeholder: '输入前请确认 <昵称> <邮箱> <你的网站> 是否已填写，支持markdown 格式编写 ',
</script>

<script>
/*//$(function() 
$(window).load(function(){
	// 去valine版权
	$('.info').css("display","none");
	// 去valine位移
	$('.vmeta').css("padding-right","66px");
	$('.vcontrol').css("padding-right","66px");
	$('.vctrl').css("padding-right","66px");
	$('#veditor').removeAttr("placeholder");
	$("#veditor").attr("placeholder","输入前请确认 <昵称> <邮箱> <你的网站> 是否已填写，支持markdown 格式编写 ");
	$('.v .vwrap .vheader .vinput:nth-child(3)').removeAttr("placeholder");
	$(".v .vwrap .vheader .vinput:nth-child(3)").attr("placeholder","你的HOME(例：https://www.baidu.com)");
	$(".info").after(" <p>&copy; </p>");
});*/
</script>
			
		
	  
	
		


<div class="copy">
<i></i>
<strong>本文作者：</strong>
	
	 
			风清<br>
        
	
<strong>本文链接：</strong>
	<a href="https://fengqing7511.github.io/2020/03/18/06.react%E5%9F%BA%E7%A1%80/" title="https:&#x2F;&#x2F;fengqing7511.github.io&#x2F;2020&#x2F;03&#x2F;18&#x2F;06.react%E5%9F%BA%E7%A1%80&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;fengqing7511.github.io&#x2F;2020&#x2F;03&#x2F;18&#x2F;06.react%E5%9F%BA%E7%A1%80&#x2F;</a><br>
</div>

	  
	</div>
</div>
<script>
	(function(){
		var jmz = {};
		jmz.GetLength = function(str) {
			var realLength = 0, len = str.length, charCode = -1;
			for (var i = 0; i < len; i++) {
				charCode = str.charCodeAt(i);
				if (charCode >= 0 && charCode <= 128) 
					  realLength += 1;
				else
					  realLength += 1;
			}
			return realLength;
		};
		//console.log(str);
		var article = document.querySelector('.dearmsdan-post article').innerHTML.trim();

		var b = article.replace(/<.*?>/ig,"");
		
		$('.post-count').html(jmz.GetLength(b)+"字");
	})()
</script>


    				
					
	
	<script src="/resources/jscex/jscex.min.js"></script>
	<script src="/resources/jscex/jscex-parser.js"></script>
	<script src="/resources/jscex/jscex-jit.js"></script>
	<script src="/resources/jscex/jscex-builderbase.min.js"></script>
	<script src="/resources/jscex/jscex-async.min.js"></script>
	<script src="/resources/jscex/jscex-async-powerpack.min.js"></script>


<style>
	footer{    
		position: static;
    	padding: 20px;
		/*margin-top: 50px;*/
    	text-align: center;
		font-size: inherit;
}
}
	.footer{
    	padding: 20px;
		/*margin-top: 50px;*/
    	text-align: center;
    	border-radius: 50px;
    	background: rgba(84, 76, 76, 0.08);
}
	.footer:hover{        
    	background: rgba(84, 76, 76, 0.08);
    	/*background-image: url('/resources/snow.gif')!important;*/
    	background-size: contain!important;
		box-shadow: 0 4px 24px rgb(109, 108, 108);
		transition: all 0.6s cubic-bezier(0.165, 0.84, 0.44, 1) 0s;
		text-decoration: none;
}
	.footer a{
		text-decoration: none;
    	color: #7d7dff;
		font-family: initial;
	}
	.footer a:hover{
    color: rgba(255, 255, 255, 0)!important;
	}
	.footer .footer-logo{
		color: #2c97e8;
	}
	.footer .footer-logo img{   
		margin-left: 20px;
	}
	.foor{
	overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
	}
	
	.footer a::after {
	/*	color: #7cc2ff;*/
	  -webkit-transition: width 0.35s;
	  transition: width 0.35s;
	  content: "";
	  right: 0;
	  width: 0;
	  bottom: -2px;
	  position: absolute;
	  border-bottom: 2px solid;
	}
	.footer a:hover:after {
		left: 1%;
		right: 1%;
		opacity: 1;
		-webkit-transition: all .5s;
		-o-transition: all .5s;
		-ms-transition: all .5s;
		transition: all .5s;
	}
</style>


<footer class="footer">	
	<div class="footer-content">
		<div class="foor"></div>
		<div class="foor">
			© 2020 
			hi 风清.  
			 <span id="dearmsdan-time-box"> 
				 网站已经运行了<span id="dearmsdan-time"></span>
			 </span>...
		</div>
		<div class="foor">
			<a style='color:#939393;' href='http://hn.beian.miit.gov.cn/' target='_blank'> <img width='16px' src='https://img.alicdn.com/tfs/TB1..50QpXXXXX7XpXXXXXXXXXX-40-40.png' />湘ICP备20001824号 </a>·<a target='_blank' href='http://www.beian.gov.cn/portal/registerSystemInfo' style='display:inline-block;text-decoration:none;height:20px;line-height:20px;'><p style='height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;'>湘公网安备 43010302001049号</p></a>
		</div>
	</div>
</footer>
<script>

var $win = $(window);
var clientWidth = $win.width();
var clientHeight = $win.height();

/* $(window).resize(function() {
    var newWidth = $win.width();
    var newHeight = $win.height();
    if (newWidth != clientWidth && newHeight != clientHeight) {
        location.replace(location);
    }
}); */
 
(function($) {
	$.fn.typewriter = function() {
		this.each(function() {
			var $ele = $(this), str = $ele.html(), progress = 0;
			$ele.html('');
			var timer = setInterval(function() {
				var current = str.substr(progress, 1);
				if (current == '<') {
					progress = str.indexOf('>', progress) + 1;
				} else {
					progress++;
				}
				$ele.html(str.substring(0, progress) + (progress & 1 ? '_' : ''));
				if (progress >= str.length) {
					clearInterval(timer);
				}
			}, 75);
		});
		return this;
	};
})(jQuery);
 
function timeElapse(date){
	var current = Date();
	var seconds = (Date.parse(current) - Date.parse(date)) / 1000;
	var days = Math.floor(seconds / (3600 * 24));
	seconds = seconds % (3600 * 24);
	var hours = Math.floor(seconds / 3600);
	if (hours < 10) {
		hours = "0" + hours;
	}
	seconds = seconds % 3600;
	var minutes = Math.floor(seconds / 60);
	if (minutes < 10) {
		minutes = "0" + minutes;
	}
	seconds = seconds % 60;
	if (seconds < 10) {
		seconds = "0" + seconds;
	}
	var result = "第 <span class=\"digit\">" + days + "</span> 天 <span class=\"digit\">" + hours + "</span> 小时 <span class=\"digit\">" + minutes + "</span> 分钟 <span class=\"digit\">" + seconds + "</span> 秒"; 
	$("#dearmsdan-time").html(result);
}
    </script>
	<script>
	
	
	
	
	
	var textAnimate = eval(Jscex.compile("async", function () 
		{
		    var together = new Date();
		    together.setFullYear(2019,11, 25); 			//时间年月日，注意月份是0-11
		    together.setHours(0);						//小时	
		    together.setMinutes(0);						//分钟
		    together.setSeconds(0);						//秒前一位
		    together.setMilliseconds(0);				//秒第二位
            $("#dearmsdan-time-box").fadeIn(500);
            while (true) {
                timeElapse(together);
                $await(Jscex.Async.sleep(1000));
            }
		}));
 
		textAnimate().start();

	
	
	
	
	</script>



				</div>
			</div>
		</div>

		
	
	



<div class="toping"></div>


<script>
      var browsehappy_config = {
        ie: 12,
        type: 'box',
        debug: false,
        tip: "站点目前不支持 IE 请 ↓↓↓",
        show:['chrome','firefox','360','qq','opera']
      };
    </script>
    <script src="https://cdn.jsdelivr.net/gh/a632079/browserhappy@0.0.1/browserhappy.min.js"></script>



<link href="/resources/meuplayer/css/player.css" rel="stylesheet" type="text/css" />


<div id="jp_container_N" class="jp-video jp-video-270p" role="application" aria-label="media player" style="left: 0px; height: 94px; bottom: 20px;">
	<div class="jp-type-playlist">
		<div id="jquery_jplayer_N" class="jp-jplayer" style="width: 90px; height: 90px;">	<img id="jp_poster_0" style="width: 90px; height: 90px; display: inline;" src="">
			<audio id="jp_audio_0" preload="metadata" src="" title="加载中...."></audio>
			<video id="jp_video_0" preload="metadata" title="加载中...." style="width: 0px; height: 0px;"></video>
		</div>
		<div class="jp-gui">
			<div class="jp-video-play" style="display: none;">
				<button class="jp-video-play-icon" role="button" tabindex="0">播放</button>
			</div>
			<div class="jp-interface">
				<div class="jp-progress">
					<div class="jp-seek-bar" style="width: 100%;">
						<div class="jp-play-bar" style="overflow: hidden; width: 0%;"></div>
					</div>
				</div>
				<div class="jp-current-time" role="timer" aria-label="time">00:00</div>
				<div class="jp-duration" role="timer" aria-label="duration">05:25</div>
				<div class="jp-controls-holder">
					<div class="jp-controls">
						<button class="jp-previous" role="button" tabindex="0">上一曲</button>
						<button class="jp-play" role="button" tabindex="0">播放</button>
						<button class="jp-next" role="button" tabindex="0">下一曲</button>
						<button class="jp-stop" role="button" tabindex="0">暂停</button>
					</div>
					<div class="jp-volume-controls">
						<button class="jp-mute" role="button" tabindex="0">静音</button>
						<button class="jp-volume-max" role="button" tabindex="0">最大音量</button>
						<div class="jp-volume-bar">
							<div class="jp-volume-bar-value" style="width: 80%;"></div>
						</div>
					</div>
					<div class="jp-toggles">
						<button class="jp-repeat" role="button" tabindex="0">重复</button>
						<button class="jp-shuffle" role="button" tabindex="0">随机</button>
					</div>
				</div>
				<div class="jp-details" style="display: none;">
				<div class="jp-title" aria-label="title">加载中....</div>
				</div>
			</div>
		</div>
		<div class="jp-playlist">
			<div class="jp-playlist-box" style="height: 0px;">
				<ul style="height: 1000px; display: block; top: 0px;">
					
				</ul>
			</div>
		</div>
		<div class="jp-no-solution" style="display: none;">
			<span style="transform: rotate(180deg);">升级需要</span> 您浏览器赞不支持播放，请更新版本
			<a href="http://get.adobe.com/flashplayer" target="_blank">Flash插件</a>.
		</div>
	</div>

	<div class="scrollBar" style="display: block;">
		<div class="bar" style="top: 0px;"></div>
	</div>

	<button type="button" class="folded_bt" title="点击收缩" id="btnfold" style="top: 0px;">
	<span style="transform: rotate(180deg);"></span>
	</button>

	<div id="listClose"></div>

</div>


<script async src="/resources/meuplayer/player/player.js"></script>
<script async src="/resources/meuplayer/player/playlist.js"></script>
<script type="text/javascript">

   if (window.addEventListener) {window.addEventListener("load",dearmsdanPlaylist, false); } 
   else if (window.attachEvent) { window.attachEvent("onload",dearmsdanPlaylist);}  
   else{window.onload =dearmsdanPlaylist; }
      

function dearmsdanPlaylist(){
	
var myPlaylist = new jPlayerPlaylist({
		jPlayer: "#jquery_jplayer_N",
		cssSelectorAncestor: "#jp_container_N",
		error: function(event){ }
	},[
   
   	{	
    		title: "Right Here Waiting",
			artist: "Richard Marx",
    		mp3: "http://music.163.com/song/media/outer/url?id=3313653.mp3",
    		poster: "http://p2.music.126.net/_62h3kA2WCrYEXWL0yaJ7Q==/1743825441658717.jpg?param=130y130"
	},
   
   	{	
    		title: "勇气",
			artist: "棉子",
    		mp3: "http://music.163.com/song/media/outer/url?id=1411358329.mp3",
    		poster: "http://p2.music.126.net/QcWNRX_0uhckImvF2nN1xA==/109951164573973377.jpg?param=130y130"
	},
   
   	{	
    		title: "东京不太热",
			artist: "封茗囧菌",
    		mp3: "http://music.163.com/song/media/outer/url?id=34723470.mp3",
    		poster: "http://p1.music.126.net/srjmIxgdjRlCXSjZtl2aaw==/109951163825045428.jpg?param=90y90"
	},
   
   	{	
    		title: "空山新雨后",
			artist: "冷十三",
    		mp3: "http://music.163.com/song/media/outer/url?id=1397565121.mp3",
    		poster: "http://p1.music.126.net/jio03zzjVqkuofI0054Syg==/109951164433163481.jpg?param=177y177"
	},
   
   	{	
    		title: "拜拜",
			artist: "小竖琴",
    		mp3: "http://music.163.com/song/media/outer/url?id=1383594415.mp3",
    		poster: "http://p1.music.126.net/aRpHnChT3GFQI7AsqCw6iA==/109951164284919406.jpg?param=130y130"
	},
   
   	{	
    		title: "冬眠",
			artist: "司南",
    		mp3: "http://music.163.com/song/media/outer/url?id=1398663411.mp3",
    		poster: "http://p1.music.126.net/4KDBaQXnQywQovmqvjx-8Q==/109951164444131697.jpg?param=130y130"
	},
   
   	{	
    		title: "我的名字",
			artist: "焦迈奇",
    		mp3: "http://music.163.com/song/media/outer/url?id=554241732.mp3",
    		poster: "http://p1.music.126.net/a_rb8pgC5R_hO-lfm7acSw==/109951164019567772.jpg?param=130y130"
	},
   
   	{	
    		title: "还是分开",
			artist: "张叶蕾",
    		mp3: "http://music.163.com/song/media/outer/url?id=465921195.mp3",
    		poster: "http://p1.music.126.net/tH5FdakJX47uy8mlM0GMWQ==/19218363741925314.jpg?param=130y130"
	},
   
   	{	
    		title: "云烟成雨",
			artist: "房东的猫",
    		mp3: "http://music.163.com/song/media/outer/url?id=513360721.mp3",
    		poster: "http://p1.music.126.net/DSTg1dR7yKsyGq4IK3NL8A==/109951163046050093.jpg?param=130y130"
	},
   
],{
    playlistOptions: {
        autoPlay: true,
        enableRemoveControls: true
    },
	loop: true,
    swfPath: "js/",
    supplied: "webmv, ogv, m4v, oga, mp3",
    useStateClassSkin: true,
    autoBlur: true,
    smoothPlayBar: true,
    keyEnabled: true,
    audioFullScreen: true,
  	volume: .14
});
var latest = [{
    title: "默",
    artist: "那英",
    mp3: "http://music.163.com/song/media/outer/url?id=31473269.mp3 ",
    poster: "http://p1.music.126.net/OCGt5ln0lPPtPbVJ3VEKtA==/109951163020570422.jpg?param=130y130"
}];
var spirit = [{
    title: "M19+20",
    artist: "梶浦由記",
    mp3: "http://music.163.com/song/media/outer/url?id=591753.mp3 ",
    poster: "http://p1.music.126.net/lW4YKD6cMgm32nI66CzWVg==/5702067301704441.jpg?param=130y130"
}];
	
}
	

	
	
	
	
$("#latest li").find("a.playIcon").click(function() {
    var k = $(this).parent("li").index();
    myPlaylist.add({
        title: latest[k].title,
        artist: latest[k].artist,
        mp3: latest[k].mp3,
        poster: latest[k].poster
    });
    myPlaylist.play(-1);
});
$("#popular li").find("a.playIcon").click(function() {
    var k = $(this).parent("li").index();
    myPlaylist.add({
        title: popular[k].title,
        artist: popular[k].artist,
        mp3: popular[k].mp3,
        poster: popular[k].poster
    });
    myPlaylist.play(-1);
});
$("#rank li").find("a.playIcon").click(function() {
    var k = $(this).parent("li").index();
    myPlaylist.add({
        title: rank[k].title,
        artist: rank[k].artist,
        mp3: rank[k].mp3,
        poster: rank[k].poster
    });
    myPlaylist.play(-1);
});
$("#main li").find("a.playIcon").click(function() {
    var k = $(this).parent("li").index();
    myPlaylist.add({
        title: main[k].title,
        artist: main[k].artist,
        mp3: main[k].mp3,
        poster: main[k].poster
    });
    myPlaylist.play(-1);
});
$("#spirit li").find("a.playIcon").click(function() {
    var k = $(this).parent("li").index();
    myPlaylist.add({
        title: spirit[k].title,
        artist: spirit[k].artist,
        mp3: spirit[k].mp3,
        poster: spirit[k].poster
    });
    myPlaylist.play(-1);
});
$("#magic li").find("a.playIcon").click(function() {
    var m = $(this).parent("li").index();
    myPlaylist.add({
        title: magic[m].title,
        artist: magic[m].artist,
        mp3: magic[m].mp3,
        poster: magic[m].poster
    });
    myPlaylist.play(-1);
});
$("#playlist-remove").click(function() {
    myPlaylist.remove();
});
$("#listRemove").click(function() {
	alert("删除就都没啦");
    myPlaylist.remove();
});
$("#playlist-next").click(function() {
    myPlaylist.next();
});
$("#playlist-previous").click(function() {
    myPlaylist.previous();
});
$("#playlist-play").click(function() {
    myPlaylist.play();
});
$("#playlist-play--2").click(function() {
    myPlaylist.play(-2);
});
$("#playlist-play--1").click(function() {
    myPlaylist.play(-1);
});
$("#playlist-play-0").click(function() {
    myPlaylist.play(0);
});
$("#playlist-play-1").click(function() {
    myPlaylist.play(1);
});
$("#playlist-play-2").click(function() {
    myPlaylist.play(2);
});
$("#playlist-pause").click(function() {
    myPlaylist.pause();
});
$("#playlist-option-autoPlay-true").click(function() {
    myPlaylist.option("autoPlay", true);
});
$("#playlist-option-autoPlay-false").click(function() {
    myPlaylist.option("autoPlay", false);
});
var $bar = $(".bar");
var $scrollBar = $(".scrollBar");
var $maxH = $scrollBar.innerHeight() - $bar.outerHeight();
var $ul = $(".jp-playlist ul");
var $li = $(".jp-playlist ul li");
var disY = 0;
var iScale = 0;
var iSpeed = 0;
$ul.height(1000);
$bar.mousedown(function(event) {
    var event = event || window.event;
    disY = event.clientY - $(this).position().top;
    $(document).bind("mousemove", function(event) {
        var event = event || window.event;
        var iH = event.clientY - disY;
        iH <= 0 && (iH = 0);
        iH >= $maxH && (iH = $maxH);
        $bar.css({
            top: iH + "px"
        });
        iScale = -iH / $maxH;
        $ul.css({
            top: iScale * ($ul.height() - $(".jp-playlist-box").height()) + "px"
        });
        return false;
    });
    $(document).bind("mouseup", function() {
        $(document).unbind("mousemove");
        $(document).unbind("mouseup");
    });
    return false;
});
$(".jp-playlist-box").mouseover(function() {
    addHandler(this, "mousewheel", mouseWheel);
    addHandler(this, "DOMMouseScroll", mouseWheel);
    return false;
});
function addHandler(element, type, handler) {
    return element.addEventListener ? element.addEventListener(type, handler, false) : element.attachEvent("on" + type, handler, false)
}
function mouseWheel(event) {
    var event = event || window.event;
    if (event.wheelDelta) {
        iSpeed = event.wheelDelta > 0 ? -3 : 3;
    } else if (event.detail) {
        iSpeed = event.detail < 0 ? -3 : 3;
    }
    move();
    if (event.preventDefault) {
        event.preventDefault();
    }
}
;function move() {
    var iH = $bar.position().top;
    iH = iH + iSpeed;
    iH <= 0 && (iH = 0);
    iH >= $maxH && (iH = $maxH);
    $bar.css({
        top: iH + "px"
    });
    iScale = -iH / $maxH;
    $ul.css({
        top: iScale * ($ul.height() - $(".jp-playlist-box").height()) + "px"
    });
    return false;
}
;var fold = true;
$(".jp-video").animate({
/*默认弹出*/
    /* left: 0 */
    left: "-480px"
}, "slow", function() {
    slideOut($(this));
}).delay(0).animate({
    left: "-480px"
}, 350, function() {
    slideIn($(this));
});
$("#btnfold").mouseover(function() {
    if (fold) {
        $(".jp-video").animate({
            left: "-480px"
        }, 350, function() {
            slideIn($(this));
        });
    } else {
        $(".jp-video").animate({
            left: 0
        }, 350, function() {
            slideOut($(this));
        });
    }
});
function slideOut(obj) {
    $("#btnfold").attr({
        "title": "点击收缩"
    });
    obj.find("span").css({
        "transform": "rotate(180deg)"
    });
    obj.find("span").css({
        "MozTransform": "rotate(180deg) translateX(2px)"
    });
    obj.find("span").css({
        "WebkitTransform": "rotate(180deg)"
    });
    fold = true;
}
;function slideIn(obj) {
    $("#btnfold").attr({
        "title": "点击展开"
    });
    obj.find("span").css({
        "transform": "rotate(0deg)"
    });
    obj.find("span").css({
        "MozTransform": "rotate(0deg) translateX(-2px)"
    });
    obj.find("span").css({
        "WebkitTransform": "rotate(0deg)"
    });
    fold = false;
}
;var iOpen = false;
$("#listClose").click(function() {
    if (iOpen) {
        $(".jp-playlist-box").animate({
            height: 0
        }, 100);
        $("#btnfold").css({
            top: "5px"
        });
        $("#listRemove").css({
            display: "none"
        });
        $(".scrollBar").css({
            display: "none"
        });
        $(".jp-video").animate({
            height: "94px",
            bottom: "20px"
        }, 100);
        iOpen = false;
    } else {
        $(".jp-playlist-box").animate({
            height: "80px"
        }, 100);
        $("#btnfold").css({
            top: "52px"
        });
        $("#listRemove").css({
            display: "block"
        });
        $(".scrollBar").css({
            display: "block"
        });
        $(".jp-video").animate({
            height: "175px",
            bottom: "20px"
        }, 100);
        iOpen = true;
    }
});

	
	
	
</script>









<style>

.containerTop {
	position: fixed;
	right: 15px;
	bottom: 30px;
	    opacity: 0.5;
	    z-index: 9999;
}

#myPath path {
  transform: translate(0.125px, 0.033px);
}

.containerTop .heart-wrap {
  cursor: pointer;
  perspective: 200px;
  filter: drop-shadow(0px 10px 10px rgba(174, 196, 238, 0.5));
}

.containerTop .heart {
  position: relative;
  height: 70px;
  width: 80px;
  overflow: hidden;
  background-image: radial-gradient(#c9d8f5 60%, #afc4ee);
	

	

	clip-path: polygon(50% 0%, 100% 100%, 50% 66%, 0 100%);
	

	
}
	

.containerTop .tank {
  position: absolute;
  bottom: 0;
  height: 0;
  width: 80px;
  background-color: #6782bf;
  z-index: 5;
}

.containerTop .curve {
  position: absolute;
  bottom: calc(-1 * 20px);
  width: 80px;
  height: 20px;
}
	.containerTop svg{
		position: fixed;z-index: -1;
	}
.containerTop .curve use {
  animation: cTop 2s cubic-bezier(0.55, 0.5, 0.45, 0.5) infinite;
}
.containerTop .curve use:nth-child(1) {
  animation-duration: 3s;
}
.containerTop .curve use:nth-child(2) {
  animation-duration: 4s;
}
.containerTop .curve use:nth-child(3) {
  animation-duration: 2s;
}

@keyframes cTop {
  0% {
    transform: translateX(-90px);
  }
  100% {
    transform: translateX(85px);
  }
}

</style>

<script>
! function (o) {
  "use strict";
  o.fn.toTop = function (t) {
    var i = this,
      e = o(window),
      s = o("html, body"),
      n = o.extend({
        autohide: !0,
        offset: 420,
        speed: 500,
        position: !0,
        right: 15,
        bottom: 30
      }, t);
    i.css({
      cursor: "pointer"
    }), n.autohide && i.css("display", "none"), n.position && i.css({
      position: "fixed",
      right: n.right,
      bottom: n.bottom
    }), i.click(function () {
      s.animate({
        scrollTop: 0
      }, n.speed)
    }), e.scroll(function () {
      var o = e.scrollTop();
      n.autohide && (o > n.offset ? i.fadeIn(n.speed) : i.fadeOut(n.speed))
    })
  }
}(jQuery);

</script>

<script>
/*!
 * https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.6/gsap.min.js
 * GSAP 3.2.6
 * https://greensock.com
 * 
 * @license Copyright 2020, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).window=t.window||{})}(this,function(e){"use strict";function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function n(t){return"string"==typeof t}function o(t){return"function"==typeof t}function p(t){return"number"==typeof t}function q(t){return void 0===t}function r(t){return"object"==typeof t}function s(t){return!1!==t}function t(){return"undefined"!=typeof window}function u(t){return o(t)||n(t)}function K(t){return(l=pt(t,at))&&ie}function L(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")}function M(t,e){return!e&&console.warn(t)}function N(t,e){return t&&(at[t]=e)&&l&&(l[t]=e)||at}function O(){return 0}function Y(t){var e,i,n=t[0];if(r(n)||o(n)||(t=[t]),!(e=(n._gsap||{}).harness)){for(i=dt.length;i--&&!dt[i].targetTest(n););e=dt[i]}for(i=t.length;i--;)t[i]&&(t[i]._gsap||(t[i]._gsap=new Ft(t[i],e)))||t.splice(i,1);return t}function Z(t){return t._gsap||Y(yt(t))[0]._gsap}function $(t,e){var r=t[e];return o(r)?t[e]():q(r)&&t.getAttribute(e)||r}function _(t,e){return(t=t.split(",")).forEach(e)||t}function aa(t){return Math.round(1e5*t)/1e5||0}function ba(t,e){for(var r=e.length,i=0;t.indexOf(e[i])<0&&++i<r;);return i<r}function ca(t,e,r){var i,n=p(t[1]),a=(n?2:1)+(e<2?0:1),o=t[a];if(n&&(o.duration=t[1]),o.parent=r,e){for(i=o;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=s(r.vars.inherit)&&r.parent;o.immediateRender=s(i.immediateRender),e<2?o.runBackwards=1:o.startAt=t[a-1]}return o}function da(){var t,e,r=ot.length,i=ot.slice(0);for(ut={},t=ot.length=0;t<r;t++)(e=i[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)}function ea(t,e,r,i){ot.length&&da(),t.render(e,r,i),ot.length&&da()}function fa(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(nt).length<2?e:t}function ga(t){return t}function ha(t,e){for(var r in e)r in t||(t[r]=e[r]);return t}function ia(t,e){for(var r in e)r in t||"duration"===r||"ease"===r||(t[r]=e[r])}function ka(t,e){for(var i in e)t[i]=r(e[i])?ka(t[i]||(t[i]={}),e[i]):e[i];return t}function la(t,e){var r,i={};for(r in t)r in e||(i[r]=t[r]);return i}function ma(t){var e=t.parent||F,r=t.keyframes?ia:ha;if(s(t.inherit))for(;e;)r(t,e.vars.defaults),e=e.parent;return t}function pa(t,e,r,i){void 0===r&&(r="_first"),void 0===i&&(i="_last");var n=e._prev,a=e._next;n?n._next=a:t[r]===e&&(t[r]=a),a?a._prev=n:t[i]===e&&(t[i]=n),e._next=e._prev=e.parent=null}function qa(t,e){!t.parent||e&&!t.parent.autoRemoveChildren||t.parent.remove(t),t._act=0}function ra(t){for(var e=t;e;)e._dirty=1,e=e.parent;return t}function ua(t){return t._repeat?_t(t._tTime,t=t.duration()+t._rDelay)*t:0}function wa(t,e){return(t-e._start)*e._ts+(0<=e._ts?0:e._dirty?e.totalDuration():e._tDur)}function xa(t){return t._end=aa(t._start+(t._tDur/Math.abs(t._ts||t._rts||B)||0))}function ya(t,e){var r;if((e._time||e._initted&&!e._dur)&&(r=wa(t.rawTime(),e),(!e._dur||gt(0,e.totalDuration(),r)-e._tTime>B)&&e.render(r,!0)),ra(t)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(r=t;r._dp;)0<=r.rawTime()&&r.totalTime(r._tTime),r=r._dp;t._zTime=-B}}function za(t,e,r,i){return e.parent&&qa(e),e._start=aa(r+e._delay),e._end=aa(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),function _addLinkedListItem(t,e,r,i,n){void 0===r&&(r="_first"),void 0===i&&(i="_last");var a,s=t[i];if(n)for(a=e[n];s&&s[n]>a;)s=s._prev;s?(e._next=s._next,s._next=e):(e._next=t[r],t[r]=e),e._next?e._next._prev=e:t[i]=e,e._prev=s,e.parent=e._dp=t}(t,e,"_first","_last",t._sort?"_start":0),t._recent=e,i||ya(t,e),t}function Aa(t,e,r,i){return qt(t,e),t._initted?!r&&t._pt&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&d!==Ot.frame?(ot.push(t),t._lazy=[e,i],1):void 0:1}function Da(t,e,r){var i=t._repeat,n=aa(e)||0;return t._dur=n,t._tDur=i?i<0?1e12:aa(n*(i+1)+t._rDelay*i):n,t._time>n&&(t._time=n,t._tTime=Math.min(t._tTime,t._tDur)),r||ra(t.parent),t.parent&&xa(t),t}function Ea(t){return t instanceof Bt?ra(t):Da(t,t._dur)}function Ga(t,e){var r,i,a=t.labels,s=t._recent||mt,o=t.duration()>=R?s.endTime(!1):t._dur;return n(e)&&(isNaN(e)||e in a)?"<"===(r=e.charAt(0))||">"===r?("<"===r?s._start:s.endTime(0<=s._repeat))+(parseFloat(e.substr(1))||0):(r=e.indexOf("="))<0?(e in a||(a[e]=o),a[e]):(i=+(e.charAt(r-1)+e.substr(r+1)),1<r?Ga(t,e.substr(0,r-1))+i:o+i):null==e?o:+e}function Ha(t,e){return t||0===t?e(t):e}function Ja(t){return(t+"").substr((parseFloat(t)+"").length)}function Ma(t,e){return t&&r(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&r(t[0]))&&!t.nodeType&&t!==i}function Pa(t){return t.sort(function(){return.5-Math.random()})}function Qa(t){if(o(t))return t;var p=r(t)?t:{each:t},_=Dt(p.ease),m=p.from||0,g=parseFloat(p.base)||0,v={},e=0<m&&m<1,y=isNaN(m)||e,T=p.axis,b=m,w=m;return n(m)?b=w={center:.5,edges:.5,end:1}[m]||0:!e&&y&&(b=m[0],w=m[1]),function(t,e,r){var i,n,a,s,o,u,h,l,f,d=(r||p).length,c=v[d];if(!c){if(!(f="auto"===p.grid?0:(p.grid||[1,R])[1])){for(h=-R;h<(h=r[f++].getBoundingClientRect().left)&&f<d;);f--}for(c=v[d]=[],i=y?Math.min(f,d)*b-.5:m%f,n=y?d*w/f-.5:m/f|0,l=R,u=h=0;u<d;u++)a=u%f-i,s=n-(u/f|0),c[u]=o=T?Math.abs("y"===T?s:a):j(a*a+s*s),h<o&&(h=o),o<l&&(l=o);"random"===m&&Pa(c),c.max=h-l,c.min=l,c.v=d=(parseFloat(p.amount)||parseFloat(p.each)*(d<f?d-1:T?"y"===T?d/f:f:Math.max(f,d/f))||0)*("edges"===m?-1:1),c.b=d<0?g-d:g,c.u=Ja(p.amount||p.each)||0,_=_&&d<0?zt(_):_}return d=(c[t]-c.min)/c.max||0,aa(c.b+(_?_(d):d)*c.v)+c.u}}function Ra(e){var r=e<1?Math.pow(10,(e+"").length-2):1;return function(t){return~~(Math.round(parseFloat(t)/e)*e*r)/r+(p(t)?0:Ja(t))}}function Sa(u,t){var h,l,e=H(u);return!e&&r(u)&&(h=e=u.radius||R,u.values?(u=yt(u.values),(l=!p(u[0]))&&(h*=h)):u=Ra(u.increment)),Ha(t,e?o(u)?function(t){return l=u(t),Math.abs(l-t)<=h?l:t}:function(t){for(var e,r,i=parseFloat(l?t.x:t),n=parseFloat(l?t.y:0),a=R,s=0,o=u.length;o--;)(e=l?(e=u[o].x-i)*e+(r=u[o].y-n)*r:Math.abs(u[o]-i))<a&&(a=e,s=o);return s=!h||a<=h?u[s]:t,l||s===t||p(t)?s:s+Ja(t)}:Ra(u))}function Ta(t,e,r,i){return Ha(H(t)?!e:!0===r?!!(r=0):!i,function(){return H(t)?t[~~(Math.random()*t.length)]:(r=r||1e-5)&&(i=r<1?Math.pow(10,(r+"").length-2):1)&&~~(Math.round((t+Math.random()*(e-t))/r)*r*i)/i})}function Xa(e,r,t){return Ha(t,function(t){return e[~~r(t)]})}function $a(t){for(var e,r,i,n,a=0,s="";~(e=t.indexOf("random(",a));)i=t.indexOf(")",e),n="["===t.charAt(e+7),r=t.substr(e+7,i-e-7).match(n?nt:Q),s+=t.substr(a,e-a)+Ta(n?r:+r[0],+r[1],+r[2]||1e-5),a=i+1;return s+t.substr(a,t.length-a)}function bb(t,e,r){var i,n,a,s=t.labels,o=R;for(i in s)(n=s[i]-e)<0==!!r&&n&&o>(n=Math.abs(n))&&(a=i,o=n);return a}function db(t){return qa(t),t.progress()<1&&bt(t,"onInterrupt"),t}function ib(t,e,r){return(6*(t=t<0?t+1:1<t?t-1:t)<1?e+(r-e)*t*6:t<.5?r:3*t<2?e+(r-e)*(2/3-t)*6:e)*wt+.5|0}function jb(t,e,r){var i,n,a,s,o,u,h,l,f,d,c=t?p(t)?[t>>16,t>>8&wt,t&wt]:0:xt.black;if(!c){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),xt[t])c=xt[t];else if("#"===t.charAt(0))4===t.length&&(t="#"+(i=t.charAt(1))+i+(n=t.charAt(2))+n+(a=t.charAt(3))+a),c=[(t=parseInt(t.substr(1),16))>>16,t>>8&wt,t&wt];else if("hsl"===t.substr(0,3))if(c=d=t.match(Q),e){if(~t.indexOf("="))return c=t.match(W),r&&c.length<4&&(c[3]=1),c}else s=+c[0]%360/360,o=c[1]/100,i=2*(u=c[2]/100)-(n=u<=.5?u*(o+1):u+o-u*o),3<c.length&&(c[3]*=1),c[0]=ib(s+1/3,i,n),c[1]=ib(s,i,n),c[2]=ib(s-1/3,i,n);else c=t.match(Q)||xt.transparent;c=c.map(Number)}return e&&!d&&(i=c[0]/wt,n=c[1]/wt,a=c[2]/wt,u=((h=Math.max(i,n,a))+(l=Math.min(i,n,a)))/2,h===l?s=o=0:(f=h-l,o=.5<u?f/(2-h-l):f/(h+l),s=h===i?(n-a)/f+(n<a?6:0):h===n?(a-i)/f+2:(i-n)/f+4,s*=60),c[0]=~~(s+.5),c[1]=~~(100*o+.5),c[2]=~~(100*u+.5)),r&&c.length<4&&(c[3]=1),c}function kb(t){var r=[],i=[],n=-1;return t.split(kt).forEach(function(t){var e=t.match(tt)||[];r.push.apply(r,e),i.push(n+=e.length+1)}),r.c=i,r}function lb(t,e,r){var i,n,a,s,o="",u=(t+o).match(kt),h=e?"hsla(":"rgba(",l=0;if(!u)return t;if(u=u.map(function(t){return(t=jb(t,e,1))&&h+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"}),r&&(a=kb(t),(i=r.c).join(o)!==a.c.join(o)))for(s=(n=t.replace(kt,"1").split(tt)).length-1;l<s;l++)o+=n[l]+(~i.indexOf(l)?u.shift()||h+"0,0,0,0)":(a.length?a:u.length?u:r).shift());if(!n)for(s=(n=t.split(kt)).length-1;l<s;l++)o+=n[l]+u[l];return o+n[s]}function ob(t){var e,r=t.join(" ");if(kt.lastIndex=0,kt.test(r))return e=Mt.test(r),t[1]=lb(t[1],e),t[0]=lb(t[0],e,kb(t[1])),!0}function wb(t){var e=(t+"").split("("),r=Pt[e[0]];return r&&1<e.length&&r.config?r.config.apply(null,~t.indexOf("{")?[function _parseObjectInString(t){for(var e,r,i,n={},a=t.substr(1,t.length-3).split(":"),s=a[0],o=1,u=a.length;o<u;o++)r=a[o],e=o!==u-1?r.lastIndexOf(","):r.length,i=r.substr(0,e),n[s]=isNaN(i)?i.replace(St,"").trim():+i,s=r.substr(e+1).trim();return n}(e[1])]:rt.exec(t)[1].split(",").map(fa)):Pt._CE&&At.test(t)?Pt._CE("",t):r}function zb(t,e,r,i){void 0===r&&(r=function easeOut(t){return 1-e(1-t)}),void 0===i&&(i=function easeInOut(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var n,a={easeIn:e,easeOut:r,easeInOut:i};return _(t,function(t){for(var e in Pt[t]=at[t]=a,Pt[n=t.toLowerCase()]=r,a)Pt[n+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Pt[t+"."+e]=a[e]}),a}function Ab(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}}function Bb(r,t,e){function Yk(t){return 1===t?1:i*Math.pow(2,-10*t)*J((t-a)*n)+1}var i=1<=t?t:1,n=(e||(r?.3:.45))/(t<1?t:1),a=n/I*(Math.asin(1/i)||0),s="out"===r?Yk:"in"===r?function(t){return 1-Yk(1-t)}:Ab(Yk);return n=I/n,s.config=function(t,e){return Bb(r,t,e)},s}function Cb(e,r){function el(t){return t?--t*t*((r+1)*t+r)+1:0}void 0===r&&(r=1.70158);var t="out"===e?el:"in"===e?function(t){return 1-el(1-t)}:Ab(el);return t.config=function(t){return Cb(e,t)},t}var F,i,a,h,l,f,d,c,m,g,v,y,T,b,w,x,k,C,P,A,S,z,D,G={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},E={duration:.5,overwrite:!1,delay:0},R=1e8,B=1/R,I=2*Math.PI,U=I/4,X=0,j=Math.sqrt,V=Math.cos,J=Math.sin,H=Array.isArray,Q=/(?:-?\.?\d|\.)+/gi,W=/[-+=.]*\d+[.e\-+]*\d*[e\-\+]*\d*/g,tt=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,et=/[-+=.]*\d+(?:\.|e-|e)*\d*/gi,rt=/\(([^()]+)\)/i,it=/[+-]=-?[\.\d]+/,nt=/[#\-+.]*\b[a-z\d-=+%.]+/gi,at={},st={},ot=[],ut={},ht={},lt={},ft=30,dt=[],ct="",pt=function _merge(t,e){for(var r in e)t[r]=e[r];return t},_t=function _animationCycle(t,e){return(t/=e)&&~~t===t?~~t-1:~~t},mt={_start:0,endTime:O},gt=function _clamp(t,e,r){return r<t?t:e<r?e:r},vt=[].slice,yt=function toArray(t,e){return!n(t)||e||!a&&Ct()?H(t)?function _flatten(t,e,r){return void 0===r&&(r=[]),t.forEach(function(t){return n(t)&&!e||Ma(t,1)?r.push.apply(r,yt(t)):r.push(t)})||r}(t,e):Ma(t)?vt.call(t,0):t?[t]:[]:vt.call(h.querySelectorAll(t),0)},Tt=function mapRange(e,t,r,i,n){var a=t-e,s=i-r;return Ha(n,function(t){return r+(t-e)/a*s})},bt=function _callback(t,e,r){var i,n,a=t.vars,s=a[e];if(s)return i=a[e+"Params"],n=a.callbackScope||t,r&&ot.length&&da(),i?s.apply(n,i):s.call(n)},wt=255,xt={aqua:[0,wt,wt],lime:[0,wt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,wt],navy:[0,0,128],white:[wt,wt,wt],olive:[128,128,0],yellow:[wt,wt,0],orange:[wt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[wt,0,0],pink:[wt,192,203],cyan:[0,wt,wt],transparent:[wt,wt,wt,0]},kt=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(t in xt)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),Mt=/hsl[a]?\(/,Ot=(b=Date.now,w=500,x=33,k=b(),C=k,A=P=1/240,T={time:0,frame:0,tick:function tick(){ck(!0)},wake:function wake(){f&&(!a&&t()&&(i=a=window,h=i.document||{},at.gsap=ie,(i.gsapVersions||(i.gsapVersions=[])).push(ie.version),K(l||i.GreenSockGlobals||!i.gsap&&i||{}),y=i.requestAnimationFrame),g&&T.sleep(),v=y||function(t){return setTimeout(t,1e3*(A-T.time)+1|0)},m=1,ck(2))},sleep:function sleep(){(y?i.cancelAnimationFrame:clearTimeout)(g),m=0,v=O},lagSmoothing:function lagSmoothing(t,e){w=t||1e8,x=Math.min(e,w,0)},fps:function fps(t){P=1/(t||240),A=T.time+P},add:function add(t){S.indexOf(t)<0&&S.push(t),Ct()},remove:function remove(t){var e;~(e=S.indexOf(t))&&S.splice(e,1)},_listeners:S=[]}),Ct=function _wake(){return!m&&Ot.wake()},Pt={},At=/^[\d.\-M][\d.\-,\s]/,St=/["']/g,zt=function _invertEase(e){return function(t){return 1-e(1-t)}},Dt=function _parseEase(t,e){return t&&(o(t)?t:Pt[t]||wb(t))||e};function ck(e){var t,r,i=b()-C,n=!0===e;w<i&&(k+=i-x),C+=i,T.time=(C-k)/1e3,(0<(t=T.time-A)||n)&&(T.frame++,A+=t+(P<=t?.004:P-t),r=1),n||(g=v(ck)),r&&S.forEach(function(t){return t(T.time,i,T.frame,e)})}function vl(t){return t<D?z*t*t:t<.7272727272727273?z*Math.pow(t-1.5/2.75,2)+.75:t<.9090909090909092?z*(t-=2.25/2.75)*t+.9375:z*Math.pow(t-2.625/2.75,2)+.984375}_("Linear,Quad,Cubic,Quart,Quint,Strong",function(t,e){var r=e<5?e+1:e;zb(t+",Power"+(r-1),e?function(t){return Math.pow(t,r)}:function(t){return t},function(t){return 1-Math.pow(1-t,r)},function(t){return t<.5?Math.pow(2*t,r)/2:1-Math.pow(2*(1-t),r)/2})}),Pt.Linear.easeNone=Pt.none=Pt.Linear.easeIn,zb("Elastic",Bb("in"),Bb("out"),Bb()),z=7.5625,D=1/2.75,zb("Bounce",function(t){return 1-vl(1-t)},vl),zb("Expo",function(t){return t?Math.pow(2,10*(t-1)):0}),zb("Circ",function(t){return-(j(1-t*t)-1)}),zb("Sine",function(t){return 1-V(t*U)}),zb("Back",Cb("in"),Cb("out"),Cb()),Pt.SteppedEase=Pt.steps=at.SteppedEase={config:function config(t,e){void 0===t&&(t=1);var r=1/t,i=t+(e?0:1),n=e?1:0;return function(t){return((i*gt(0,.99999999,t)|0)+n)*r}}},E.ease=Pt["quad.out"],_("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(t){return ct+=t+","+t+"Params,"});var Rt,Ft=function GSCache(t,e){this.id=X++,(t._gsap=this).target=t,this.harness=e,this.get=e?e.get:$,this.set=e?e.getSetter:Zt},Et=((Rt=Animation.prototype).delay=function delay(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},Rt.duration=function duration(t){return arguments.length?this.totalDuration(0<this._repeat?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},Rt.totalDuration=function totalDuration(t){return arguments.length?(this._dirty=0,Da(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},Rt.totalTime=function totalTime(t,e){if(Ct(),!arguments.length)return this._tTime;var r=this.parent||this._dp;if(r&&r.smoothChildTiming&&this._ts){for(this._start=aa(r._time-(0<this._ts?t/this._ts:((this._dirty?this.totalDuration():this._tDur)-t)/-this._ts)),xa(this),r._dirty||ra(r);r.parent;)r.parent._time!==r._start+(0<=r._ts?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&za(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===B)&&(this._ts||(this._pTime=t),ea(this,t,e)),this},Rt.time=function time(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+ua(this))%this._dur||(t?this._dur:0),e):this._time},Rt.totalProgress=function totalProgress(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},Rt.progress=function progress(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+ua(this),e):this.duration()?Math.min(1,this._time/this._dur):this.ratio},Rt.iteration=function iteration(t,e){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*r,e):this._repeat?_t(this._tTime,r)+1:1},Rt.timeScale=function timeScale(t){if(!arguments.length)return this._rts===-B?0:this._rts;if(this._rts===t)return this;var e=this.parent&&this._ts?wa(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||t===-B?0:this._rts,function _recacheAncestors(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t}(this.totalTime(gt(0,this._tDur,e),!0))},Rt.paused=function paused(t){return arguments.length?(this._ps!==t&&((this._ps=t)?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Ct(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&(this._tTime-=B)&&Math.abs(this._zTime)!==B))),this):this._ps},Rt.startTime=function startTime(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return!e||!e._sort&&this.parent||za(e,this,t-this._delay),this}return this._start},Rt.endTime=function endTime(t){return this._start+(s(t)?this.totalDuration():this.duration())/Math.abs(this._ts)},Rt.rawTime=function rawTime(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?wa(e.rawTime(t),this):this._tTime:this._tTime},Rt.repeat=function repeat(t){return arguments.length?(this._repeat=t,Ea(this)):this._repeat},Rt.repeatDelay=function repeatDelay(t){return arguments.length?(this._rDelay=t,Ea(this)):this._rDelay},Rt.yoyo=function yoyo(t){return arguments.length?(this._yoyo=t,this):this._yoyo},Rt.seek=function seek(t,e){return this.totalTime(Ga(this,t),s(e))},Rt.restart=function restart(t,e){return this.play().totalTime(t?-this._delay:0,s(e))},Rt.play=function play(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},Rt.reverse=function reverse(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},Rt.pause=function pause(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},Rt.resume=function resume(){return this.paused(!1)},Rt.reversed=function reversed(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-B:0)),this):this._rts<0},Rt.invalidate=function invalidate(){return this._initted=0,this._zTime=-B,this},Rt.isActive=function isActive(t){var e,r=this.parent||this._dp,i=this._start;return!(r&&!(this._ts&&(this._initted||!t)&&r.isActive(t)&&(e=r.rawTime(!0))>=i&&e<this.endTime(!0)-B))},Rt.eventCallback=function eventCallback(t,e,r){var i=this.vars;return 1<arguments.length?(e?(i[t]=e,r&&(i[t+"Params"]=r),"onUpdate"===t&&(this._onUpdate=e)):delete i[t],this):i[t]},Rt.then=function then(t){var i=this;return new Promise(function(e){function Km(){var t=i.then;i.then=null,o(r)&&(r=r(i))&&(r.then||r===i)&&(i.then=t),e(r),i.then=t}var r=o(t)?t:ga;i._initted&&1===i.totalProgress()&&0<=i._ts||!i._tTime&&i._ts<0?Km():i._prom=Km})},Rt.kill=function kill(){db(this)},Animation);function Animation(t,e){var r=t.parent||F;this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Da(this,+t.duration,1),this.data=t.data,m||Ot.wake(),r&&za(r,this,e||0===e?e:r._time,1),t.reversed&&this.reverse(),t.paused&&this.paused(!0)}ha(Et.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-B,_prom:0,_ps:!1,_rts:1});var Bt=function(i){function Timeline(t,e){var r;return void 0===t&&(t={}),(r=i.call(this,t,e)||this).labels={},r.smoothChildTiming=!!t.smoothChildTiming,r.autoRemoveChildren=!!t.autoRemoveChildren,r._sort=s(t.sortChildren),r.parent&&ya(r.parent,_assertThisInitialized(r)),r}_inheritsLoose(Timeline,i);var t=Timeline.prototype;return t.to=function to(t,e,r,i){return new Ut(t,ca(arguments,0,this),Ga(this,p(e)?i:r)),this},t.from=function from(t,e,r,i){return new Ut(t,ca(arguments,1,this),Ga(this,p(e)?i:r)),this},t.fromTo=function fromTo(t,e,r,i,n){return new Ut(t,ca(arguments,2,this),Ga(this,p(e)?n:i)),this},t.set=function set(t,e,r){return e.duration=0,e.parent=this,ma(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new Ut(t,e,Ga(this,r),1),this},t.call=function call(t,e,r){return za(this,Ut.delayedCall(0,t,e),Ga(this,r))},t.staggerTo=function staggerTo(t,e,r,i,n,a,s){return r.duration=e,r.stagger=r.stagger||i,r.onComplete=a,r.onCompleteParams=s,r.parent=this,new Ut(t,r,Ga(this,n)),this},t.staggerFrom=function staggerFrom(t,e,r,i,n,a,o){return r.runBackwards=1,ma(r).immediateRender=s(r.immediateRender),this.staggerTo(t,e,r,i,n,a,o)},t.staggerFromTo=function staggerFromTo(t,e,r,i,n,a,o,u){return i.startAt=r,ma(i).immediateRender=s(i.immediateRender),this.staggerTo(t,e,i,n,a,o,u)},t.render=function render(t,e,r){var i,n,a,s,o,u,h,l,f,d,c,p,_=this._time,m=this._dirty?this.totalDuration():this._tDur,g=this._dur,v=this!==F&&m-B<t&&0<=t?m:t<B?0:t,y=this._zTime<0!=t<0&&(this._initted||!g);if(v!==this._tTime||r||y){if(_!==this._time&&g&&(v+=this._time-_,t+=this._time-_),i=v,f=this._start,u=!(l=this._ts),y&&(g||(_=this._zTime),!t&&e||(this._zTime=t)),this._repeat&&(c=this._yoyo,o=g+this._rDelay,(g<(i=aa(v%o))||m===v)&&(i=g),(s=~~(v/o))&&s===v/o&&(i=g,s--),c&&1&s&&(i=g-i,p=1),s!==(d=_t(this._tTime,o))&&!this._lock)){var T=c&&1&d,b=T===(c&&1&s);if(s<d&&(T=!T),_=T?0:g,this._lock=1,this.render(_,e,!g)._lock=0,!e&&this.parent&&bt(this,"onRepeat"),this.vars.repeatRefresh&&!p&&(this.invalidate()._lock=1),_!==this._time||u!=!this._ts)return this;if(b&&(this._lock=2,_=T?g+1e-4:-1e-4,this.render(_,!0),this.vars.repeatRefresh&&!p&&this.invalidate()),this._lock=0,!this._ts&&!u)return this}if(this._hasPause&&!this._forcing&&this._lock<2&&(h=function _findNextPauseTween(t,e,r){var i;if(e<r)for(i=t._first;i&&i._start<=r;){if(!i._dur&&"isPause"===i.data&&i._start>e)return i;i=i._next}else for(i=t._last;i&&i._start>=r;){if(!i._dur&&"isPause"===i.data&&i._start<e)return i;i=i._prev}}(this,aa(_),aa(i)))&&(v-=i-(i=h._start)),this._tTime=v,this._time=i,this._act=!l,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t),_||!i||e||bt(this,"onStart"),_<=i&&0<=t)for(n=this._first;n;){if(a=n._next,(n._act||i>=n._start)&&n._ts&&h!==n){if(n.parent!==this)return this.render(t,e,r);if(n.render(0<n._ts?(i-n._start)*n._ts:(n._dirty?n.totalDuration():n._tDur)+(i-n._start)*n._ts,e,r),i!==this._time||!this._ts&&!u){h=0,a&&(v+=this._zTime=-B);break}}n=a}else{n=this._last;for(var w=t<0?t:i;n;){if(a=n._prev,(n._act||w<=n._end)&&n._ts&&h!==n){if(n.parent!==this)return this.render(t,e,r);if(n.render(0<n._ts?(w-n._start)*n._ts:(n._dirty?n.totalDuration():n._tDur)+(w-n._start)*n._ts,e,r),i!==this._time||!this._ts&&!u){h=0,a&&(v+=this._zTime=w?-B:B);break}}n=a}}if(h&&!e&&(this.pause(),h.render(_<=i?0:-B)._zTime=_<=i?1:-1,this._ts))return this._start=f,xa(this),this.render(t,e,r);this._onUpdate&&!e&&bt(this,"onUpdate",!0),(v===m&&m>=this.totalDuration()||!v&&this._ts<0)&&(f!==this._start&&Math.abs(l)===Math.abs(this._ts)||this._lock||(!t&&g||!(t&&0<this._ts||!v&&this._ts<0)||qa(this,1),e||t<0&&!_||(bt(this,v===m?"onComplete":"onReverseComplete",!0),this._prom&&this._prom())))}return this},t.add=function add(t,e){var r=this;if(p(e)||(e=Ga(this,e)),!(t instanceof Et)){if(H(t))return t.forEach(function(t){return r.add(t,e)}),ra(this);if(n(t))return this.addLabel(t,e);if(!o(t))return this;t=Ut.delayedCall(0,t)}return this!==t?za(this,t,e):this},t.getChildren=function getChildren(t,e,r,i){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===r&&(r=!0),void 0===i&&(i=-R);for(var n=[],a=this._first;a;)a._start>=i&&(a instanceof Ut?e&&n.push(a):(r&&n.push(a),t&&n.push.apply(n,a.getChildren(!0,e,r)))),a=a._next;return n},t.getById=function getById(t){for(var e=this.getChildren(1,1,1),r=e.length;r--;)if(e[r].vars.id===t)return e[r]},t.remove=function remove(t){return n(t)?this.removeLabel(t):o(t)?this.killTweensOf(t):(pa(this,t),t===this._recent&&(this._recent=this._last),ra(this))},t.totalTime=function totalTime(t,e){return arguments.length?(this._forcing=1,this.parent||this._dp||!this._ts||(this._start=aa(Ot.time-(0<this._ts?t/this._ts:(this.totalDuration()-t)/-this._ts))),i.prototype.totalTime.call(this,t,e),this._forcing=0,this):this._tTime},t.addLabel=function addLabel(t,e){return this.labels[t]=Ga(this,e),this},t.removeLabel=function removeLabel(t){return delete this.labels[t],this},t.addPause=function addPause(t,e,r){var i=Ut.delayedCall(0,e||O,r);return i.data="isPause",this._hasPause=1,za(this,i,Ga(this,t))},t.removePause=function removePause(t){var e=this._first;for(t=Ga(this,t);e;)e._start===t&&"isPause"===e.data&&qa(e),e=e._next},t.killTweensOf=function killTweensOf(t,e,r){for(var i=this.getTweensOf(t,r),n=i.length;n--;)Lt!==i[n]&&i[n].kill(t,e);return this},t.getTweensOf=function getTweensOf(t,e){for(var r,i=[],n=yt(t),a=this._first;a;)a instanceof Ut?!ba(a._targets,n)||e&&!a.isActive("started"===e)||i.push(a):(r=a.getTweensOf(n,e)).length&&i.push.apply(i,r),a=a._next;return i},t.tweenTo=function tweenTo(t,e){e=e||{};var r=this,i=Ga(r,t),n=e.startAt,a=e.onStart,s=e.onStartParams,o=Ut.to(r,ha(e,{ease:"none",lazy:!1,time:i,duration:e.duration||Math.abs((i-(n&&"time"in n?n.time:r._time))/r.timeScale())||B,onStart:function onStart(){r.pause();var t=e.duration||Math.abs((i-r._time)/r.timeScale());o._dur!==t&&Da(o,t).render(o._time,!0,!0),a&&a.apply(o,s||[])}}));return o},t.tweenFromTo=function tweenFromTo(t,e,r){return this.tweenTo(e,ha({startAt:{time:Ga(this,t)}},r))},t.recent=function recent(){return this._recent},t.nextLabel=function nextLabel(t){return void 0===t&&(t=this._time),bb(this,Ga(this,t))},t.previousLabel=function previousLabel(t){return void 0===t&&(t=this._time),bb(this,Ga(this,t),1)},t.currentLabel=function currentLabel(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+B)},t.shiftChildren=function shiftChildren(t,e,r){void 0===r&&(r=0);for(var i,n=this._first,a=this.labels;n;)n._start>=r&&(n._start+=t),n=n._next;if(e)for(i in a)a[i]>=r&&(a[i]+=t);return ra(this)},t.invalidate=function invalidate(){var t=this._first;for(this._lock=0;t;)t.invalidate(),t=t._next;return i.prototype.invalidate.call(this)},t.clear=function clear(t){void 0===t&&(t=!0);for(var e,r=this._first;r;)e=r._next,this.remove(r),r=e;return this._time=this._tTime=0,t&&(this.labels={}),ra(this)},t.totalDuration=function totalDuration(t){var e,r,i,n,a=0,s=this,o=s._last,u=R;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-t:t));if(s._dirty){for(n=s.parent;o;)e=o._prev,o._dirty&&o.totalDuration(),u<(i=o._start)&&s._sort&&o._ts&&!s._lock?(s._lock=1,za(s,o,i-o._delay,1)._lock=0):u=i,i<0&&o._ts&&(a-=i,(!n&&!s._dp||n&&n.smoothChildTiming)&&(s._start+=i/s._ts,s._time-=i,s._tTime-=i),s.shiftChildren(-i,!1,-1e20),u=0),a<(r=xa(o))&&o._ts&&(a=r),o=e;Da(s,s===F&&s._time>a?s._time:Math.min(R,a),1),s._dirty=0}return s._tDur},Timeline.updateRoot=function updateRoot(t){if(F._ts&&(ea(F,wa(t,F)),d=Ot.frame),Ot.frame>=ft){ft+=G.autoSleep||120;var e=F._first;if((!e||!e._ts)&&G.autoSleep&&Ot._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||Ot.sleep()}}},Timeline}(Et);ha(Bt.prototype,{_lock:0,_hasPause:0,_forcing:0});function Jb(t,e,i,a,s,u){var h,l,f,d;if(ht[t]&&!1!==(h=new ht[t]).init(s,h.rawVars?e[t]:function _processVars(t,e,i,a,s){if(o(t)&&(t=Yt(t,s,e,i,a)),!r(t)||t.style&&t.nodeType||H(t))return n(t)?Yt(t,s,e,i,a):t;var u,h={};for(u in t)h[u]=Yt(t[u],s,e,i,a);return h}(e[t],a,s,u,i),i,a,u)&&(i._pt=l=new ee(i._pt,s,t,0,1,h.render,h,0,h.priority),i!==c))for(f=i._ptLookup[i._targets.indexOf(s)],d=h._props.length;d--;)f[h._props[d]]=l;return h}var Lt,It=function _addPropTween(t,e,r,i,a,s,u,h,l){o(i)&&(i=i(a||0,t,s));var f,d=t[e],c="get"!==r?r:o(d)?l?t[e.indexOf("set")||!o(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():d,p=o(d)?l?Vt:jt:Xt;if(n(i)&&(~i.indexOf("random(")&&(i=$a(i)),"="===i.charAt(1)&&(i=parseFloat(c)+parseFloat(i.substr(2))*("-"===i.charAt(0)?-1:1)+(Ja(c)||0))),c!==i)return isNaN(c+i)?(d||e in t||L(e,i),function _addComplexStringPropTween(t,e,r,i,n,a,s){var o,u,h,l,f,d,c,p,_=new ee(this._pt,t,e,0,1,Qt,null,n),m=0,g=0;for(_.b=r,_.e=i,r+="",(c=~(i+="").indexOf("random("))&&(i=$a(i)),a&&(a(p=[r,i],t,e),r=p[0],i=p[1]),u=r.match(et)||[];o=et.exec(i);)l=o[0],f=i.substring(m,o.index),h?h=(h+1)%5:"rgba("===f.substr(-5)&&(h=1),l!==u[g++]&&(d=parseFloat(u[g-1])||0,_._pt={_next:_._pt,p:f||1===g?f:",",s:d,c:"="===l.charAt(1)?parseFloat(l.substr(2))*("-"===l.charAt(0)?-1:1):parseFloat(l)-d,m:h&&h<4?Math.round:0},m=et.lastIndex);return _.c=m<i.length?i.substring(m,i.length):"",_.fp=s,(it.test(i)||c)&&(_.e=0),this._pt=_}.call(this,t,e,c,i,p,h||G.stringFilter,l)):(f=new ee(this._pt,t,e,+c||0,i-(c||0),"boolean"==typeof d?Ht:Jt,0,p),l&&(f.fp=l),u&&f.modifier(u,this,t),this._pt=f)},qt=function _initTween(t,e){var r,i,n,a,o,u,h,l,f,d,c,p,_=t.vars,m=_.ease,g=_.startAt,v=_.immediateRender,y=_.lazy,T=_.onUpdate,b=_.onUpdateParams,w=_.callbackScope,x=_.runBackwards,k=_.yoyoEase,M=_.keyframes,O=_.autoRevert,C=t._dur,P=t._startAt,A=t._targets,S=t.parent,z=S&&"nested"===S.data?S.parent._targets:A,D="auto"===t._overwrite,R=t.timeline;if(!R||M&&m||(m="none"),t._ease=Dt(m,E.ease),t._yEase=k?zt(Dt(!0===k?m:k,E.ease)):0,k&&t._yoyo&&!t._repeat&&(k=t._yEase,t._yEase=t._ease,t._ease=k),!R){if(P&&P.render(-1,!0).kill(),g){if(qa(t._startAt=Ut.set(A,ha({data:"isStart",overwrite:!1,parent:S,immediateRender:!0,lazy:s(y),startAt:null,delay:0,onUpdate:T,onUpdateParams:b,callbackScope:w,stagger:0},g))),v)if(0<e)O||(t._startAt=0);else if(C)return}else if(x&&C)if(P)O||(t._startAt=0);else if(e&&(v=!1),qa(t._startAt=Ut.set(A,pt(la(_,st),{overwrite:!1,data:"isFromStart",lazy:v&&s(y),immediateRender:v,stagger:0,parent:S}))),v){if(!e)return}else _initTween(t._startAt,B);for(r=la(_,st),p=(l=A[t._pt=0]?Z(A[0]).harness:0)&&_[l.prop],y=C&&s(y)||y&&!C,i=0;i<A.length;i++){if(h=(o=A[i])._gsap||Y(A)[i]._gsap,t._ptLookup[i]=d={},ut[h.id]&&da(),c=z===A?i:z.indexOf(o),l&&!1!==(f=new l).init(o,p||r,t,c,z)&&(t._pt=a=new ee(t._pt,o,f.name,0,1,f.render,f,0,f.priority),f._props.forEach(function(t){d[t]=a}),f.priority&&(u=1)),!l||p)for(n in r)ht[n]&&(f=Jb(n,r,t,c,o,z))?f.priority&&(u=1):d[n]=a=It.call(t,o,n,"get",r[n],c,z,0,_.stringFilter);t._op&&t._op[i]&&t.kill(o,t._op[i]),D&&t._pt&&(Lt=t,F.killTweensOf(o,d,"started"),Lt=0),t._pt&&y&&(ut[h.id]=1)}u&&te(t),t._onInit&&t._onInit(t)}t._from=!R&&!!_.runBackwards,t._onUpdate=T,t._initted=1},Yt=function _parseFuncOrString(t,e,r,i,a){return o(t)?t.call(e,r,i,a):n(t)&&~t.indexOf("random(")?$a(t):t},Nt=ct+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",Gt=(Nt+",id,stagger,delay,duration,paused").split(","),Ut=function(A){function Tween(t,e,i,n){var a;"number"==typeof e&&(i.duration=e,e=i,i=null);var o,h,l,f,d,c,_,m,g=(a=A.call(this,n?e:ma(e),i)||this).vars,v=g.duration,y=g.delay,T=g.immediateRender,b=g.stagger,w=g.overwrite,x=g.keyframes,k=g.defaults,C=a.parent,P=(H(t)?p(t[0]):"length"in e)?[t]:yt(t);if(a._targets=P.length?Y(P):M("GSAP target "+t+" not found. https://greensock.com",!G.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=w,x||b||u(v)||u(y)){if(e=a.vars,(o=a.timeline=new Bt({data:"nested",defaults:k||{}})).kill(),o.parent=_assertThisInitialized(a),x)ha(o.vars.defaults,{ease:"none"}),x.forEach(function(t){return o.to(P,t,">")});else{if(f=P.length,_=b?Qa(b):O,r(b))for(d in b)~Nt.indexOf(d)&&((m=m||{})[d]=b[d]);for(h=0;h<f;h++){for(d in l={},e)Gt.indexOf(d)<0&&(l[d]=e[d]);l.stagger=0,m&&pt(l,m),e.yoyoEase&&!e.repeat&&(l.yoyoEase=e.yoyoEase),c=P[h],l.duration=+Yt(v,_assertThisInitialized(a),h,c,P),l.delay=(+Yt(y,_assertThisInitialized(a),h,c,P)||0)-a._delay,!b&&1===f&&l.delay&&(a._delay=y=l.delay,a._start+=y,l.delay=0),o.to(c,l,_(h,c,P))}v=y=0}v||a.duration(v=o.duration())}else a.timeline=0;return!0===w&&(Lt=_assertThisInitialized(a),F.killTweensOf(P),Lt=0),C&&ya(C,_assertThisInitialized(a)),(T||!v&&!x&&a._start===C._time&&s(T)&&function _hasNoPausedAncestors(t){return!t||t._ts&&_hasNoPausedAncestors(t.parent)}(_assertThisInitialized(a))&&"nested"!==C.data)&&(a._tTime=-B,a.render(Math.max(0,-y))),a}_inheritsLoose(Tween,A);var t=Tween.prototype;return t.render=function render(t,e,r){var i,n,a,s,o,u,h,l,f,d=this._time,c=this._tDur,p=this._dur,_=c-B<t&&0<=t?c:t<B?0:t;if(p){if(_!==this._tTime||!t||r||this._startAt&&this._zTime<0!=t<0){if(i=_,l=this.timeline,this._repeat){if(s=p+this._rDelay,(p<(i=aa(_%s))||c===_)&&(i=p),(a=~~(_/s))&&a===_/s&&(i=p,a--),(u=this._yoyo&&1&a)&&(f=this._yEase,i=p-i),o=_t(this._tTime,s),i===d&&!r&&this._initted)return this;a!==o&&(!this.vars.repeatRefresh||u||this._lock||(this._lock=r=1,this.render(s*a,!0).invalidate()._lock=0))}if(!this._initted){if(Aa(this,i,r,e))return this._tTime=0,this;if(p!==this._dur)return this.render(t,e,r)}for(this._tTime=_,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=h=(f||this._ease)(i/p),this._from&&(this.ratio=h=1-h),d||!i||e||bt(this,"onStart"),n=this._pt;n;)n.r(h,n.d),n=n._next;l&&l.render(t<0?t:!i&&u?-B:l._dur*h,e,r)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(t<0&&this._startAt&&this._startAt.render(t,!0,r),bt(this,"onUpdate")),this._repeat&&a!==o&&this.vars.onRepeat&&!e&&this.parent&&bt(this,"onRepeat"),_!==this._tDur&&_||this._tTime!==_||(t<0&&this._startAt&&!this._onUpdate&&this._startAt.render(t,!0,r),!t&&p||!(t&&0<this._ts||!_&&this._ts<0)||qa(this,1),e||t<0&&!d||_<c&&0<this.timeScale()||(bt(this,_===c?"onComplete":"onReverseComplete",!0),this._prom&&this._prom()))}}else!function _renderZeroDurationTween(t,e,r,i){var n,a=t._zTime<0?0:1,s=e<0?0:1,o=t._rDelay,u=0;if(o&&t._repeat&&(u=gt(0,t._tDur,e),_t(u,o)!==_t(t._tTime,o)&&(a=1-s,t.vars.repeatRefresh&&t._initted&&t.invalidate())),(t._initted||!Aa(t,e,i,r))&&(s!==a||i||t._zTime===B||!e&&t._zTime)){for(t._zTime=e||(r?B:0),t.ratio=s,t._from&&(s=1-s),t._time=0,t._tTime=u,r||bt(t,"onStart"),n=t._pt;n;)n.r(s,n.d),n=n._next;!s&&t._startAt&&!t._onUpdate&&t._start&&t._startAt.render(e,!0,i),t._onUpdate&&(r||bt(t,"onUpdate")),u&&t._repeat&&!r&&t.parent&&bt(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===s&&(t.ratio&&qa(t,1),r||(bt(t,t.ratio?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}}(this,t,e,r);return this},t.targets=function targets(){return this._targets},t.invalidate=function invalidate(){return this._pt=this._op=this._startAt=this._onUpdate=this._act=this._lazy=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),A.prototype.invalidate.call(this)},t.kill=function kill(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e)&&(this._lazy=0,this.parent))return db(this);if(this.timeline)return this.timeline.killTweensOf(t,e,Lt&&!0!==Lt.vars.overwrite),this;var r,i,a,s,o,u,h,l=this._targets,f=t?yt(t):l,d=this._ptLookup,c=this._pt;if((!e||"all"===e)&&function _arraysMatch(t,e){for(var r=t.length,i=r===e.length;i&&r--&&t[r]===e[r];);return r<0}(l,f))return db(this);for(r=this._op=this._op||[],"all"!==e&&(n(e)&&(o={},_(e,function(t){return o[t]=1}),e=o),e=function _addAliasesToVars(t,e){var r,i,n,a,s=t[0]?Z(t[0]).harness:0,o=s&&s.aliases;if(!o)return e;for(i in r=pt({},e),o)if(i in r)for(n=(a=o[i].split(",")).length;n--;)r[a[n]]=r[i];return r}(l,e)),h=l.length;h--;)if(~f.indexOf(l[h]))for(o in i=d[h],"all"===e?(r[h]=e,s=i,a={}):(a=r[h]=r[h]||{},s=e),s)(u=i&&i[o])&&("kill"in u.d&&!0!==u.d.kill(o)||pa(this,u,"_pt"),delete i[o]),"all"!==a&&(a[o]=1);return this._initted&&!this._pt&&c&&db(this),this},Tween.to=function to(t,e,r){return new Tween(t,e,r)},Tween.from=function from(t,e){return new Tween(t,ca(arguments,1))},Tween.delayedCall=function delayedCall(t,e,r,i){return new Tween(e,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:e,onReverseComplete:e,onCompleteParams:r,onReverseCompleteParams:r,callbackScope:i})},Tween.fromTo=function fromTo(t,e,r){return new Tween(t,ca(arguments,2))},Tween.set=function set(t,e){return e.duration=0,e.repeatDelay||(e.repeat=0),new Tween(t,e)},Tween.killTweensOf=function killTweensOf(t,e,r){return F.killTweensOf(t,e,r)},Tween}(Et);ha(Ut.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),_("staggerTo,staggerFrom,staggerFromTo",function(r){Ut[r]=function(){var t=new Bt,e=vt.call(arguments,0);return e.splice("staggerFromTo"===r?5:4,0,0),t[r].apply(t,e)}});function Ub(t,e,r){return t.setAttribute(e,r)}function ac(t,e,r,i){i.mSet(t,e,i.m.call(i.tween,r,i.mt),i)}var Xt=function _setterPlain(t,e,r){return t[e]=r},jt=function _setterFunc(t,e,r){return t[e](r)},Vt=function _setterFuncWithParam(t,e,r,i){return t[e](i.fp,r)},Zt=function _getSetter(t,e){return o(t[e])?jt:q(t[e])&&t.setAttribute?Ub:Xt},Jt=function _renderPlain(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4,e)},Ht=function _renderBoolean(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},Qt=function _renderComplexString(t,e){var r=e._pt,i="";if(!t&&e.b)i=e.b;else if(1===t&&e.e)i=e.e;else{for(;r;)i=r.p+(r.m?r.m(r.s+r.c*t):Math.round(1e4*(r.s+r.c*t))/1e4)+i,r=r._next;i+=e.c}e.set(e.t,e.p,i,e)},$t=function _renderPropTweens(t,e){for(var r=e._pt;r;)r.r(t,r.d),r=r._next},Wt=function _addPluginModifier(t,e,r,i){for(var n,a=this._pt;a;)n=a._next,a.p===i&&a.modifier(t,e,r),a=n},Kt=function _killPropTweensOf(t){for(var e,r,i=this._pt;i;)r=i._next,i.p===t&&!i.op||i.op===t?pa(this,i,"_pt"):i.dep||(e=1),i=r;return!e},te=function _sortPropTweensByPriority(t){for(var e,r,i,n,a=t._pt;a;){for(e=a._next,r=i;r&&r.pr>a.pr;)r=r._next;(a._prev=r?r._prev:n)?a._prev._next=a:i=a,(a._next=r)?r._prev=a:n=a,a=e}t._pt=i},ee=(PropTween.prototype.modifier=function modifier(t,e,r){this.mSet=this.mSet||this.set,this.set=ac,this.m=t,this.mt=r,this.tween=e},PropTween);function PropTween(t,e,r,i,n,a,s,o,u){this.t=e,this.s=i,this.c=n,this.p=r,this.r=a||Jt,this.d=s||this,this.set=o||Xt,this.pr=u||0,(this._next=t)&&(t._prev=this)}_(ct+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert",function(t){return st[t]=1}),at.TweenMax=at.TweenLite=Ut,at.TimelineLite=at.TimelineMax=Bt,F=new Bt({sortChildren:!1,defaults:E,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),G.stringFilter=ob;var re={registerPlugin:function registerPlugin(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e.forEach(function(t){return function _createPlugin(t){var e=(t=!t.name&&t.default||t).name,r=o(t),i=e&&!r&&t.init?function(){this._props=[]}:t,n={init:O,render:$t,add:It,kill:Kt,modifier:Wt,rawVars:0},a={targetTest:0,get:0,getSetter:Zt,aliases:{},register:0};if(Ct(),t!==i){if(ht[e])return;ha(i,ha(la(t,n),a)),pt(i.prototype,pt(n,la(t,a))),ht[i.prop=e]=i,t.targetTest&&(dt.push(i),st[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}N(e,i),t.register&&t.register(ie,i,ee)}(t)})},timeline:function timeline(t){return new Bt(t)},getTweensOf:function getTweensOf(t,e){return F.getTweensOf(t,e)},getProperty:function getProperty(i,t,e,r){n(i)&&(i=yt(i)[0]);var a=Z(i||{}).get,s=e?ga:fa;return"native"===e&&(e=""),i?t?s((ht[t]&&ht[t].get||a)(i,t,e,r)):function(t,e,r){return s((ht[t]&&ht[t].get||a)(i,t,e,r))}:i},quickSetter:function quickSetter(r,e,i){if(1<(r=yt(r)).length){var n=r.map(function(t){return ie.quickSetter(t,e,i)}),a=n.length;return function(t){for(var e=a;e--;)n[e](t)}}r=r[0]||{};var s=ht[e],o=Z(r),u=s?function(t){var e=new s;c._pt=0,e.init(r,i?t+i:t,c,0,[r]),e.render(1,e),c._pt&&$t(1,c)}:o.set(r,e);return s?u:function(t){return u(r,e,i?t+i:t,o,1)}},isTweening:function isTweening(t){return 0<F.getTweensOf(t,!0).length},defaults:function defaults(t){return t&&t.ease&&(t.ease=Dt(t.ease,E.ease)),ka(E,t||{})},config:function config(t){return ka(G,t||{})},registerEffect:function registerEffect(t){var n=t.name,i=t.effect,e=t.plugins,a=t.defaults,s=t.extendTimeline;(e||"").split(",").forEach(function(t){return t&&!ht[t]&&!at[t]&&M(n+" effect requires "+t+" plugin.")}),lt[n]=function(t,e,r){return i(yt(t),ha(e||{},a),r)},s&&(Bt.prototype[n]=function(t,e,i){return this.add(lt[n](t,r(e)?e:(i=e)&&{},this),i)})},registerEase:function registerEase(t,e){Pt[t]=Dt(e)},parseEase:function parseEase(t,e){return arguments.length?Dt(t,e):Pt},getById:function getById(t){return F.getById(t)},exportRoot:function exportRoot(t,e){void 0===t&&(t={});var r,i,n=new Bt(t);for(n.smoothChildTiming=s(t.smoothChildTiming),F.remove(n),n._dp=0,n._time=n._tTime=F._time,r=F._first;r;)i=r._next,!e&&!r._dur&&r instanceof Ut&&r.vars.onComplete===r._targets[0]||za(n,r,r._start-r._delay),r=i;return za(F,n,0),n},utils:{wrap:function wrap(e,t,r){var i=t-e;return H(e)?Xa(e,wrap(0,e.length),t):Ha(r,function(t){return(i+(t-e)%i)%i+e})},wrapYoyo:function wrapYoyo(e,t,r){var i=t-e,n=2*i;return H(e)?Xa(e,wrapYoyo(0,e.length-1),t):Ha(r,function(t){return e+(i<(t=(n+(t-e)%n)%n)?n-t:t)})},distribute:Qa,random:Ta,snap:Sa,normalize:function normalize(t,e,r){return Tt(t,e,0,1,r)},getUnit:Ja,clamp:function clamp(e,r,t){return Ha(t,function(t){return gt(e,r,t)})},splitColor:jb,toArray:yt,mapRange:Tt,pipe:function pipe(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){return e.reduce(function(t,e){return e(t)},t)}},unitize:function unitize(e,r){return function(t){return e(parseFloat(t))+(r||Ja(t))}},interpolate:function interpolate(e,r,t,i){var a=isNaN(e+r)?0:function(t){return(1-t)*e+t*r};if(!a){var s,o,u,h,l,f=n(e),d={};if(!0===t&&(i=1)&&(t=null),f)e={p:e},r={p:r};else if(H(e)&&!H(r)){for(u=[],h=e.length,l=h-2,o=1;o<h;o++)u.push(interpolate(e[o-1],e[o]));h--,a=function func(t){t*=h;var e=Math.min(l,~~t);return u[e](t-e)},t=r}else i||(e=pt(H(e)?[]:{},e));if(!u){for(s in r)It.call(d,e,s,"get",r[s]);a=function func(t){return $t(t,d)||(f?e.p:e)}}}return Ha(t,a)},shuffle:Pa},install:K,effects:lt,ticker:Ot,updateRoot:Bt.updateRoot,plugins:ht,globalTimeline:F,core:{PropTween:ee,globals:N,Tween:Ut,Timeline:Bt,Animation:Et,getCache:Z,_removeLinkedListItem:pa}};_("to,from,fromTo,delayedCall,set,killTweensOf",function(t){return re[t]=Ut[t]}),Ot.add(Bt.updateRoot),c=re.to({},{duration:0});function ec(t,e){for(var r=t._pt;r&&r.p!==e&&r.op!==e&&r.fp!==e;)r=r._next;return r}function gc(t,a){return{name:t,rawVars:1,init:function init(t,i,e){e._onInit=function(t){var e,r;if(n(i)&&(e={},_(i,function(t){return e[t]=1}),i=e),a){for(r in e={},i)e[r]=a(i[r]);i=e}!function _addModifiers(t,e){var r,i,n,a=t._targets;for(r in e)for(i=a.length;i--;)(n=(n=t._ptLookup[i][r])&&n.d)&&(n._pt&&(n=ec(n,r)),n&&n.modifier&&n.modifier(e[r],t,a[i],r))}(t,i)}}}}var ie=re.registerPlugin({name:"attr",init:function init(t,e,r,i,n){for(var a in e)this.add(t,"setAttribute",(t.getAttribute(a)||0)+"",e[a],i,n,0,0,a),this._props.push(a)}},{name:"endArray",init:function init(t,e){for(var r=e.length;r--;)this.add(t,r,t[r]||0,e[r])}},gc("roundProps",Ra),gc("modifiers"),gc("snap",Sa))||re;Ut.version=Bt.version=ie.version="3.2.6",f=1,t()&&Ct();function Rc(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)}function Sc(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)}function Tc(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)}function Uc(t,e){var r=e.s+e.c*t;e.set(e.t,e.p,~~(r+(r<0?-.5:.5))+e.u,e)}function Vc(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)}function Wc(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)}function Xc(t,e,r){return t.style[e]=r}function Yc(t,e,r){return t.style.setProperty(e,r)}function Zc(t,e,r){return t._gsap[e]=r}function $c(t,e,r){return t._gsap.scaleX=t._gsap.scaleY=r}function _c(t,e,r,i,n){var a=t._gsap;a.scaleX=a.scaleY=r,a.renderTransform(n,a)}function ad(t,e,r,i,n){var a=t._gsap;a[e]=r,a.renderTransform(n,a)}function ed(t,e){var r=ae.createElementNS?ae.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):ae.createElement(t);return r.style?r:ae.createElement(t)}function fd(t,e,r){var i=getComputedStyle(t);return i[e]||i.getPropertyValue(e.replace(Fe,"-$1").toLowerCase())||i.getPropertyValue(e)||!r&&fd(t,Ne(e)||e,1)||""}function id(){!function _windowExists(){return"undefined"!=typeof window}()||(ne=window,ae=ne.document,se=ae.documentElement,ue=ed("div")||{style:{}},he=ed("div"),Ie=Ne(Ie),qe=Ne(qe),ue.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",fe=!!Ne("perspective"),oe=1)}function jd(t){var e,r=ed("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,n=this.nextSibling,a=this.style.cssText;if(se.appendChild(r),r.appendChild(this),this.style.display="block",t)try{e=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=jd}catch(t){}else this._gsapBBox&&(e=this._gsapBBox());return i&&(n?i.insertBefore(this,n):i.appendChild(this)),se.removeChild(r),this.style.cssText=a,e}function kd(t,e){for(var r=e.length;r--;)if(t.hasAttribute(e[r]))return t.getAttribute(e[r])}function ld(e){var r;try{r=e.getBBox()}catch(t){r=jd.call(e,!0)}return r&&(r.width||r.height)||e.getBBox===jd||(r=jd.call(e,!0)),!r||r.width||r.x||r.y?r:{x:+kd(e,["x","cx","x1"])||0,y:+kd(e,["y","cy","y1"])||0,width:0,height:0}}function md(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!ld(t))}function nd(t,e){if(e){var r=t.style;e in Se&&(e=Ie),r.removeProperty?("ms"!==e.substr(0,2)&&"webkit"!==e.substr(0,6)||(e="-"+e),r.removeProperty(e.replace(Fe,"-$1").toLowerCase())):r.removeAttribute(e)}}function od(t,e,r,i,n,a){var s=new ee(t._pt,e,r,0,1,a?Wc:Vc);return(t._pt=s).b=i,s.e=n,t._props.push(r),s}function qd(t,e,r,i){var n,a,s,o,u=parseFloat(r)||0,h=(r+"").trim().substr((u+"").length)||"px",l=ue.style,f=Ee.test(e),d="svg"===t.tagName.toLowerCase(),c=(d?"client":"offset")+(f?"Width":"Height"),p="px"===i,_="%"===i;return i===h||!u||Ge[i]||Ge[h]?u:("px"===h||p||(u=qd(t,e,r,"px")),o=t.getCTM&&md(t),_&&(Se[e]||~e.indexOf("adius"))?aa(u/(o?t.getBBox()[f?"width":"height"]:t[c])*100):(l[f?"width":"height"]=100+(p?h:i),a=~e.indexOf("adius")||"em"===i&&t.appendChild&&!d?t:t.parentNode,o&&(a=(t.ownerSVGElement||{}).parentNode),a&&a!==ae&&a.appendChild||(a=ae.body),(s=a._gsap)&&_&&s.width&&f&&s.time===Ot.time?aa(u/s.width*100):(!_&&"%"!==h||(l.position=fd(t,"position")),a===t&&(l.position="static"),a.appendChild(ue),n=ue[c],a.removeChild(ue),l.position="absolute",f&&_&&((s=Z(a)).time=Ot.time,s.width=a[c]),aa(p?n*u/100:n&&u?100/n*u:0))))}function rd(t,e,r,i){var n;return oe||id(),e in Le&&"transform"!==e&&~(e=Le[e]).indexOf(",")&&(e=e.split(",")[0]),Se[e]&&"transform"!==e?(n=Ze(t,i),n="transformOrigin"!==e?n[e]:Je(fd(t,qe))+" "+n.zOrigin+"px"):(n=t.style[e])&&"auto"!==n&&!i&&!~(n+"").indexOf("calc(")||(n=Xe[e]&&Xe[e](t,e,r)||fd(t,e)||$(t,e)||("opacity"===e?1:0)),r&&!~(n+"").indexOf(" ")?qd(t,e,n,r)+r:n}function sd(t,e,r,i){if(!r||"none"===r){var n=Ne(e,t,1),a=n&&fd(t,n,1);a&&a!==r&&(e=n,r=a)}var s,o,u,h,l,f,d,c,p,_,m,g,v=new ee(this._pt,t.style,e,0,1,Qt),y=0,T=0;if(v.b=r,v.e=i,r+="","auto"===(i+="")&&(t.style[e]=i,i=fd(t,e)||i,t.style[e]=r),ob(s=[r,i]),i=s[1],u=(r=s[0]).match(tt)||[],(i.match(tt)||[]).length){for(;o=tt.exec(i);)d=o[0],p=i.substring(y,o.index),l?l=(l+1)%5:"rgba("!==p.substr(-5)&&"hsla("!==p.substr(-5)||(l=1),d!==(f=u[T++]||"")&&(h=parseFloat(f)||0,m=f.substr((h+"").length),(g="="===d.charAt(1)?+(d.charAt(0)+"1"):0)&&(d=d.substr(2)),c=parseFloat(d),_=d.substr((c+"").length),y=tt.lastIndex-_.length,_||(_=_||G.units[e]||m,y===i.length&&(i+=_,v.e+=_)),m!==_&&(h=qd(t,e,f,_)||0),v._pt={_next:v._pt,p:p||1===T?p:",",s:h,c:g?g*c:c-h,m:l&&l<4?Math.round:0});v.c=y<i.length?i.substring(y,i.length):""}else v.r="display"===e&&"none"===i?Wc:Vc;return it.test(i)&&(v.e=0),this._pt=v}function ud(t){var e=t.split(" "),r=e[0],i=e[1]||"50%";return"top"!==r&&"bottom"!==r&&"left"!==i&&"right"!==i||(t=r,r=i,i=t),e[0]=Ue[r]||r,e[1]=Ue[i]||i,e.join(" ")}function vd(t,e){if(e.tween&&e.tween._time===e.tween._dur){var r,i,n,a=e.t,s=a.style,o=e.u,u=a._gsap;if("all"===o||!0===o)s.cssText="",i=1;else for(n=(o=o.split(",")).length;-1<--n;)r=o[n],Se[r]&&(i=1,r="transformOrigin"===r?qe:Ie),nd(a,r);i&&(nd(a,Ie),u&&(u.svg&&a.removeAttribute("transform"),Ze(a,1),u.uncache=1))}}function zd(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t}function Ad(t){var e=fd(t,Ie);return zd(e)?je:e.substr(7).match(W).map(aa)}function Bd(t,e){var r,i,n,a,s=t._gsap||Z(t),o=t.style,u=Ad(t);return s.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(u=[(n=t.transform.baseVal.consolidate().matrix).a,n.b,n.c,n.d,n.e,n.f]).join(",")?je:u:(u!==je||t.offsetParent||t===se||s.svg||(n=o.display,o.display="block",(r=t.parentNode)&&t.offsetParent||(a=1,i=t.nextSibling,se.appendChild(t)),u=Ad(t),n?o.display=n:nd(t,"display"),a&&(i?r.insertBefore(t,i):r?r.appendChild(t):se.removeChild(t))),e&&6<u.length?[u[0],u[1],u[4],u[5],u[12],u[13]]:u)}function Cd(t,e,r,i,n,a){var s,o,u,h=t._gsap,l=n||Bd(t,!0),f=h.xOrigin||0,d=h.yOrigin||0,c=h.xOffset||0,p=h.yOffset||0,_=l[0],m=l[1],g=l[2],v=l[3],y=l[4],T=l[5],b=e.split(" "),w=parseFloat(b[0])||0,x=parseFloat(b[1])||0;r?l!==je&&(o=_*v-m*g)&&(u=w*(-m/o)+x*(_/o)-(_*T-m*y)/o,w=w*(v/o)+x*(-g/o)+(g*T-v*y)/o,x=u):(w=(s=ld(t)).x+(~b[0].indexOf("%")?w/100*s.width:w),x=s.y+(~(b[1]||b[0]).indexOf("%")?x/100*s.height:x)),i||!1!==i&&h.smooth?(y=w-f,T=x-d,h.xOffset=c+(y*_+T*g)-y,h.yOffset=p+(y*m+T*v)-T):h.xOffset=h.yOffset=0,h.xOrigin=w,h.yOrigin=x,h.smooth=!!i,h.origin=e,h.originIsAbsolute=!!r,t.style[qe]="0px 0px",a&&(od(a,h,"xOrigin",f,w),od(a,h,"yOrigin",d,x),od(a,h,"xOffset",c,h.xOffset),od(a,h,"yOffset",p,h.yOffset)),t.setAttribute("data-svg-origin",w+" "+x)}function Fd(t,e,r){var i=Ja(e);return aa(parseFloat(e)+parseFloat(qd(t,"x",r+"px",i)))+i}function Md(t,e,r,i,a,s){var o,u,h=360,l=n(a),f=parseFloat(a)*(l&&~a.indexOf("rad")?ze:1),d=s?f*s:f-i,c=i+d+"deg";return l&&("short"===(o=a.split("_")[1])&&(d%=h)!==d%180&&(d+=d<0?h:-h),"cw"===o&&d<0?d=(d+36e9)%h-~~(d/h)*h:"ccw"===o&&0<d&&(d=(d-36e9)%h-~~(d/h)*h)),t._pt=u=new ee(t._pt,e,r,i,d,Sc),u.e=c,u.u="deg",t._props.push(r),u}function Nd(t,e,r){var i,n,a,s,o,u,h,l=he.style,f=r._gsap;for(n in l.cssText=getComputedStyle(r).cssText+";position:absolute;display:block;",l[Ie]=e,ae.body.appendChild(he),i=Ze(he,1),Se)(a=f[n])!==(s=i[n])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(n)<0&&(o=Ja(a)!==(h=Ja(s))?qd(r,n,a,h):parseFloat(a),u=parseFloat(s),t._pt=new ee(t._pt,f,n,o,u-o,Rc),t._pt.u=h||0,t._props.push(n));ae.body.removeChild(he)}var ne,ae,se,oe,ue,he,le,fe,de=Pt.Power0,ce=Pt.Power1,pe=Pt.Power2,_e=Pt.Power3,me=Pt.Power4,ge=Pt.Linear,ve=Pt.Quad,ye=Pt.Cubic,Te=Pt.Quart,be=Pt.Quint,we=Pt.Strong,xe=Pt.Elastic,ke=Pt.Back,Me=Pt.SteppedEase,Oe=Pt.Bounce,Ce=Pt.Sine,Pe=Pt.Expo,Ae=Pt.Circ,Se={},ze=180/Math.PI,De=Math.PI/180,Re=Math.atan2,Fe=/([A-Z])/g,Ee=/(?:left|right|width|margin|padding|x)/i,Be=/[\s,\(]\S/,Le={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Ie="transform",qe=Ie+"Origin",Ye="O,Moz,ms,Ms,Webkit".split(","),Ne=function _checkPropPrefix(t,e,r){var i=(e||ue).style,n=5;if(t in i&&!r)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);n--&&!(Ye[n]+t in i););return n<0?null:(3===n?"ms":0<=n?Ye[n]:"")+t},Ge={deg:1,rad:1,turn:1},Ue={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Xe={clearProps:function clearProps(t,e,r,i,n){if("isFromStart"!==n.data){var a=t._pt=new ee(t._pt,e,r,0,0,vd);return a.u=i,a.pr=-10,a.tween=n,t._props.push(r),1}}},je=[1,0,0,1,0,0],Ve={},Ze=function _parseTransform(t,e){var r=t._gsap||new Ft(t);if("x"in r&&!e&&!r.uncache)return r;var i,n,a,s,o,u,h,l,f,d,c,p,_,m,g,v,y,T,b,w,x,k,M,O,C,P,A,S,z,D,R,F,E=t.style,B=r.scaleX<0,L="deg",I=fd(t,qe)||"0";return i=n=a=u=h=l=f=d=c=0,s=o=1,r.svg=!(!t.getCTM||!md(t)),m=Bd(t,r.svg),r.svg&&(O=!r.uncache&&t.getAttribute("data-svg-origin"),Cd(t,O||I,!!O||r.originIsAbsolute,!1!==r.smooth,m)),p=r.xOrigin||0,_=r.yOrigin||0,m!==je&&(T=m[0],b=m[1],w=m[2],x=m[3],i=k=m[4],n=M=m[5],6===m.length?(s=Math.sqrt(T*T+b*b),o=Math.sqrt(x*x+w*w),u=T||b?Re(b,T)*ze:0,(f=w||x?Re(w,x)*ze+u:0)&&(o*=Math.cos(f*De)),r.svg&&(i-=p-(p*T+_*w),n-=_-(p*b+_*x))):(F=m[6],D=m[7],A=m[8],S=m[9],z=m[10],R=m[11],i=m[12],n=m[13],a=m[14],h=(g=Re(F,z))*ze,g&&(O=k*(v=Math.cos(-g))+A*(y=Math.sin(-g)),C=M*v+S*y,P=F*v+z*y,A=k*-y+A*v,S=M*-y+S*v,z=F*-y+z*v,R=D*-y+R*v,k=O,M=C,F=P),l=(g=Re(-w,z))*ze,g&&(v=Math.cos(-g),R=x*(y=Math.sin(-g))+R*v,T=O=T*v-A*y,b=C=b*v-S*y,w=P=w*v-z*y),u=(g=Re(b,T))*ze,g&&(O=T*(v=Math.cos(g))+b*(y=Math.sin(g)),C=k*v+M*y,b=b*v-T*y,M=M*v-k*y,T=O,k=C),h&&359.9<Math.abs(h)+Math.abs(u)&&(h=u=0,l=180-l),s=aa(Math.sqrt(T*T+b*b+w*w)),o=aa(Math.sqrt(M*M+F*F)),g=Re(k,M),f=2e-4<Math.abs(g)?g*ze:0,c=R?1/(R<0?-R:R):0),r.svg&&(m=t.getAttribute("transform"),r.forceCSS=t.setAttribute("transform","")||!zd(fd(t,Ie)),m&&t.setAttribute("transform",m))),90<Math.abs(f)&&Math.abs(f)<270&&(B?(s*=-1,f+=u<=0?180:-180,u+=u<=0?180:-180):(o*=-1,f+=f<=0?180:-180)),r.x=((r.xPercent=i&&Math.round(t.offsetWidth/2)===Math.round(-i)?-50:0)?0:i)+"px",r.y=((r.yPercent=n&&Math.round(t.offsetHeight/2)===Math.round(-n)?-50:0)?0:n)+"px",r.z=a+"px",r.scaleX=aa(s),r.scaleY=aa(o),r.rotation=aa(u)+L,r.rotationX=aa(h)+L,r.rotationY=aa(l)+L,r.skewX=f+L,r.skewY=d+L,r.transformPerspective=c+"px",(r.zOrigin=parseFloat(I.split(" ")[2])||0)&&(E[qe]=Je(I)),r.xOffset=r.yOffset=0,r.force3D=G.force3D,r.renderTransform=r.svg?tr:fe?Ke:He,r.uncache=0,r},Je=function _firstTwoOnly(t){return(t=t.split(" "))[0]+" "+t[1]},He=function _renderNon3DTransforms(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,Ke(t,e)},Qe="0deg",$e="0px",We=") ",Ke=function _renderCSSTransforms(t,e){var r=e||this,i=r.xPercent,n=r.yPercent,a=r.x,s=r.y,o=r.z,u=r.rotation,h=r.rotationY,l=r.rotationX,f=r.skewX,d=r.skewY,c=r.scaleX,p=r.scaleY,_=r.transformPerspective,m=r.force3D,g=r.target,v=r.zOrigin,y="",T="auto"===m&&t&&1!==t||!0===m;if(v&&(l!==Qe||h!==Qe)){var b,w=parseFloat(h)*De,x=Math.sin(w),k=Math.cos(w);w=parseFloat(l)*De,b=Math.cos(w),a=Fd(g,a,x*b*-v),s=Fd(g,s,-Math.sin(w)*-v),o=Fd(g,o,k*b*-v+v)}_!==$e&&(y+="perspective("+_+We),(i||n)&&(y+="translate("+i+"%, "+n+"%) "),!T&&a===$e&&s===$e&&o===$e||(y+=o!==$e||T?"translate3d("+a+", "+s+", "+o+") ":"translate("+a+", "+s+We),u!==Qe&&(y+="rotate("+u+We),h!==Qe&&(y+="rotateY("+h+We),l!==Qe&&(y+="rotateX("+l+We),f===Qe&&d===Qe||(y+="skew("+f+", "+d+We),1===c&&1===p||(y+="scale("+c+", "+p+We),g.style[Ie]=y||"translate(0, 0)"},tr=function _renderSVGTransforms(t,e){var r,i,n,a,s,o=e||this,u=o.xPercent,h=o.yPercent,l=o.x,f=o.y,d=o.rotation,c=o.skewX,p=o.skewY,_=o.scaleX,m=o.scaleY,g=o.target,v=o.xOrigin,y=o.yOrigin,T=o.xOffset,b=o.yOffset,w=o.forceCSS,x=parseFloat(l),k=parseFloat(f);d=parseFloat(d),c=parseFloat(c),(p=parseFloat(p))&&(c+=p=parseFloat(p),d+=p),d||c?(d*=De,c*=De,r=Math.cos(d)*_,i=Math.sin(d)*_,n=Math.sin(d-c)*-m,a=Math.cos(d-c)*m,c&&(p*=De,s=Math.tan(c-p),n*=s=Math.sqrt(1+s*s),a*=s,p&&(s=Math.tan(p),r*=s=Math.sqrt(1+s*s),i*=s)),r=aa(r),i=aa(i),n=aa(n),a=aa(a)):(r=_,a=m,i=n=0),(x&&!~(l+"").indexOf("px")||k&&!~(f+"").indexOf("px"))&&(x=qd(g,"x",l,"px"),k=qd(g,"y",f,"px")),(v||y||T||b)&&(x=aa(x+v-(v*r+y*n)+T),k=aa(k+y-(v*i+y*a)+b)),(u||h)&&(s=g.getBBox(),x=aa(x+u/100*s.width),k=aa(k+h/100*s.height)),s="matrix("+r+","+i+","+n+","+a+","+x+","+k+")",g.setAttribute("transform",s),w&&(g.style[Ie]=s)};_("padding,margin,Width,Radius",function(e,r){var t="Right",i="Bottom",n="Left",o=(r<3?["Top",t,i,n]:["Top"+n,"Top"+t,i+t,i+n]).map(function(t){return r<2?e+t:"border"+t+e});Xe[1<r?"border"+e:e]=function(e,t,r,i,n){var a,s;if(arguments.length<4)return a=o.map(function(t){return rd(e,t,r)}),5===(s=a.join(" ")).split(a[0]).length?a[0]:s;a=(i+"").split(" "),s={},o.forEach(function(t,e){return s[t]=a[e]=a[e]||a[(e-1)/2|0]}),e.init(t,s,n)}});var er,rr,ir,nr={name:"css",register:id,targetTest:function targetTest(t){return t.style&&t.nodeType},init:function init(t,e,r,i,n){var a,s,o,u,h,l,f,d,c,p,_,m,g,v,y,T=this._props,b=t.style;for(f in oe||id(),e)if("autoRound"!==f&&(s=e[f],!ht[f]||!Jb(f,e,r,i,t,n)))if(h=typeof s,l=Xe[f],"function"===h&&(h=typeof(s=s.call(r,i,t,n))),"string"===h&&~s.indexOf("random(")&&(s=$a(s)),l)l(this,t,f,s,r)&&(y=1);else if("--"===f.substr(0,2))this.add(b,"setProperty",getComputedStyle(t).getPropertyValue(f)+"",s+"",i,n,0,0,f);else{if(a=rd(t,f),u=parseFloat(a),(p="string"===h&&"="===s.charAt(1)?+(s.charAt(0)+"1"):0)&&(s=s.substr(2)),o=parseFloat(s),f in Le&&("autoAlpha"===f&&(1===u&&"hidden"===rd(t,"visibility")&&o&&(u=0),od(this,b,"visibility",u?"inherit":"hidden",o?"inherit":"hidden",!o)),"scale"!==f&&"transform"!==f&&~(f=Le[f]).indexOf(",")&&(f=f.split(",")[0])),_=f in Se)if(m||((g=t._gsap).renderTransform||Ze(t),v=!1!==e.smoothOrigin&&g.smooth,(m=this._pt=new ee(this._pt,b,Ie,0,1,g.renderTransform,g,0,-1)).dep=1),"scale"===f)this._pt=new ee(this._pt,g,"scaleY",g.scaleY,p?p*o:o-g.scaleY),T.push("scaleY",f),f+="X";else{if("transformOrigin"===f){s=ud(s),g.svg?Cd(t,s,0,v,0,this):((c=parseFloat(s.split(" ")[2])||0)!==g.zOrigin&&od(this,g,"zOrigin",g.zOrigin,c),od(this,b,f,Je(a),Je(s)));continue}if("svgOrigin"===f){Cd(t,s,1,v,0,this);continue}if(f in Ve){Md(this,g,f,u,s,p);continue}if("smoothOrigin"===f){od(this,g,"smooth",g.smooth,s);continue}if("force3D"===f){g[f]=s;continue}if("transform"===f){Nd(this,s,t);continue}}else f in b||(f=Ne(f)||f);if(_||(o||0===o)&&(u||0===u)&&!Be.test(s)&&f in b)(d=(a+"").substr((u+"").length))!==(c=(s+"").substr(((o=o||0)+"").length)||(f in G.units?G.units[f]:d))&&(u=qd(t,f,a,c)),this._pt=new ee(this._pt,_?g:b,f,u,p?p*o:o-u,"px"!==c||!1===e.autoRound||_?Rc:Uc),this._pt.u=c||0,d!==c&&(this._pt.b=a,this._pt.r=Tc);else if(f in b)sd.call(this,t,f,a,s);else{if(!(f in t)){L(f,s);continue}this.add(t,f,t[f],s,i,n)}T.push(f)}y&&te(this)},get:rd,aliases:Le,getSetter:function getSetter(t,e,r){var i=Le[e];return i&&i.indexOf(",")<0&&(e=i),e in Se&&e!==qe&&(t._gsap.x||rd(t,"x"))?r&&le===r?"scale"===e?$c:Zc:(le=r||{})&&("scale"===e?_c:ad):t.style&&!q(t.style[e])?Xc:~e.indexOf("-")?Yc:Zt(t,e)},core:{_removeProperty:nd,_getMatrix:Bd}};ie.utils.checkPrefix=Ne,ir=_((er="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(rr="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(t){Se[t]=1}),_(rr,function(t){G.units[t]="deg",Ve[t]=1}),Le[ir[13]]=er+","+rr,_("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(t){var e=t.split(":");Le[e[1]]=ir[e[0]]}),_("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(t){G.units[t]="px"}),ie.registerPlugin(nr);var ar=ie.registerPlugin(nr)||ie,sr=ar.core.Tween;e.Back=ke,e.Bounce=Oe,e.CSSPlugin=nr,e.Circ=Ae,e.Cubic=ye,e.Elastic=xe,e.Expo=Pe,e.Linear=ge,e.Power0=de,e.Power1=ce,e.Power2=pe,e.Power3=_e,e.Power4=me,e.Quad=ve,e.Quart=Te,e.Quint=be,e.Sine=Ce,e.SteppedEase=Me,e.Strong=we,e.TimelineLite=Bt,e.TimelineMax=Bt,e.TweenLite=Ut,e.TweenMax=sr,e.default=ar,e.gsap=ar;if (typeof(window)==="undefined"||window!==e){Object.defineProperty(e,"__esModule",{value:!0})} else {delete e.default}});

</script>
<div style="display: none;" class="containerTop to-top" >
  <div class="heart-wrap">
    <div class="heart">
      <div class="tank"></div>
      <svg class="curve" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g>
          <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(103, 130, 191, 0.5)" />
          <use xlink:href="#gentle-wave" x="48" y="1" fill="rgba(103, 130, 191, 0.3)" />
          <use xlink:href="#gentle-wave" x="48" y="2" fill="rgba(103, 130, 191, 1)" />
        </g>
      </svg>
    </div>
  </div>
	
<svg>
  <clipPath id="myPath" clipPathUnits="objectBoundingBox">
     
     <path d="M0.373,0.967 S0.616,0.866,0.768,0.644 S0.912,0.107,0.739,0 S0.373,0.108,0.373,0.108 S0.166,-0.113,0,-0.002 S-0.159,0.432,-0.021,0.644 S0.373,0.967,0.373,0.967"></path>
	 
	  
  </clipPath>
</svg>
</div>

<script>
	$('.to-top').toTop();
</script>

<script>
$(document).ready(function () {
  let pumpLevels = [25, 30, 45, 0];
  let tankLevels = [25, 45, 70, -20];
  let counter = 0;
  let isAnimating = false;
  
  function pumpHeart() {
    if(isAnimating) {
		alert('点这么快，是心动吗？');
      return;
    }
    
    isAnimating = true;
    //forward
    gsap.to('.heart', {
      translateZ: pumpLevels[counter], 
      duration: 0.5
    });
    
    gsap.to(".curve", {
      bottom: tankLevels[counter],
      transformOrigin: "bottom",
      scaleY: 1,
      duration: 0.5
    })
      gsap.to(".tank", {
      height: counter === 3 ? 0 : tankLevels[counter],
      duration: 0.5
    })
    
    //reverse
    gsap.to(".curve", {
      delay: 0.6,
      bottom: tankLevels[counter],
      transformOrigin: "bottom",
      scaleY: 0.5,
      duration: 0.5
    });
    
    gsap.to('.heart', {

      delay: 0.6,
      translateZ: 0,
      duration: 0.25,
      onComplete: function() {
        isAnimating = false;
      }
    })
    
    if(++counter > 3){
		counter = 0;
		$('.to-top').toTop();
		
	} 
  }
  
  let heart = document.getElementsByClassName('heart')[0];
  heart.addEventListener("click", pumpHeart);
});
</script>






<style>
.vditor-speech {    
	position: absolute;
    display: none;
    background-color: #1d2125;
    border: 1px solid #2ca9e6;
    box-shadow: 0 0.3rem 2rem rgba(0, 255, 149, 0.6);
    border-radius: 3px;
    padding: 6px;
    cursor: pointer;
    color: #b9b9b9;
	margin-top: 20px;
	z-index: 9999;
        }
.vditor-speech--current, .vditor-speech:hover {
            color: #fff
        }
.vditor-speech svg {
            height: 14px;
            width: 14px;
            fill: currentColor;
            display: block;
            stroke-width: 0;
            stroke: currentColor;
        }
</style>
<script>
   if (window.addEventListener) { window.addEventListener("load",dearmsdanread, false);} 
   else if (window.attachEvent) {window.attachEvent("onload",dearmsdanread); }
    else{ window.onload =dearmsdanread; }
	
  function dearmsdanread(){

function speak(text){if(!isBlank(text)){var src="https://api.heycmm.cn/speak/"+text;if(src.length<=2083){var n=document.querySelector(".Audio-speech");if(!n){(n=document.createElement("AUDIO")).className="Audio-speech";}else{document.getElementById("audios").style.display="block";}
n.setAttribute("id","audios");n.setAttribute("src",src);n.setAttribute("controls","controls");n.play()}}else{document.getElementById("audios").pause();document.getElementById("audios").style.display="none"}}
function trim(str){if(str==null){return""}
return str.toString().replace(/(^\s*)|(\s*$)|\r|\n/g,"")}
function isBlank(str){if(str==null||trim(str)==""){return true}
return false}
var play_svg_1='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">\n'+'<path d="M6 0v32l20-15.977-20-16.023z"></path>\n'+'</svg>\n';var pause_svg_1='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">\n'+'<path d="M11 0h-6c-0.553 0-1 0.448-1 1v30c0 0.553 0.447 1 1 1h6c0.553 0 1-0.447 1-1v-30c0-0.552-0.447-1-1-1zM27 0h-6c-0.553 0-1 0.448-1 1v30c0 0.553 0.447 1 1 1h6c0.553 0 1-0.447 1-1v-30c0-0.552-0.447-1-1-1z"></path>\n'+'</svg>\n';var speechDom=document.querySelector(".vditor-speech");if(!speechDom){speechDom=document.createElement("div");speechDom.className="vditor-speech";document.body.insertAdjacentElement("beforeend",speechDom);speechDom.onclick=function(){if(speechDom.className==="vditor-speech"){var utterThis=speechDom.getAttribute("data-text");
speak(utterThis);speechDom.className="vditor-speech vditor-speech--current";speechDom.innerHTML=pause_svg_1;}
var selection=window.getSelection();selection.removeAllRanges();selection.addRange(window.vditorSpeechRange);};document.body.addEventListener("click",function(){if(getSelection().toString().trim()===""&&speechDom.style.display==="block"){speechDom.className="vditor-speech";speechSynthesis.cancel();speechDom.style.display="none";}});}
document.addEventListener("mouseup",function(event){var text=getSelection().toString().trim();speechSynthesis.cancel();if(getSelection().toString().trim()===""){if(speechDom.style.display==="block"){speechDom.className="vditor-speech";speechDom.style.display="none";}
return;}
window.vditorSpeechRange=getSelection().getRangeAt(0).cloneRange();var rect=getSelection().getRangeAt(0).getBoundingClientRect();speechDom.innerHTML=play_svg_1;speechDom.style.display="block";speechDom.style.top=(rect.top+rect.height+document.querySelector("html").scrollTop-20)+"px";speechDom.style.left=(event.screenX+2)+"px";speechDom.setAttribute("data-text",text);});
	
  }
	
	// 。。。
	
/*	
	   var play_svg_1 = '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">\n' +
       '<path d="M6 0v32l20-15.977-20-16.023z"></path>\n' +
       '</svg>\n';
   var pause_svg_1 = '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">\n' +
       '<path d="M11 0h-6c-0.553 0-1 0.448-1 1v30c0 0.553 0.447 1 1 1h6c0.553 0 1-0.447 1-1v-30c0-0.552-0.447-1-1-1zM27 0h-6c-0.553 0-1 0.448-1 1v30c0 0.553 0.447 1 1 1h6c0.553 0 1-0.447 1-1v-30c0-0.552-0.447-1-1-1z"></path>\n' +
       '</svg>\n';
    var speechDom = document.querySelector(".vditor-speech");
    var lang = "zh_CN";
    if (!speechDom) {
        speechDom = document.createElement("div");
        speechDom.className = "vditor-speech";
        document.body.insertAdjacentElement("beforeend", speechDom);
        var getVoice = function () {
            var voices = speechSynthesis.getVoices();
            var currentVoice;
            var defaultVoice;
            voices.forEach(function (item) {
              if (item.lang === lang.replace("_", "-")) {
                    currentVoice = item;
                }
                if (item["default"]) {
                    defaultVoice = item;
                }
            });
            if (!currentVoice) {
                currentVoice = defaultVoice;
            }
            return currentVoice;
        };
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = getVoice;
        }
        var voice_1 = getVoice();
        speechDom.onclick = function () {
            if (speechDom.className === "vditor-speech") {
                var utterThis = new SpeechSynthesisUtterance(speechDom.getAttribute("data-text"));
                utterThis.voice = voice_1;
                utterThis.onend = function () {
                    speechDom.className = "vditor-speech";
                    speechSynthesis.cancel();
                    speechDom.innerHTML = play_svg_1;
                };
                speechSynthesis.speak(utterThis);
                speechDom.className = "vditor-speech vditor-speech--current";
                speechDom.innerHTML = pause_svg_1;
            }
            else {
                if (speechSynthesis.speaking) {
                    if (speechSynthesis.paused) {
                        speechSynthesis.resume();
                        speechDom.innerHTML = pause_svg_1;
                    }
                    else {
                        speechSynthesis.pause();
                        speechDom.innerHTML = play_svg_1;
                    }
                }
            }
            var selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(window.vditorSpeechRange);
        };
        document.body.addEventListener("click", function () {
            if (getSelection().toString().trim() === "" && speechDom.style.display === "block") {
                speechDom.className = "vditor-speech";
                speechSynthesis.cancel();
                speechDom.style.display = "none";
            }
        });
    }
   document.addEventListener("mouseup", function (event) {
        var text = getSelection().toString().trim();
        speechSynthesis.cancel();
        if (getSelection().toString().trim() === "") {
            if (speechDom.style.display === "block") {
                speechDom.className = "vditor-speech";
                speechDom.style.display = "none";
            }
            return;
        }
        window.vditorSpeechRange = getSelection().getRangeAt(0).cloneRange();
        var rect = getSelection().getRangeAt(0).getBoundingClientRect();
        speechDom.innerHTML = play_svg_1;
        speechDom.style.display = "block";
        speechDom.style.top = (rect.top + rect.height + document.querySelector("html").scrollTop - 20) + "px";
        speechDom.style.left = (event.screenX + 2) + "px";
        speechDom.setAttribute("data-text", text);
    });*/
</script>








<style>
	.navme>li>a:hover, .navme>li>a:focus, .navme>li>a.active{
    background-color: ;
    border-left: 5px solid ;
	}
	.navme > li > div{
    background-color: ;
	}
	.navme >li > div> ul> li:hover{
    background-color: !important
	}
</style>

<script type="text/javascript"> 
	
	
	
	
	function dearmsdanfooter() {
	//https://img.xjh.me/random_img.php?type=bg&ctype=nature&return=302
	/* 设置 背景 */
	
		$(".dearmsdan-bg").css("background-image","url('')");
		$(".dearmsdan-bg").css("opacity","0.3");
	
   }


   if (window.addEventListener) { window.addEventListener("load",dearmsdanfooter, false);} 
   else if (window.attachEvent) {window.attachEvent("onload",dearmsdanfooter); }
    else{ window.onload =dearmsdanfooter; }
     
</script>



<script src="/js/diy/date.js"></script>
<script src="/js/diy/particleCanvas.js"></script>
	

<script>
dearmsdanDate();
function dearmsdanDate() {
  document.write('<a href="#" style="display:none" target="_blank"><div id="date"></div><font color="#DF0A10">星期<span id="wk"></span></font>&nbsp;<span id="clk"></span><br />农历<span id="nongli"></span></a>')
  cal_u()
  cal_s()
  setInterval("cal_s()", 999)
}


var season = 0;  // 四季判断标识
var festival = [];  // 节日标识
var dearmsdanCanvas = null;  // 自定义画布标识
(function(d){
var traditional,month,date;
traditional = d[0];
month = d[1];
date = d[2];
	/* console.log("元旦快乐"+month+ '===='+date); */
	if(month == 1 && date == 1){
	   var fv = ['元旦快乐',1.1];
	   var festival = function(){
		   return fv;
	   }
	   this.festival = festival();
	  };
	
	/* t春节 */
var arr = ['正月初一','正月初二','正月初三','正月初四','正月初五','正月初六','正月初七','正月初八','正月初九','正月初十']; 
	for(var i=0; i <= arr.length; i++){
		if(traditional == arr[i]){
			var fv = ['新年快乐',2.1];
			var festival = function(){
				return fv;
			}
			this.festival = festival();
	   }
	}
	/* t情人节 */
	if(month == 2 && date == 14){
	   var fv = ['情人节快乐',2.14];
	   var festival = function(){
		   return fv;
	   }
	   this.festival = festival();
	   }
	/* f植树节 */
	if(month == 3 && date == 12){
	   		console.log("植树节"+month+ '====' +date);
	   }
	/* f愚人节 */
	if(month == 4 && date == 1){
	   		console.log("愚人节"+month+ '====' +date);
	   }
	/* t清明节 */
	if ((month == 4) && ((date == 4) || (date == 5) || (date == 6))){
	   var fv = ['清明节安康',4.4];
	   var festival = function(){
		   return fv;
	   }
	   this.festival = festival();
	}
	/* f劳动节 */
	if(month == 5 && date == 1){
	   		console.log("劳动节"+month+ '====' +date);
	   }
	/* t儿童节 */
	if(month == 6 && date == 1){
	   var fv = ['儿童快乐',6.1];
	   var festival = function(){
		   return fv;
	   }
	   this.festival = festival();
	   }
	/* f端午节 */
	if(traditional == '五月初五'){
	   		console.log("端午节"+month+ '====' +date);
	   }
	/* t七夕 */
	if(traditional == '七月初七'){
		   var fv = ['七夕快乐',7.7];
		   var festival = function(){
			   return fv;
		   }
		   this.festival = festival();
	   }
	/* f教师节 */
	if(month == 9 && date == 10){
	   		console.log("教师节"+month+ '====' +date);
	   }
	/* f国庆节、国庆、中秋双庆 */
	if(month == 10 && date == 1){
		if(traditional == '八月十五'){
	   		console.log("国庆节、中秋节双庆"+month+ '====' +date);
		   }else{
			   console.log("国庆节"+month+ '====' +date);
		   }
	   }
	/* f中秋 */
	if(traditional == '八月十五'){
		if(month == 10 && date == 1){
			
		}else{
			console.log("中秋节"+month+ '====' +date);
		}
	   }
	/* f重阳节 */
	if(traditional == '九月初九'){
	   		console.log("重阳节"+month+ '====' +date);
	   }
	/* f万圣节 */
	if(month == 11 && date == 1){
	   		console.log("万圣节"+month+ '====' +date);
	   }
	/* f感恩节 */
	if(month == 11 && date == 26){
	   		console.log("感恩节"+month+ '====' +date);
	   }
	/* f平安节 */
	if(month == 12 && date == 24){
	   		console.log("平安夜"+month+ '====' +date);
	   }
	/* f圣诞节 */
	if(month == 12 && date == 25){
	   		console.log("圣诞节"+month+ '====' +date);
	   }
	
	
	
	/*console.log("春季"+month+ '====' +date);*/
	if(month >= 1 && month <= 3){
		var cun = 1;
		var season1 = function(){
        return cun;
    	}
		season = season1();
		
	   }
	/*console.log("夏季"+month+ '====' +date);*/
	if(month >= 4 && month <= 6){
		var cun = 2;
		var season1 = function(){
        return cun;
    	}
		season = season1();
	   }
	/*console.log("秋季"+month+ '====' +date);*/
	if(month >= 7 && month <= 9){
		var cun = 3;
		var season1 = function(){
        return cun;
    	}
		season = season1();
		
	   }
	/*console.log("冬季"+month+ '====' +date);*/
	if(month >= 10 && month <= 12){
		var cun = 4;
		var season1 = function(){
        return cun;
    	}
		season = season1();
	   }
	
})(arrdate);


	//console.log(season);
$(".dearmsdan-festival").attr("id","dearmsdanSeason");
if(season == 1){
var particleCanvas = new particleCanvas("dearmsdanSeason", [{
	"type": {
		"typeName": "image",
		"url": "/resources/season/flake.png"
	},
	"number": 5,
	"op": {
		"min": 1,
		"max": 1
	},
	"size": {
		"min": 40,
		"max": 60
	},
	"zoom": {
		"min": 1,
		"max": 1
	},
	"speed": {
		"min": 1,
		"max": 1
	},
	"angle": {
		"value": 150,
		"float": 50
	},
	"rota": {
		"value": 30,
		"speed": 1.6,
		"floatValue": 120,
		"floatSpeed": 2
	},
	"reIn": "reverseDirection"
}]);
}
if(season == 2){
var particleCanvas = new particleCanvas("dearmsdanSeason", [{
	"type": {
		"typeName": "image",
		"url": "/resources/season/watermelon.png"
	},
	"number": 8,
	"op": {
		"min": 0.4,
		"max": 1
	},
	"size": {
		"min": 30,
		"max": 60
	},
	"zoom": {
		"min": 1,
		"max": 1
	},
	"speed": {
		"min": 2,
		"max": 2
	},
	"angle": {
		"value": 150,
		"float": 50
	},
	"rota": {
		"value": 30,
		"speed": 0.8,
		"floatValue": 120,
		"floatSpeed": 2
	},
	"reIn": "reverseDirection"
}]);
}
if(season == 3){
var particleCanvas = new particleCanvas("dearmsdanSeason", [{
	"type": {
		"typeName": "image",
		"url": "/resources/season/butterfly.png"
	},
	"number": 30,
	"op": {
		"min": 0.5,
		"max": 1
	},
	"size": {
		"min": 8,
		"max": 22
	},
	"zoom": {
		"min": 1,
		"max": 1
	},
	"speed": {
		"min": 1,
		"max": 1
	},
	"angle": {
		"value": 150,
		"float": 50
	},
	"rota": {
		"value": 30,
		"speed": 1.6,
		"floatValue": 120,
		"floatSpeed": 2
	},
	"reIn": "reverseDirection"
}]);
}
if(season == 4){
var particleCanvas = new particleCanvas("dearmsdanSeason", [{
	"type": {
		"typeName": "image",
		"url": "/resources/season/snowflake.png"
	},
	"number": 50,
	"op": {
		"min": 0.1,
		"max": 1
	},
	"size": {
		"min": 20,
		"max": 60
	},
	"zoom": {
		"min": 1,
		"max": 1
	},
	"speed": {
		"min": 1,
		"max": 1
	},
	"angle": {
		"value": 150,
		"float": 50
	},
	"rota": {
		"value": 30,
		"speed": 1.6,
		"floatValue": 120,
		"floatSpeed": 2
	},
	"reIn": "reverseDirection"
}]);
}

</script>



















<style>
	.navred>li>a:hover, .navred>li>a:focus, .navred>li>a.active{
    background-color: rgb(255, 210, 210);
    border-left: 5px solid rgb(222, 41, 41);
	}
	.navred > li > div{
    background-color: #e2a4a4;
	}
	.navred >li > div> ul> li:hover{
    background-color: #f6abab!important
	}
</style>
<script>
if(festival[1] == 1.1){
console.log(festival[0]);
// 超链接
$('a').css('color','#b23232');
// 导航栏
$('.navbar-default').css('background-color','rgba(255, 135, 135, 0.8)');
// 侧边栏
$('#dearmsdan .sidebar').css('background-color','#ffd1d1');
$('#dearmsdan .sidebar').css('box-shadow','none');
// 一级导航
$('.nav').addClass('navred');
// bg
$('.dearmsdan-bg').css('background-color','rgba(255, 0, 0, 0.5)');
	
	
	
$(".dearmsdan-festival").attr("id","c");
	var w = c.width = window.innerWidth,
		h = c.height = window.innerHeight,
		ctx = c.getContext( '2d' ),
		
		hw = w / 2, // half-width
		hh = h / 2,
		
		opts = {
			strings: [ '元旦到了！' , '用简单装饰祝福你，元旦快乐！','新年新气象~' ],
			charSize: 22,
			charSpacing: 35,
			lineHeight: 50,
			
			cx: w / 2,
			cy: h / 2,
			
			fireworkPrevPoints: 10,
			fireworkBaseLineWidth: 5,
			fireworkAddedLineWidth: 8,
			fireworkSpawnTime: 200,
			fireworkBaseReachTime: 30,
			fireworkAddedReachTime: 30,
			fireworkCircleBaseSize: 20,
			fireworkCircleAddedSize: 10,
			fireworkCircleBaseTime: 30,
			fireworkCircleAddedTime: 30,
			fireworkCircleFadeBaseTime: 10,
			fireworkCircleFadeAddedTime: 5,
			fireworkBaseShards: 5,
			fireworkAddedShards: 5,
			fireworkShardPrevPoints: 3,
			fireworkShardBaseVel: 4,
			fireworkShardAddedVel: 2,
			fireworkShardBaseSize: 3,
			fireworkShardAddedSize: 3,
			gravity: .1,
			upFlow: -.1,
			letterContemplatingWaitTime: 360,
			balloonSpawnTime: 20,
			balloonBaseInflateTime: 10,
			balloonAddedInflateTime: 10,
			balloonBaseSize: 20,
			balloonAddedSize: 20,
			balloonBaseVel: .4,
			balloonAddedVel: .4,
			balloonBaseRadian: -( Math.PI / 2 - .5 ),
			balloonAddedRadian: -1,
		},
		calc = {
			totalWidth: opts.charSpacing * Math.max( opts.strings[0].length, opts.strings[1].length )
		},
		
		Tau = Math.PI * 2,
		TauQuarter = Tau / 4,
		
		letters = [];

ctx.font = opts.charSize + 'px Verdana';

function Letter( char, x, y ){
	this.char = char;
	this.x = x;
	this.y = y;
	
	this.dx = -ctx.measureText( char ).width / 2;
	this.dy = +opts.charSize / 2;
	
	this.fireworkDy = this.y - hh;
	
	var hue = x / calc.totalWidth * 360;
	
	this.color = 'hsl(hue,80%,50%)'.replace( 'hue', hue );
	this.lightAlphaColor = 'hsla(hue,80%,light%,alp)'.replace( 'hue', hue );
	this.lightColor = 'hsl(hue,80%,light%)'.replace( 'hue', hue );
	this.alphaColor = 'hsla(hue,80%,50%,alp)'.replace( 'hue', hue );
	
	this.reset();
}
Letter.prototype.reset = function(){
	
	this.phase = 'firework';
	this.tick = 0;
	this.spawned = false;
	this.spawningTime = opts.fireworkSpawnTime * Math.random() |0;
	this.reachTime = opts.fireworkBaseReachTime + opts.fireworkAddedReachTime * Math.random() |0;
	this.lineWidth = opts.fireworkBaseLineWidth + opts.fireworkAddedLineWidth * Math.random();
	this.prevPoints = [ [ 0, hh, 0 ] ];
}
Letter.prototype.step = function(){
	
	if( this.phase === 'firework' ){
		
		if( !this.spawned ){
			
			++this.tick;
			if( this.tick >= this.spawningTime ){
				
				this.tick = 0;
				this.spawned = true;
			}
			
		} else {
			
			++this.tick;
			
			var linearProportion = this.tick / this.reachTime,
					armonicProportion = Math.sin( linearProportion * TauQuarter ),
					
					x = linearProportion * this.x,
					y = hh + armonicProportion * this.fireworkDy;
			
			if( this.prevPoints.length > opts.fireworkPrevPoints )
				this.prevPoints.shift();
			
			this.prevPoints.push( [ x, y, linearProportion * this.lineWidth ] );
			
			var lineWidthProportion = 1 / ( this.prevPoints.length - 1 );
			
			for( var i = 1; i < this.prevPoints.length; ++i ){
				
				var point = this.prevPoints[ i ],
						point2 = this.prevPoints[ i - 1 ];
					
				ctx.strokeStyle = this.alphaColor.replace( 'alp', i / this.prevPoints.length );
				ctx.lineWidth = point[ 2 ] * lineWidthProportion * i;
				ctx.beginPath();
				ctx.moveTo( point[ 0 ], point[ 1 ] );
				ctx.lineTo( point2[ 0 ], point2[ 1 ] );
				ctx.stroke();
			
			}
			
			if( this.tick >= this.reachTime ){
				
				this.phase = 'contemplate';
				
				this.circleFinalSize = opts.fireworkCircleBaseSize + opts.fireworkCircleAddedSize * Math.random();
				this.circleCompleteTime = opts.fireworkCircleBaseTime + opts.fireworkCircleAddedTime * Math.random() |0;
				this.circleCreating = true;
				this.circleFading = false;
				
				this.circleFadeTime = opts.fireworkCircleFadeBaseTime + opts.fireworkCircleFadeAddedTime * Math.random() |0;
				this.tick = 0;
				this.tick2 = 0;
				
				this.shards = [];
				
				var shardCount = opts.fireworkBaseShards + opts.fireworkAddedShards * Math.random() |0,
						angle = Tau / shardCount,
						cos = Math.cos( angle ),
						sin = Math.sin( angle ),
						
						x = 1,
						y = 0;
				
				for( var i = 0; i < shardCount; ++i ){
					var x1 = x;
					x = x * cos - y * sin;
					y = y * cos + x1 * sin;
					
					this.shards.push( new Shard( this.x, this.y, x, y, this.alphaColor ) );
				}
			}
			
		}
	} else if( this.phase === 'contemplate' ){
		
		++this.tick;
		
		if( this.circleCreating ){
			
			++this.tick2;
			var proportion = this.tick2 / this.circleCompleteTime,
					armonic = -Math.cos( proportion * Math.PI ) / 2 + .5;
			
			ctx.beginPath();
			ctx.fillStyle = this.lightAlphaColor.replace( 'light', 50 + 50 * proportion ).replace( 'alp', proportion );
			ctx.beginPath();
			ctx.arc( this.x, this.y, armonic * this.circleFinalSize, 0, Tau );
			ctx.fill();
			
			if( this.tick2 > this.circleCompleteTime ){
				this.tick2 = 0;
				this.circleCreating = false;
				this.circleFading = true;
			}
		} else if( this.circleFading ){
		
			ctx.fillStyle = this.lightColor.replace( 'light', 70 );
			ctx.fillText( this.char, this.x + this.dx, this.y + this.dy );
			
			++this.tick2;
			var proportion = this.tick2 / this.circleFadeTime,
					armonic = -Math.cos( proportion * Math.PI ) / 2 + .5;
			
			ctx.beginPath();
			ctx.fillStyle = this.lightAlphaColor.replace( 'light', 100 ).replace( 'alp', 1 - armonic );
			ctx.arc( this.x, this.y, this.circleFinalSize, 0, Tau );
			ctx.fill();
			
			if( this.tick2 >= this.circleFadeTime )
				this.circleFading = false;
			
		} else {
			
			ctx.fillStyle = this.lightColor.replace( 'light', 70 );
			ctx.fillText( this.char, this.x + this.dx, this.y + this.dy );
		}
		
		for( var i = 0; i < this.shards.length; ++i ){
			
			this.shards[ i ].step();
			
			if( !this.shards[ i ].alive ){
				this.shards.splice( i, 1 );
				--i;
			}
		}
		
		if( this.tick > opts.letterContemplatingWaitTime ){
			
			this.phase = 'balloon';
			
			this.tick = 0;
			this.spawning = true;
			this.spawnTime = opts.balloonSpawnTime * Math.random() |0;
			this.inflating = false;
			this.inflateTime = opts.balloonBaseInflateTime + opts.balloonAddedInflateTime * Math.random() |0;
			this.size = opts.balloonBaseSize + opts.balloonAddedSize * Math.random() |0;
			
			var rad = opts.balloonBaseRadian + opts.balloonAddedRadian * Math.random(),
					vel = opts.balloonBaseVel + opts.balloonAddedVel * Math.random();
			
			this.vx = Math.cos( rad ) * vel;
			this.vy = Math.sin( rad ) * vel;
		}
	} else if( this.phase === 'balloon' ){
			
		ctx.strokeStyle = this.lightColor.replace( 'light', 80 );
		
		if( this.spawning ){
			
			++this.tick;
			ctx.fillStyle = this.lightColor.replace( 'light', 70 );
			ctx.fillText( this.char, this.x + this.dx, this.y + this.dy );
			
			if( this.tick >= this.spawnTime ){
				this.tick = 0;
				this.spawning = false;
				this.inflating = true;	
			}
		} else if( this.inflating ){
			
			++this.tick;
			
			var proportion = this.tick / this.inflateTime,
			    x = this.cx = this.x,
					y = this.cy = this.y - this.size * proportion;
			
			ctx.fillStyle = this.alphaColor.replace( 'alp', proportion );
			ctx.beginPath();
			generateBalloonPath( x, y, this.size * proportion );
			ctx.fill();
			
			ctx.beginPath();
			ctx.moveTo( x, y );
			ctx.lineTo( x, this.y );
			ctx.stroke();
			
			ctx.fillStyle = this.lightColor.replace( 'light', 70 );
			ctx.fillText( this.char, this.x + this.dx, this.y + this.dy );
			
			if( this.tick >= this.inflateTime ){
				this.tick = 0;
				this.inflating = false;
			}
			
		} else {
			
			this.cx += this.vx;
			this.cy += this.vy += opts.upFlow;
			
			ctx.fillStyle = this.color;
			ctx.beginPath();
			generateBalloonPath( this.cx, this.cy, this.size );
			ctx.fill();
			
			ctx.beginPath();
			ctx.moveTo( this.cx, this.cy );
			ctx.lineTo( this.cx, this.cy + this.size );
			ctx.stroke();
			
			ctx.fillStyle = this.lightColor.replace( 'light', 70 );
			ctx.fillText( this.char, this.cx + this.dx, this.cy + this.dy + this.size );
			
			if( this.cy + this.size < -hh || this.cx < -hw || this.cy > hw  )
				this.phase = 'done';
			
		}
	}
}
function Shard( x, y, vx, vy, color ){
	
	var vel = opts.fireworkShardBaseVel + opts.fireworkShardAddedVel * Math.random();
	
	this.vx = vx * vel;
	this.vy = vy * vel;
	
	this.x = x;
	this.y = y;
	
	this.prevPoints = [ [ x, y ] ];
	this.color = color;
	
	this.alive = true;
	
	this.size = opts.fireworkShardBaseSize + opts.fireworkShardAddedSize * Math.random();
}
Shard.prototype.step = function(){
	
	this.x += this.vx;
	this.y += this.vy += opts.gravity;
	
	if( this.prevPoints.length > opts.fireworkShardPrevPoints )
		this.prevPoints.shift();
	
	this.prevPoints.push( [ this.x, this.y ] );
	
	var lineWidthProportion = this.size / this.prevPoints.length;
	
	for( var k = 0; k < this.prevPoints.length - 1; ++k ){
		
		var point = this.prevPoints[ k ],
				point2 = this.prevPoints[ k + 1 ];
		
		ctx.strokeStyle = this.color.replace( 'alp', k / this.prevPoints.length );
		ctx.lineWidth = k * lineWidthProportion;
		ctx.beginPath();
		ctx.moveTo( point[ 0 ], point[ 1 ] );
		ctx.lineTo( point2[ 0 ], point2[ 1 ] );
		ctx.stroke();
		
	}
	
	if( this.prevPoints[ 0 ][ 1 ] > hh )
		this.alive = false;
}
function generateBalloonPath( x, y, size ){
	
	ctx.moveTo( x, y );
	ctx.bezierCurveTo( x - size / 2, y - size / 2,
									 	 x - size / 4, y - size,
									   x,            y - size );
	ctx.bezierCurveTo( x + size / 4, y - size,
									   x + size / 2, y - size / 2,
									   x,            y );
}

function anim(){
	
	window.requestAnimationFrame( anim );
	
	ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
	ctx.fillRect( 0, 0, w, h );
	
	ctx.translate( hw, hh );
	
	var done = true;
	for( var l = 0; l < letters.length; ++l ){
		
		letters[ l ].step();
		if( letters[ l ].phase !== 'done' )
			done = false;
	}
	
	ctx.translate( -hw, -hh );
	
	if( done )
		for( var l = 0; l < letters.length; ++l )
			letters[ l ].reset();
}

for( var i = 0; i < opts.strings.length; ++i ){
	for( var j = 0; j < opts.strings[ i ].length; ++j ){
		letters.push( new Letter( opts.strings[ i ][ j ], 
														j * opts.charSpacing + opts.charSpacing / 2 - opts.strings[ i ].length * opts.charSize / 2,
														i * opts.lineHeight + opts.lineHeight / 2 - opts.strings.length * opts.lineHeight / 2 ) );
	}
}

anim();

window.addEventListener( 'resize', function(){
	
	w = c.width = window.innerWidth;
	h = c.height = window.innerHeight;
	
	hw = w / 2;
	hh = h / 2;
	
	ctx.font = opts.charSize + 'px Verdana';
})
	
}
</script>

	



<style>
</style>
<script>
if(festival[1] == 2.1){
	console.log(festival[0]);

// 超链接
$('a').css('color','#b23232');
// 导航栏
$('.navbar-default').css('background-color','rgba(255, 135, 135, 0.8)');
// 侧边栏
$('#dearmsdan .sidebar').css('background-color','#ffd1d1');
$('#dearmsdan .sidebar').css('box-shadow','none');
// 一级导航
$('.nav').addClass('navred');
// bg
$('.dearmsdan-bg').css('background-color','rgba(255, 0, 0, 0.5)');
	
	var ctx = document.querySelector('.dearmsdan-festival').getContext('2d')
ctx.canvas.width = window.innerWidth
ctx.canvas.height = window.innerHeight

var sparks = []
var fireworks = []
var i = 20; while(i--) {
   fireworks.push(
      new Firework(Math.random()*window.innerWidth, window.innerHeight*Math.random())
   )
}

render()
function render() {
   setTimeout(render, 1000/60)
   ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
   ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)
   for(var firework of fireworks) {
      if(firework.dead) continue
      firework.move()
      firework.draw()
   }
   for(var spark of sparks) {
      if(spark.dead) continue
      spark.move()
      spark.draw()
   }
   
   if(Math.random() < 0.05) {
      fireworks.push(new Firework())
   }
}

function Spark(x, y, color) {
   this.x = x
   this.y = y
   this.dir = Math.random() * (Math.PI*2)
   this.dead = false
   this.color = color
   this.speed = Math.random() * 3 + 3;
   this.walker = new Walker({ radius: 20, speed: 0.25 })
   this.gravity = 0.25
   this.dur = this.speed / 0.1
   this.move = function() {
      this.dur--
      if(this.dur < 0) this.dead = true
      
      if(this.speed < 0) return
      if(this.speed > 0) this.speed -= 0.1
      var walk = this.walker.step()
      this.x += Math.cos(this.dir + walk) * this.speed
      this.y += Math.sin(this.dir + walk) * this.speed
      this.y += this.gravity
      this.gravity += 0.05
      
   }
   this.draw = function() {
      drawCircle(this.x, this.y, 3, this.color)
   }
}

function Firework(x, y) {
   this.xmove = new Walker({radius: 10, speed: 0.5})
   this.x = x || Math.random() * ctx.canvas.width
   this.y = y || ctx.canvas.height
   this.height = Math.random()*ctx.canvas.height/2
   this.dead = false
   this.color = randomColor()
   
   this.move = function() {
      this.x += this.xmove.step()
      if(this.y > this.height) this.y -= 1; 
      else this.burst()
      
   }
   this.draw = function() {
      drawCircle(this.x, this.y, 1, this.color)
   }
   this.burst = function() {
      this.dead = true
      var i = 100; while(i--) sparks.push(new Spark(this.x, this.y, this.color))
   }
}

function drawCircle(x, y, radius, color) {
   color = color || '#FFF'
   ctx.fillStyle = color
   ctx.fillRect(x-radius/2, y-radius/2, radius, radius)
}

function randomColor(){
   return ['#ff6767','#ff0000','#ff8800','#ff00fc','#66cbe1'][Math.floor(Math.random() * 5)];
}

function Walker(options){
   this.step = function(){
      this.direction = Math.sign(this.target) * this.speed
      this.value += this.direction
      this.target
         ? this.target -= this.direction
         : (this.value)
            ? (this.wander) 
               ? this.target = this.newTarget() 
               : this.target = -this.value
            : this.target = this.newTarget()  
      return this.direction
   }
      
   this.newTarget = function() {
      return Math.round(Math.random()*(this.radius*2)-this.radius)
   }
   
   this.start = 0
   this.value = 0
   this.radius = options.radius
   this.target = this.newTarget()
   this.direction = Math.sign(this.target)
   this.wander = options.wander
   this.speed = options.speed || 1
}

} // end
</script>




<style>
	.navfen>li>a:hover, .navfen>li>a:focus, .navfen>li>a.active{
    background-color: rgb(255, 158, 180);
    border-left: 5px solid rgb(222, 41, 41);
	}
	.navfen > li > div{
    background-color: #e2a4a4;
	}
	.navfen >li > div> ul> li:hover{
    background-color: #f6abab!important
	}
canvas#valentinesDay {
  display: block;
  background: #ee9ca7;  /* fallback for old browsers */
  background: -webkit-linear-gradient(to bottom, #ffdde1, #ee9ca7);  /* Chrome 10-25, Safari 5.1-6 */
  background: linear-gradient(to bottom, #ffdde1, #ee9ca7); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
}
</style>
<script>
if(festival[1] == 2.14 || festival[1] == 7.7){
	console.log(festival[0]);
// 超链接
$('a').css('color','#b23232');
// 导航栏
$('.navbar-default').css('background-color','rgba(255, 204, 223, 0.8)');
// 侧边栏
$('#dearmsdan .sidebar').css('background-color','rgba(255, 204, 223, 0.8)');
$('#dearmsdan .sidebar').css('box-shadow','none');
// 一级导航
$('.nav').addClass('navfen');
// bg
$('.dearmsdan-bg').css('background-color','rgba(255, 136, 181, 1)');
	
	
(function () {
  'use strict';
  window.addEventListener('load', function () {
$(".dearmsdan-festival").attr("id","valentinesDay");
    var canvas = document.getElementById('valentinesDay');

    if (!canvas || !canvas.getContext) {
      return false;
    }

    /********************
      Random Number
    ********************/

    function rand(min, max) {
      return Math.floor(Math.random() * (max - min + 1) + min);
    }

    /********************
      Var
    ********************/

    // canvas 
    var ctx = canvas.getContext('2d');
    var X = canvas.width = window.innerWidth;
    var Y = canvas.height = window.innerHeight;

    // heart
    var heartNum = 1;
    var hearts = [];
    var miniHeartNum = 100;
    var miniHearts =[];

    var rad = Math.PI / 180;
    var GRAVITY = 0.01;

    /********************
      Animation
    ********************/

    window.requestAnimationFrame =
      window.requestAnimationFrame ||
      window.mozRequestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      window.msRequestAnimationFrame ||
      function (cb) {
        setTimeout(cb, 17);
      };

    /********************
      MiniHeart
    ********************/
    
    function MiniHeart(ctx, x, y, r) {
      this.ctx = ctx;
      this.init(x, y, r);
    }

    MiniHeart.prototype.init = function (x, y, r) {
      this.ctx = ctx;
      this.r = r;
      this.x1 = x;
      this.y1 = y;
      this.a = rand(0, 360);
      this.num = 22.5;
      this.v = {
        x: rand(-6, 6) * Math.random(),
        y: rand(-6, 6) * Math.random()
      };
      this.x2 = this.x1 + this.r * Math.cos(this.a * rad);
      this.y2 = this.y1 + this.r * Math.sin(this.a * rad);
      this.cx1 = this.x1 + this.r * Math.cos((this.a + this.num) * rad);
      this.cy1 = this.y1 + this.r * Math.sin((this.a + this.num) * rad);
      this.cx2 = this.x1 + this.r * Math.cos((this.a - this.num) * rad);
      this.cy2 = this.y1 + this.r * Math.sin((this.a - this.num) * rad);
      this.chord = 2 * this.r * Math.sin(this.num * rad / 2);
    };

    MiniHeart.prototype.draw = function () {
      ctx = this.ctx;
      ctx.save();
      ctx.beginPath();
      ctx.fillStyle = 'rgb(251, 125, 175)';
      ctx.strokeStyle = 'rgb(251, 125, 175)';
      ctx.moveTo(this.x2, this.y2);
      ctx.arc(this.cx1, this.cy1, this.chord, (270 + this.a) * rad, (270 + this.a + 225) * rad);
      ctx.lineTo(this.x1, this.y1);
      ctx.closePath();
      ctx.fill();
      ctx.moveTo(this.x2, this.y2);
      ctx.arc(this.cx2, this.cy2, this.chord, (90 + this.a) * rad, (90 + this.a + 135) * rad, true);
      ctx.lineTo(this.x1, this.y1);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
      ctx.restore();
    };
    
    MiniHeart.prototype.wrapPosition = function() {
      if (this.y1 > Y || this.x1 < 0 || this.x1 > X) {
        this.init(X / 2, Y / 2, rand(5, 30));
      }
    };

    MiniHeart.prototype.updatePosition = function() {
      this.v.y += GRAVITY;
      this.x1 += this.v.x;
      this.x2 += this.v.x;
      this.cx1 += this.v.x;
      this.cx2 += this.v.x;
      this.y1 += this.v.y;
      this.y2 += this.v.y;
      this.cy1 += this.v.y;
      this.cy2 += this.v.y;
    };

    MiniHeart.prototype.render = function () {
      this.updatePosition();
      this.wrapPosition();
      this.draw();
    };

    /********************
      Heart
    ********************/

    function Heart(ctx, x, y, r) {
      this.ctx = ctx;
      this.init(x, y, r);
    }

    Heart.prototype.init = function (x, y, r) {
      this.ctx = ctx;
      this.r = r;
      this.x1 = x;
      this.y1 = y + this.r / 1.5
      this.a = -90;
      this.num = 22.5;
      this.color = {
        r: 251,
        g: 125,
        b: 175,
        a: 1
      };
      this.x2 = this.x1 + this.r * Math.cos(this.a * rad);
      this.y2 = this.y1 + this.r * Math.sin(this.a * rad);
      this.cx1 = this.x1 + this.r * Math.cos((this.a + this.num) * rad);
      this.cy1 = this.y1 + this.r * Math.sin((this.a + this.num) * rad);
      this.cx2 = this.x1 + this.r * Math.cos((this.a - this.num) * rad);
      this.cy2 = this.y1 + this.r * Math.sin((this.a - this.num) * rad);
      this.chord = 2 * this.r * Math.sin(this.num * rad / 2);
    };

    Heart.prototype.draw = function () {
      ctx = this.ctx;
      ctx.save();
      ctx.fillStyle = this.gradient();
      ctx.shadowColor = '#f9005f';
      ctx.shadowOffsetX = 5;
      ctx.shadowOffsetY = 5;
      ctx.shadowBlur = 5;
      ctx.beginPath();
      ctx.moveTo(this.x2, this.y2);
      ctx.arc(this.cx1, this.cy1, this.chord, (270 + this.a) * rad, (270 + this.a + 225) * rad);
      ctx.lineTo(this.x1, this.y1);
      ctx.moveTo(this.x2, this.y2);
      ctx.arc(this.cx2, this.cy2, this.chord, (90 + this.a) * rad, (90 + this.a + 135) * rad, true);
      ctx.lineTo(this.x1, this.y1);
      ctx.fill();
      ctx.restore();
    };

    Heart.prototype.gradient = function () {
      var col = this.color.r + "," + this.color.g + "," + this.color.b;
      var g = this.ctx.createRadialGradient(this.x1, this.y1 - this.r / 1.5, 0, this.x1, this.y1 - this.r / 1.5, this.r);
      g.addColorStop(0, "rgba(" + col + ", " + (this.color.a * 0) + ")");
      g.addColorStop(0.5, "rgba(" + col + ", " + (this.color.a * 0.5) + ")");
      g.addColorStop(1, "rgba(" + col + ", " + (this.color.a * 1) + ")");
      return g;
    };

    Heart.prototype.render = function () {
      this.draw();
    };
    
    /********************
      Create
    ********************/
     
    for (var i = 0; i < heartNum; i++) {
      var heart = new Heart(ctx, X / 2, Y / 2, 150);
      hearts.push(heart);
    }

    for (var i = 0; i < miniHeartNum; i++) {
      var miniHeart = new MiniHeart(ctx, X / 2, Y / 2, rand(5, 30));
      miniHearts.push(miniHeart);
    }

    /********************
      Render
    ********************/
    
    function render() {
      ctx.clearRect(0, 0, X, Y);
      for (var i = 0; i < hearts.length; i++) {
        hearts[i].render();
      }
      for (var i = 0; i < miniHearts.length; i++) {
        miniHearts[i].render();
      }
      requestAnimationFrame(render);
    }

    render();

    /********************
      Resize
    ********************/
    
    function onResize() {
      X = canvas.width = window.innerWidth;
      Y = canvas.height = window.innerHeight;
      hearts[0].init(X / 2, Y / 2, 150);
    }

    /********************
      Event
    ********************/

    window.addEventListener('resize', function () {
      onResize();
    });

  });
  // Author
  console.log('File Name / mellomelloMellow.js\nCreated Date / January 15, 2020\nAuthor / Toshiya Marukubo\nTwitter / https://twitter.com/toshiyamarukubo');
})();

}
</script>




<style>
</style>
<script>
if(festival[1] == 4.4){
	console.log(festival[0]);
		$('html').css({"filter":"grayscale(100%)"});
	(function(){
		$(".dearmsdan-festival").attr("id","qingmingFestival");
var c = document.getElementById("qingmingFestival");
var ctx = c.getContext("2d");
var w = c.width = window.innerWidth;
var h = c.height = window.innerHeight;
var clearColor = 'rgba(0, 0, 0, .1)';
var max = 30;
var drops = [];

function random(min, max) {
    return Math.random() * (max - min) + min;
}

function O() {}

O.prototype = {
	init: function() {
		this.x = random(0, w);
		this.y = 0;
		this.color = 'hsl(180, 100%, 50%)';
		this.w = 2;
		this.h = 1;
		this.vy = random(4, 5);
		this.vw = 3;
		this.vh = 1;
		this.size = 2;
		this.hit = random(h * .8, h * .9);
		this.a = 1;
		this.va = .96;
	},
	draw: function() {
		if (this.y > this.hit) {
			ctx.beginPath();
			ctx.moveTo(this.x, this.y - this.h / 2);

			ctx.bezierCurveTo(
				this.x + this.w / 2, this.y - this.h / 2,
				this.x + this.w / 2, this.y + this.h / 2,
				this.x, this.y + this.h / 2);

			ctx.bezierCurveTo(
				this.x - this.w / 2, this.y + this.h / 2,
				this.x - this.w / 2, this.y - this.h / 2,
				this.x, this.y - this.h / 2);

			ctx.strokeStyle = 'hsla(180, 100%, 50%, '+this.a+')';
			ctx.stroke();
			ctx.closePath();
			
		} else {
			ctx.fillStyle = this.color;
			ctx.fillRect(this.x, this.y, this.size, this.size * 5);
		}
		this.update();
	},
	update: function() {
		if(this.y < this.hit){
			this.y += this.vy;
		} else {
			if(this.a > .03){
				this.w += this.vw;
				this.h += this.vh;
				if(this.w > 100){
					this.a *= this.va;
					this.vw *= .98;
					this.vh *= .98;
				}
			} else {
				this.init();
			}
		}
		
	}
}

function resize(){
	w = c.width = window.innerWidth;
	h = c.height = window.innerHeight;
}

function setup(){
	for(var i = 0; i < max; i++){
		(function(j){
			setTimeout(function(){
				var o = new O();
				o.init();
				drops.push(o);
			}, j * 200)
		}(i));
	}
}


function anim() {
	ctx.fillStyle = "#fff";
	ctx.fillRect(0,0,w,h);
	for(var i in drops){
		drops[i].draw();
	}
	requestAnimationFrame(anim);
}


window.addEventListener("resize", resize);

setup();
anim();		
	
	})()
}
</script>




<style>
	.navlan>li>a:hover, .navlan>li>a:focus, .navlan>li>a.active{
    background-color: rgba(9, 200, 255, 0.37);
    border-left: 5px solid rgb(78, 41, 222);
	}
	.navlan > li > div{
    background-color: #a4d9e2;
	}
	.navlan >li > div> ul> li:hover{
    background-color: #abf2f6!important
	}
canvas#childrensDay {
    display: block;
    background: #ABE7FF;
}
</style>
<script>
if(festival[1] == 6.1){
	console.log(festival[0]);
// 超链接
//$('a').css('color','#b23232');
// 导航栏
$('.navbar-default').css('background-color','rgba(187, 209, 255, 0.8)');
// 侧边栏
$('#dearmsdan .sidebar').css('background-color','rgba(148, 202, 255, 0.8)');
$('#dearmsdan .sidebar').css('box-shadow','none');
// 一级导航
$('.nav').addClass('navlan');
	
	
$(".dearmsdan-festival").attr("id","childrensDay");
		/*
* File Name / pinwheel.js
* Created Date / Aug 14, 2020
* Aurhor / Toshiya Marukubo
* Twitter / https://twitter.com/toshiyamarukubo
*/

(function () {
  'use strict';
  window.addEventListener('load', function () {
    var canvas = document.getElementById('childrensDay');

    if (!canvas || !canvas.getContext) {
      return false;
    }

    /********************
      Random Number
    ********************/

    function rand(min, max) {
      return Math.floor(Math.random() * (max - min + 1) + min);
    }
    
    /********************
      Var
    ********************/

    var ctx = canvas.getContext('2d');
    var X = canvas.width = window.innerWidth;
    var Y = canvas.height = window.innerHeight;
    var mouseX = null;
    var mouseY = null;
    var bubbles = [];
    var bubbleNum = 150;
    var shapes = [];
    var rad = Math.PI * 2 / 4;
    var style = {
      black: 'black',
      white: 'white',
      lineWidth: 4,
    };

    if (X < 768) {
      bubbleNum = 100;
    }

    /********************
      Animation
    ********************/

    window.requestAnimationFrame =
      window.requestAnimationFrame ||
      window.mozRequestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      window.msRequestAnimationFrame ||
      function(cb) {
        setTimeout(cb, 17);
      };

    /********************
      Bubble
    ********************/

    function Bubble(ctx, x, y) {
      this.ctx = ctx;
      this.init(x, y);
    }
    
    Bubble.prototype.init = function(x, y) {
      this.x = x;
      this.y = y;
      this.r = rand(20, 50);
      this.ga = Math.random() * Math.random() * Math.random();
      this.v = {
        x: rand(-1, 1) * Math.random() * Math.random(),
        y: Math.random()
      };
      this.random = Math.random();
      this.a = rand(0, 360);
      this.rad = this.a * Math.PI / 180;
      this.as = rand(0, 360) * Math.PI / 180;
    };
    
    Bubble.prototype.draw = function() {
      var ctx  = this.ctx;
      ctx.save();
      ctx.fillStyle = 'white';
      ctx.strokeStyle = 'white';
      ctx.lineCap = 'round';
      ctx.lineWidth = this.r / 4;
      ctx.globalAlpha = this.ga;
      ctx.translate(this.x, this.y);
      ctx.rotate(this.rad);
      ctx.translate(-this.x, -this.y);
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.globalAlpha = this.ga * 1.1;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.r * 0.7, this.as, this.as + 1, false);
      ctx.stroke();
      ctx.restore();
    };

    Bubble.prototype.updatePosition = function() {
      if (this.y > Y - Y / 3) {
        this.v.x += 0.1;
        this.v.y -= 0.01;
      }
      this.x += this.v.x;
      this.y += this.v.y;
    };

    Bubble.prototype.updateParams = function(i) {
      this.a += this.random;
      this.rad = this.a * Math.PI / 180;
    };

    Bubble.prototype.wrapPosition = function() {
      if (this.x > X + this.r / 2) {
        this.init(rand(0, X), rand(0 - Y / 5, 0));
      }
    };

    Bubble.prototype.render = function(i) {
      this.updateParams(i);
      this.updatePosition();
      this.wrapPosition();
      this.draw();
    };

    for (var i = 0; i < bubbleNum; i++) {
      var b = new Bubble(ctx, rand(0, X), rand(0, Y / 2));
      bubbles.push(b);
    }

    /********************
      Shape
    ********************/
     
    function Shape(ctx, x, y) {
      this.ctx = ctx;
      this.init(x, y);
    }
    
    Shape.prototype.init = function(x, y) {
      this.x = x;
      this.y = y;
      this.r = rand(20, 30);
      this.a = 0;
      this.rad = this.a * Math.PI / 180;
      this.random = Math.random();
      this.c = rand(0, 360);
      this.a1 = rand(-10, 10);
      this.rad1 = this.a1 * Math.PI / 180;
    };
    
    Shape.prototype.draw = function() {
      var ctx  = this.ctx;
      ctx.save();
      ctx.fillStyle = 'hsl(' + this.c + ', 100%, 80%)';
      ctx.strokeStyle = 'hsl(' + this.c + ', 80%, 60%)';
      ctx.translate(this.x, this.y);
      ctx.rotate(this.rad1);
      ctx.translate(-this.x, -this.y);
      ctx.lineWidth = this.r / 10;
      ctx.beginPath();
      ctx.moveTo(this.x, this.y);
      ctx.lineTo(this.x, Y + 10);
      ctx.stroke();
      ctx.lineWidth = 1;
      ctx.translate(this.x, this.y);
      ctx.rotate(Math.tan(this.rad));
      ctx.translate(-this.x, -this.y);
      ctx.fillRect(this.x - this.r, this.y - this.r, this.r * 2, this.r * 2);
      ctx.fillStyle = 'hsl(' + this.c + ', 80%, 60%)';
      for (var j = 0; j < 4; j++) {
        ctx.translate(this.x, this.y);
        ctx.rotate(90 * Math.PI / 180);
        ctx.translate(-this.x, -this.y);
        ctx.beginPath();
        ctx.moveTo(Math.cos(rad * 0) * this.r + this.x, Math.sin(rad * 0) * this.r + this.y + this.r);
        for (var i = 1; i < 4; i++) {
          if (i !== 2) {
            ctx.lineTo(Math.cos(rad * i) * this.r + this.x, Math.sin(rad * i) * this.r + this.y + this.r);
          }
        }
        ctx.closePath();
        ctx.fill();
      }
      ctx.restore();
    };

    Shape.prototype.updateParams = function() {
      this.a += this.random;
      this.rad = this.a * Math.PI / 180;
    };

    Shape.prototype.render = function(i) {
      this.updateParams();
      this.draw();
    };

    for (var i = 0; i < X;) {
      var dist = rand(1, 50);
      var s = new Shape(ctx, i += dist, rand(Y - Y / 3, Y - Y / 6));
      shapes.push(s);
    }

    /********************
      Render
    ********************/
    
    function render() {
      ctx.clearRect(0, 0, X, Y);
      for (var i = 0; i < shapes.length; i++) {
        shapes[i].render(i);
      }
      for (var i = 0; i < bubbles.length; i++) {
        bubbles[i].render(i);
      }
      requestAnimationFrame(render);
    }

    render();

    /********************
      Event
    ********************/
    
    function onResize() {
      X = canvas.width = window.innerWidth;
      Y = canvas.height = window.innerHeight;
      if (X < 768) {
        bubbleNum = 100;
      } else {
        bubbleNum = 200;
      }
      shapes = [];
      bubbles = [];
      for (var i = 0; i < X;) {
        var dist = rand(1, 50);
        var s = new Shape(ctx, i += dist, rand(Y - Y / 3, Y - Y / 6));
        shapes.push(s);
      }
      for (var i = 0; i < bubbleNum; i++) {
        var b = new Bubble(ctx, rand(0, X), rand(0, Y / 2));
        bubbles.push(b);
      }
    }

    window.addEventListener('resize', function() {
      onResize();
    });

    canvas.addEventListener('click', function(e) {
      mouseX = e.clientX;
      mouseY = e.clientY;
      var num = rand(1, 20);
      for (var i = 0; i < num; i++) {
        var b = new Bubble(ctx, rand(mouseX - 100, mouseX + 100), rand(mouseY - 100, mouseY + 100));
        bubbles.push(b);
      }
    }, false);

  });
})();

		
		
		
		
}
</script>




	

 
		<div class="dearmsdan-pjax">
		<script src="/js/pjax/jquery.pjax.js"></script>
			<script type="text/javascript">
$(document).ready(function () {
	$(document).pjax('a[target!=_blank]', '.main', {fragment: '.main',timeout: 8000});

	$(document).on('pjax:error', function() {
		alert("慢点吧，等等我~");
		  history.back();
	});
	
	$(document).on('pjax:start', function() {
		//加载延迟中...................
		$(".main-content").removeClass("wrapShow");
	});
	$(document).on('pjax:end', function() {
		//加载中...................
		$(".main-content").delay(500).addClass("wrapShow");
	});
	
	$(document).on('ready pjax:end', function(event) {
	linker();
	tocs();
	copycodes();
	postcolor();								 
	styleS();
	dearmsdanlazyload();
	
	}); /*end ready pjax*/

	
function linker(){
/* 外链保护http://link.zhd99.cn */
	 

		$("article a").not(".toc a,article h1 a,article h2 a,article h3 a,article h4 a,article h5 a,article h6 a,article .gallerys,.ui-artZoom-buttons a").attr("href",
																														function(){
			// 不是本站链接检测  article
			var str = this.href;
			var pattern = /http.+zhd99.cn/;
			var falg = pattern.test(str).toString().trim();

			var pattern2 = /http.+dearmsdan/;
			var falg2 = pattern2.test(str).toString().trim();
			if('true' != falg && 'true' != falg2){
				return 'http://link.dearmsdan.com/links.html' + '?target=' + str;
			   }
	});

	
}
		
	
/* .dearmsdan-post悬浮变色 */ 
function postcolor(){
	
$(".dearmsdan-post").mouseover(function(){
		
	// 随机 变化的淡入
var arr = ['0 4px 24px rgb(255, 255, 255)','0 4px 24px rgb(163, 163, 163)','0 4px 24px rgb(206, 154, 154)','0 4px 24px rgb(206, 154, 178)','0 4px 24px rgb(193, 154, 206)','0 4px 24px rgb(154, 158, 206)','0 4px 24px rgb(154, 187, 206)','0 4px 24px rgb(154, 206, 170)','0 4px 24px rgb(206, 200, 154)','0 4px 24px rgb(206, 180, 154)','0 4px 24px rgb(206, 154, 154)']; 
		
var index = Math.floor((Math.random()*arr.length)); 
	// 预期不佳
	$('.dearmsdan-post:hover').css("box-shadow",arr[index]);
		
});
	$(".dearmsdan-post").mouseleave(function(){
	// 移除
	$('.dearmsdan-post').css("box-shadow","none");
		
});
	
}/* end hoverColor  */
		
	
/*页面载入完成后，创建复制按钮*/
function copycodes(){
	
	/* 代码高度 判断 */
	
	 $("figure td pre").scroll(function(){
        $("figure td:nth-child(1) pre").scrollTop($(this).scrollTop()); // 纵向滚动条
        $("figure td:nth-child(2) pre").scrollLeft($(this).scrollLeft()); // 横向滚动条
    });
	
		!function (e, t, a) {
		  /* code */
		  var initCopyCode = function(){
			var copyHtml = '';
			copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
			copyHtml += '  <i class="fa fa-globe"></i><span>copy</span>';
			copyHtml += '</button>';
			  // 设置 放置位置↓
			$("figure td:nth-child(2) pre").before(copyHtml);
			  		//$("figure td:nth-child(2) pre").wrap("<div></div>");
			new ClipboardJS('.btn-copy', {
				target: function(trigger) {
					return trigger.nextElementSibling;
				}
			});
		  }
		  initCopyCode();
			
			
		}(window, document);
} /* end copycodes  */	
	

/* 目录  */
function tocs(){
	/* 目录图标被点击  */
	$('.second').on('click', function () {

		if (!$('body').hasClass('layout-fullwidth')) {
			$('body').addClass('layout-fullwidth');    // 初始出现

		} else {
			$('body').addClass('layout-fullwidth');    // 初始出现

		}

		if ($(window).innerWidth() < 1025) {
			if (!$('body').hasClass('offcanvas-active')) {
				$('body').removeClass('offcanvas-active');
			} else {
				$('body').removeClass('offcanvas-active');
			}
		}
	});
	/* 目录侧边栏 */
	if($('.second').length>0) {
	// 当前刷新目录产生
	$(".second").pageslide();
	} else {
		 window.onload = consoleTest;
function consoleTest(){
		console.log("\n %c hexo-theme-dearmsdan vbj %c https://github.com/ZHD99/hexo-theme-dearmsdan \n", "color: #FFF; background:#030307; padding:5px 0;", "background: #85adfede; padding:5px 0;");
		var str = function () {
/*
     _                                         _               
    | | It gives people a sense of emptiness  | |              
  __| |  ___   __ _  _ __  _ __ ___   ___   __| |  __ _  _ __  
 / _` | / _ \ / _` || '__|| '_ ` _ \ / __| / _` | / _` || '_ \ 
| (_| ||  __/| (_| || |   | | | | | |\__ \| (_| || (_| || | | |
 \__,_| \___| \__,_||_|   |_| |_| |_||___/ \__,_| \__,_||_| |_|
                                                               
欢迎您的到来，本站是一款Hexo宝钻蓝色主题，hexo-theme-dearmsdan                                              


*/
        }
		window.console.log(str.getMultiLine());

			
}/* end window.onload */ 
	}/* end else */ 
	
} /* end toc */

/*  移动端样式  */
function styleS(){
if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))) {

    // 背景色
	/*$("html").css("background-image","url('')");*/
	
	
    // 底部背景色
	$('.main').css('background','aliceblue');
	$('.main').css('max-height','100%');
	

	/* 首页 排版 */
	$('.dearmsdan-bg').css('box-shadow','none');
	$('.dearmsdan-bg').css('-webkit-box-shadow','none');
//	$('.main-content').css('background-color','#ECECEE');
	$('.dearmsdan-post').css('background-color','rgba(255, 255, 255, 0.52)');
	$('.dearmsdan-post').css('padding','30px');
	$('.dearmsdan-post').css('margin-bottom','20px');
	$('.main-content').addClass('m-content');
	$('.dearmsdan-title').css('opacity','1');
	
	/* 文章 内容页 排版 */
	$('.dearmsdan-bg div').removeClass('div_bg');
	$('.dearmsdan-bg div').addClass('divbg');
	$('.dearmsdan-bg div').css("background-color","rgba(255, 255, 255, 0.8)");
	$('#dearmsdanPost').addClass('dearmsdanPost');
	
	
	
		$('.dearmsdan-post').css('padding','15px');
		//$('.dearmsdan-post').css('background-color','rgba(223, 223, 223, 0.52)');
		$('.main').css('background','rgba(255, 255, 255, 0)');//#d6ecff
		$('.dearmsdan-bg').css('background','#254663');
	
	
	
	
	
	

	}else{
		
	
	
	}
} /* end styleS */	


/* 观察者模式 */
function Observer(){
	$('#dearmsdan-logo').click( 
		function () { 
			alert("你是观察者");
			$('.nav-list').addClass('dearmsdan-none');
			$('.dearmsdan-bg').addClass('dearmsdan-none');
			$('.main-content').addClass('dearmsdan-none');
			$('.container-fluid').addClass('dearmsdan-none');
			$('#dearmsdan-vbg').css("opacity","1");
			$('#dearmsdan-vbg').css("z-index","5201314");
			$('.navbar').css("background-color","transparent");
			$('.navbar').css("box-shadow","none");
			$('#dearmsdan-logo').css("position","relative");
			$('#dearmsdan-logo').css("left","-100px");
			console.log("你是观察者null");
			
		});
}/* end Observer */
	
													
/* 图片懒加载 */
function dearmsdanlazyload(){
		var imgs = document.querySelectorAll('img');
		
		//pimg.css('display','none');
		function lazyload(){
			var scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
			var winTop = window.innerHeight;
			for(var i=0;i < imgs.length;i++){
				var flag=imgs[i].hasAttribute('dearmsdan-src');
				if(flag){
					imgs[i].src = imgs[i].getAttribute('dearmsdan-src');
				   }
			}
		}
		
	
		function throttle(method,delay){
			var timer = null;
				var context = this, args=arguments;
			/*return function(){*/
				clearTimeout(timer);
				timer=setTimeout(function(){
					method.apply(context,args);
				},delay);
			/*}*/
		}
	throttle(lazyload,200);
	
	
	/* 滚动指定位置加载该处的图片window.onscroll = throttle(lazyload,200); */
		
	
} /* end Obimg */
 if (window.addEventListener) { window.addEventListener("load",dearmsdanlazyload, false);} 
   else if (window.attachEvent) {window.attachEvent("onload",dearmsdanlazyload); }
    else{ window.onload = dearmsdanlazyload; }



});  /* end */
</script>
		</div>


	
	<link rel="stylesheet" type="text/css" href="/resources/toc/toc.css"> 
	<script src="/resources/toc/jquery.pageslide.js"></script> 
	
  <script type="text/javascript" src="/js/copycode/clipboard.min.js"></script>  


 
	
		

    </body>
</html>